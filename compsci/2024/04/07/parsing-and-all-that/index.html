<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Parsing and all that</title>
    <meta name="description" content="A web log. Mostly about computer science-y stuff. 
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://blog.jeffsmits.net/compsci/2024/04/07/parsing-and-all-that/">
    
    <link rel="stylesheet" type="text/css" href="/css/katex.min.css">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Whatever</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Parsing and all that</h1>
    <p class="post-meta">Apr 7, 2024</p>
  </header>

  <article class="post-content">
    <p>Hello again! I’m picking up my <a href="/compsci/2016/03/28/theory-of-computation/">series on Automata</a>, with this post that goes into what I had always meant to get to: parsers. We’ll check out the old-school linear time parsing algorithms, which only need to go over the input once, without backtracking or caching. We’ll check out LL and LR, parse tables, recursive descent and recursive <em>ascent</em>. Welcome to the world of deterministic parsing…</p>

<h1 id="refresher-from-pushy-automata">Refresher from Pushy Automata</h1>

<p>We’ll start with a brief refresher from the previous post of the series, <a href="/compsci/2016/05/15/pushy-automata/">pushy automata</a>, since that was a little while back.</p>

<h2 id="push-down-automata">Push-Down Automata</h2>

<p>Push-down automata (PDAs) are automata with a <em>stack</em>. Normal finite automata just consume input and have fixed memory via their states. PDAs can remember things on a single stack too, by pushing onto it and popping from it. Here’s a deterministic PDA for recognising the language of words that start with zeroes, followed by an equal number of ones:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Non&#45;regular language example, deterministic Pages: 1 -->
<svg role="img" aria-label="Non-regular language example, deterministic" width="446pt" height="79pt" viewBox="0.00 0.00 445.57 78.90">
<title>Non-regular language example, deterministic</title>
<desc>digraph &quot;Non-regular language example, deterministic&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;
start [shape=none, label=&quot;&quot;, width=0];
q₀ [shape=doublecircle, width=0.4];
q₃ [shape=doublecircle, width=0.4];
start -&gt; q₀;
q₀ -&gt; q₁ [label=&quot;0, ε → $&quot;];
q₁ -&gt; q₂ [label=&quot;1, 0 → ε&quot;];
q₂ -&gt; q₃ [label=&quot;1, $ → ε&quot;];
q₁ -&gt; q₁ [label=&quot;0, ε → 0&quot;];
q₂ -&gt; q₂ [label=&quot;1, 0 → ε&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 74.9)">
<title>Non&#45;regular language example, deterministic</title>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
</g>
<!-- q₀ -->
<g id="node2" class="node">
<title>q₀</title>
<ellipse fill="none" stroke="#010101" cx="56.12" cy="-18.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="56.12" cy="-18.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="56.12" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">q₀</text>
</g>
<!-- start&#45;&gt;q₀ -->
<g id="edge1" class="edge">
<title>start&#45;&gt;q₀</title>
<path fill="none" stroke="#010101" d="M18.23,-18.4C20.91,-18.4 23.72,-18.4 26.56,-18.4" />
<polygon fill="#010101" stroke="#010101" points="26.5,-21.9 36.5,-18.4 26.5,-14.9 26.5,-21.9" />
</g>
<!-- q₁ -->
<g id="node4" class="node">
<title>q₁</title>
<ellipse fill="none" stroke="#010101" cx="177.27" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="177.27" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">q₁</text>
</g>
<!-- q₀&#45;&gt;q₁ -->
<g id="edge2" class="edge">
<title>q₀&#45;&gt;q₁</title>
<path fill="none" stroke="#010101" d="M74.45,-18.4C93.7,-18.4 125.1,-18.4 147.94,-18.4" />
<polygon fill="#010101" stroke="#010101" points="147.8,-21.9 157.8,-18.4 147.8,-14.9 147.8,-21.9" />
<text text-anchor="middle" x="116.89" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">0, ε → $</text>
</g>
<!-- q₃ -->
<g id="node3" class="node">
<title>q₃</title>
<ellipse fill="none" stroke="#010101" cx="419.17" cy="-18.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="419.17" cy="-18.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="419.17" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">q₃</text>
</g>
<!-- q₁&#45;&gt;q₁ -->
<g id="edge5" class="edge">
<title>q₁&#45;&gt;q₁</title>
<path fill="none" stroke="#010101" d="M167.17,-33.19C163.88,-43.82 167.25,-54.4 177.27,-54.4 183.53,-54.4 187.2,-50.27 188.26,-44.57" />
<polygon fill="#010101" stroke="#010101" points="191.76,-44.4 187.49,-34.7 184.78,-44.94 191.76,-44.4" />
<text text-anchor="middle" x="177.27" y="-57.6" font-family="Times,serif" font-size="14.00" fill="#010101">0, ε → 0</text>
</g>
<!-- q₂ -->
<g id="node5" class="node">
<title>q₂</title>
<ellipse fill="none" stroke="#010101" cx="298.02" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="298.02" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">q₂</text>
</g>
<!-- q₁&#45;&gt;q₂ -->
<g id="edge3" class="edge">
<title>q₁&#45;&gt;q₂</title>
<path fill="none" stroke="#010101" d="M195.03,-18.4C214.22,-18.4 245.95,-18.4 268.92,-18.4" />
<polygon fill="#010101" stroke="#010101" points="268.83,-21.9 278.83,-18.4 268.83,-14.9 268.83,-21.9" />
<text text-anchor="middle" x="237.64" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">1, 0 → ε</text>
</g>
<!-- q₂&#45;&gt;q₃ -->
<g id="edge4" class="edge">
<title>q₂&#45;&gt;q₃</title>
<path fill="none" stroke="#010101" d="M315.84,-18.4C334.98,-18.4 366.56,-18.4 389.59,-18.4" />
<polygon fill="#010101" stroke="#010101" points="389.54,-21.9 399.54,-18.4 389.54,-14.9 389.54,-21.9" />
<text text-anchor="middle" x="358.39" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">1, $ → ε</text>
</g>
<!-- q₂&#45;&gt;q₂ -->
<g id="edge6" class="edge">
<title>q₂&#45;&gt;q₂</title>
<path fill="none" stroke="#010101" d="M287.92,-33.19C284.63,-43.82 288,-54.4 298.02,-54.4 304.28,-54.4 307.95,-50.27 309.01,-44.57" />
<polygon fill="#010101" stroke="#010101" points="312.51,-44.4 308.24,-34.7 305.53,-44.94 312.51,-44.4" />
<text text-anchor="middle" x="298.02" y="-57.6" font-family="Times,serif" font-size="14.00" fill="#010101">1, 0 → ε</text>
</g>
</g>
</svg>
</div>

<p>So we start at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">q_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, see if there is a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> as input, ignore the top of the stack, and put a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">$</mi></mrow><annotation encoding="application/x-tex">\$</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">$</span></span></span></span> on the stack as a marker for the end of the stack. Now we’re in state <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, in which we can consume more zeroes from the input and put those on the stack. If we find a one as input, we remove a zero from the stack by not pushing anything new on the stack. Now we’re in state <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">q_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> where we remove zeroes from the stack for every one in the input, until we consume the final one by removing the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">$</mi></mrow><annotation encoding="application/x-tex">\$</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">$</span></span></span></span> from the stack.</p>

<blockquote>
  <p>Aside: This is one of the examples from the old blog post, and I now see that it is missing a transition! This automaton rejects the input <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>01</mn></mrow><annotation encoding="application/x-tex">01</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">01</span></span></span></span>, because there is no transition <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mrow><mn>1</mn><mo separator="true">,</mo><mtext> </mtext><mi mathvariant="normal">$</mi><mtext> </mtext><mo>→</mo><mtext> </mtext><mi>ε</mi></mrow></mpadded></mover><msub><mi>q</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">q_1 \xrightarrow{1,\ \$\ \to\ \varepsilon} q_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3414em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.147em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mtight">$</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mrel mtight">→</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">ε</span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128 -16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20  11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7  39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85 -40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5 -12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67  151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. Oops ^_^</p>
</blockquote>

<h2 id="context-free-grammars-derivations-and-a-naive-pda-translation">Context-Free Grammars, Derivations, and a naive PDA translation</h2>

<p>A context-free grammar that describes the above language is:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mn>0</mn><mi>S</mi><mn>1</mn></mrow><annotation encoding="application/x-tex"> S = 0 S 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">1</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(step)</mtext></mrow><annotation encoding="application/x-tex"> \text{(step)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(step)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>ε</mi></mrow><annotation encoding="application/x-tex"> S = \varepsilon </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(</mtext><mi>ε</mi><mtext>)</mtext></mrow><annotation encoding="application/x-tex"> \text{(}\varepsilon\text{)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span></span><span class="mord mathnormal">ε</span><span class="mord text"><span class="mord">)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>Sort <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> is the start symbol, the starting point in the grammar. If we’re using the grammar <em>productively</em> we start from the start symbol and use the rules left-to-right to replace sorts until we get the sentence in the corresponding context-free language that we want. Something like: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>→</mo><mn>0</mn><mi>S</mi><mn>1</mn><mo>→</mo><mn>00</mn><mi>S</mi><mn>11</mn><mo>→</mo><mn>0011</mn></mrow><annotation encoding="application/x-tex"> S \to 0 S 1 \to 0 0 S 1 1 \to 0 0 1 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">00</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">11</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0011</span></span></span></span>. This is called a <em>derivation</em>.</p>

<p>The most general, naive way to derive a push-down automaton for any context-free grammar is by pushing the end-of-stack and start symbol at the start, having a “main” state that uses the grammar rules with the body reversed (to deal with the stack order), and an accept state that pops the end-of-stack:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Non&#45;regular language example, deterministic Pages: 1 -->
<svg role="img" aria-label="Non-regular language example, deterministic" width="250pt" height="128pt" viewBox="0.00 0.00 249.52 128.40">
<title>Non-regular language example, deterministic</title>
<desc>digraph &quot;Non-regular language example, deterministic&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;
start [shape=none, label=&quot;&quot;, width=0];
q₁ [shape=doublecircle, width=0.4];
start -&gt; q₀ [label=&quot;$ S&quot;];
q₀ -&gt; q₁ [label=&quot;ε, $ → ε&quot;];
q₀ -&gt; q₀ [label=&quot;ε, S → 1 S 0\nε, S → ε\n0, 0 →ε\n1, 1 → ε&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 124.4)">
<title>Non&#45;regular language example, deterministic</title>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
</g>
<!-- q₀ -->
<g id="node3" class="node">
<title>q₀</title>
<ellipse fill="none" stroke="#010101" cx="87.72" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="87.72" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">q₀</text>
</g>
<!-- start&#45;&gt;q₀ -->
<g id="edge1" class="edge">
<title>start&#45;&gt;q₀</title>
<path fill="none" stroke="#010101" d="M18.12,-18.4C29.7,-18.4 45.16,-18.4 58.48,-18.4" />
<polygon fill="#010101" stroke="#010101" points="58.41,-21.9 68.41,-18.4 58.41,-14.9 58.41,-21.9" />
<text text-anchor="middle" x="27.72" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">$ S</text>
</g>
<!-- q₁ -->
<g id="node2" class="node">
<title>q₁</title>
<ellipse fill="none" stroke="#010101" cx="223.12" cy="-18.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="223.12" cy="-18.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="223.12" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">q₁</text>
</g>
<!-- q₀&#45;&gt;q₁ -->
<g id="edge2" class="edge">
<title>q₀&#45;&gt;q₁</title>
<path fill="none" stroke="#010101" d="M105.62,-18.4C127.75,-18.4 166.87,-18.4 193.62,-18.4" />
<polygon fill="#010101" stroke="#010101" points="193.43,-21.9 203.43,-18.4 193.43,-14.9 193.43,-21.9" />
<text text-anchor="middle" x="162.72" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">ε, $ → ε</text>
</g>
<!-- q₀&#45;&gt;q₀ -->
<g id="edge3" class="edge">
<title>q₀&#45;&gt;q₀</title>
<path fill="none" stroke="#010101" d="M77.68,-33.19C74.41,-43.82 77.76,-54.4 87.72,-54.4 93.95,-54.4 97.59,-50.27 98.65,-44.57" />
<polygon fill="#010101" stroke="#010101" points="102.14,-44.4 97.88,-34.7 95.16,-44.94 102.14,-44.4" />
<text text-anchor="middle" x="87.72" y="-107.1" font-family="Times,serif" font-size="14.00" fill="#010101">ε, S → 1 S 0</text>
<text text-anchor="middle" x="87.72" y="-90.6" font-family="Times,serif" font-size="14.00" fill="#010101">ε, S → ε</text>
<text text-anchor="middle" x="87.72" y="-74.1" font-family="Times,serif" font-size="14.00" fill="#010101">0, 0 →ε</text>
<text text-anchor="middle" x="87.72" y="-57.6" font-family="Times,serif" font-size="14.00" fill="#010101">1, 1 → ε</text>
</g>
</g>
</svg>
</div>

<p>Here the stack grows left-to-right, so the lowest symbol on the stack is $ (end of stack), followed by S (the grammar start symbol). By the rules of the grammar we can manipulate the top of the stack and rewrite it to the body. If the input lines up with what we have on the stack, we can eliminate both. It’s simple, but inefficient because of all the nondeterminism.</p>

<h2 id="derivations-parse-trees-and-ambiguity">Derivations, Parse Trees and Ambiguity</h2>

<p>Let’s look at a slightly more interesting grammar from a parser perspective:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>S</mi><mo>+</mo><mi>S</mi></mrow><annotation encoding="application/x-tex"> S = S + S </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(add)</mtext></mrow><annotation encoding="application/x-tex"> \text{(add)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(add)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>S</mi><mo>∗</mo><mi>S</mi></mrow><annotation encoding="application/x-tex"> S = S * S </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(mul)</mtext></mrow><annotation encoding="application/x-tex"> \text{(mul)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(mul)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> S = 1     </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(</mtext><mi>ε</mi><mtext>)</mtext></mrow><annotation encoding="application/x-tex"> \text{(}\varepsilon\text{)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span></span><span class="mord mathnormal">ε</span><span class="mord text"><span class="mord">)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>When you want to derive <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> 1 + 1 * 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>, you can do this in all manner of ways. The following derivation picks just an arbitrary sort on which to apply a rule from the grammar:</p>

<ol>
  <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex"> S </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> (first S)</li>
  <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>+</mo><mi>S</mi></mrow><annotation encoding="application/x-tex"> S + S </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> (first S)</li>
  <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mi>S</mi></mrow><annotation encoding="application/x-tex"> 1 + S </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> (first S)</li>
  <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mi>S</mi><mo>∗</mo><mi>S</mi></mrow><annotation encoding="application/x-tex"> 1 + S * S </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> (second S)</li>
  <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mi>S</mi><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> 1 + S * 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> (first S)</li>
  <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> 1 + 1 * 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></li>
</ol>

<p>Notice how in some steps the leftmost <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> was replaced, while in others the rightmost was replaced. Generally speaking, you’ll want either a leftmost or a rightmost derivation for parsers, which is to say: a grammar rule is always applied to the leftmost or rightmost sort. There are three reasons for this. The first is that you want a parser to be predictable in when it applies grammar rules, as you may connect so-called <em>semantic actions</em> to each rule. These are pieces of code that are run when the parser applies the particular rule. (A typical example is a simple calculator). Such actions could perform side-effects, therefore order matters. For this reason, leftmost vs rightmost can also be observed. Two other reasons you to want this predictable derivation order is ease of implementation, and ease of proving things about your algorithm. These last two care less for whether it’s leftmost or rightmost.</p>

<p>The most common semantic actions I’m aware of is to build a syntax tree with a parser. This builds a tree structure out of the parsed text. A parse tree, or concrete syntax tree, contains all the rule applications as seen in the grammar. An abstract syntax tree abstracts over some parts of the syntax tree, such as leaving out whitespace, or parentheticals (the shape of the tree captures the precedence anyway), or injections (grammars rules of the form <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex"> S₁ = S₂ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>). Let’s look at some parse trees of the last example, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> 1 + 1 * 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Parse trees of 1 + (1 * 1) and (1 + 1) * 1 Pages: 1 -->
<svg role="img" aria-label="Parse trees of 1 + (1 * 1) and (1 + 1) * 1" width="530pt" height="188pt" viewBox="0.00 0.00 530.00 188.00">
<title>Parse trees of 1 + (1 * 1) and (1 + 1) * 1</title>
<desc>digraph &quot;Parse trees of 1 + (1 * 1) and (1 + 1) * 1&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;, label=S];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=TB;
subgraph {
Lfirst1 [label=1];
Lplus [label=&quot;+&quot;];
Lhidden [shape=none, label=&quot;&quot;, width=0.5];
Ladd;
Lsecond1 [label=1];
Lstar [label=&quot;*&quot;];
Lthird1 [label=1];
Lmul;
Ladd -&gt; Lfirst1;
Ladd -&gt; Lplus;
Ladd -&gt; Lhidden [style=&quot;invis&quot;];
Ladd -&gt; Lmul;
Lmul -&gt; Lsecond1;
Lmul -&gt; Lstar;
Lmul -&gt; Lthird1;
}
subgraph {
Rfirst1 [label=1];
Rplus [label=&quot;+&quot;];
Rsecond1 [label=1];
Radd;
Rhidden [shape=none, label=&quot;&quot;, width=0.5];
Rstar [label=&quot;*&quot;];
Rthird1 [label=1];
Rmul;
Rmul -&gt; Radd;
Rmul -&gt; Rhidden [style=&quot;invis&quot;];
Rmul -&gt; Rstar;
Rmul -&gt; Rthird1;
Radd -&gt; Rfirst1;
Radd -&gt; Rplus;
Radd -&gt; Rsecond1;
}
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>Parse trees of 1 + (1 * 1) and (1 + 1) * 1</title>
<!-- Lfirst1 -->
<g id="node1" class="node">
<title>Lfirst1</title>
<ellipse fill="none" stroke="#010101" cx="18" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="18" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- Lplus -->
<g id="node2" class="node">
<title>Lplus</title>
<ellipse fill="none" stroke="#010101" cx="72" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="72" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">+</text>
</g>
<!-- Lhidden -->
<g id="node3" class="node">
<title>Lhidden</title>
</g>
<!-- Ladd -->
<g id="node4" class="node">
<title>Ladd</title>
<ellipse fill="none" stroke="#010101" cx="99" cy="-162" rx="18" ry="18" />
<text text-anchor="middle" x="99" y="-156.95" font-family="Times,serif" font-size="14.00" fill="#010101">S</text>
</g>
<!-- Ladd&#45;&gt;Lfirst1 -->
<g id="edge1" class="edge">
<title>Ladd&#45;&gt;Lfirst1</title>
<path fill="none" stroke="#010101" d="M85.99,-149.75C73.47,-138.94 54.32,-122.39 39.53,-109.6" />
<polygon fill="#010101" stroke="#010101" points="41.98,-107.1 32.13,-103.21 37.4,-112.4 41.98,-107.1" />
</g>
<!-- Ladd&#45;&gt;Lplus -->
<g id="edge2" class="edge">
<title>Ladd&#45;&gt;Lplus</title>
<path fill="none" stroke="#010101" d="M92.87,-145.12C89.73,-136.97 85.82,-126.83 82.24,-117.54" />
<polygon fill="#010101" stroke="#010101" points="85.51,-116.3 78.65,-108.23 78.98,-118.82 85.51,-116.3" />
</g>
<!-- Ladd&#45;&gt;Lhidden -->
<!-- Lmul -->
<g id="node8" class="node">
<title>Lmul</title>
<ellipse fill="none" stroke="#010101" cx="180" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="180" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">S</text>
</g>
<!-- Ladd&#45;&gt;Lmul -->
<g id="edge4" class="edge">
<title>Ladd&#45;&gt;Lmul</title>
<path fill="none" stroke="#010101" d="M112.01,-149.75C124.53,-138.94 143.68,-122.39 158.47,-109.6" />
<polygon fill="#010101" stroke="#010101" points="160.6,-112.4 165.87,-103.21 156.02,-107.1 160.6,-112.4" />
</g>
<!-- Lsecond1 -->
<g id="node5" class="node">
<title>Lsecond1</title>
<ellipse fill="none" stroke="#010101" cx="126" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="126" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- Lstar -->
<g id="node6" class="node">
<title>Lstar</title>
<ellipse fill="none" stroke="#010101" cx="180" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="180" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">*</text>
</g>
<!-- Lthird1 -->
<g id="node7" class="node">
<title>Lthird1</title>
<ellipse fill="none" stroke="#010101" cx="234" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="234" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- Lmul&#45;&gt;Lsecond1 -->
<g id="edge5" class="edge">
<title>Lmul&#45;&gt;Lsecond1</title>
<path fill="none" stroke="#010101" d="M169.59,-75.5C162.12,-65.82 151.88,-52.55 143.21,-41.3" />
<polygon fill="#010101" stroke="#010101" points="146.18,-39.43 137.3,-33.65 140.64,-43.71 146.18,-39.43" />
</g>
<!-- Lmul&#45;&gt;Lstar -->
<g id="edge6" class="edge">
<title>Lmul&#45;&gt;Lstar</title>
<path fill="none" stroke="#010101" d="M180,-72.05C180,-64.57 180,-55.58 180,-47.14" />
<polygon fill="#010101" stroke="#010101" points="183.5,-47.3 180,-37.3 176.5,-47.3 183.5,-47.3" />
</g>
<!-- Lmul&#45;&gt;Lthird1 -->
<g id="edge7" class="edge">
<title>Lmul&#45;&gt;Lthird1</title>
<path fill="none" stroke="#010101" d="M190.41,-75.5C197.88,-65.82 208.12,-52.55 216.79,-41.3" />
<polygon fill="#010101" stroke="#010101" points="219.36,-43.71 222.7,-33.65 213.82,-39.43 219.36,-43.71" />
</g>
<!-- Rfirst1 -->
<g id="node9" class="node">
<title>Rfirst1</title>
<ellipse fill="none" stroke="#010101" cx="288" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="288" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- Rplus -->
<g id="node10" class="node">
<title>Rplus</title>
<ellipse fill="none" stroke="#010101" cx="342" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="342" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">+</text>
</g>
<!-- Rsecond1 -->
<g id="node11" class="node">
<title>Rsecond1</title>
<ellipse fill="none" stroke="#010101" cx="396" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="396" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- Radd -->
<g id="node12" class="node">
<title>Radd</title>
<ellipse fill="none" stroke="#010101" cx="342" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="342" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">S</text>
</g>
<!-- Radd&#45;&gt;Rfirst1 -->
<g id="edge12" class="edge">
<title>Radd&#45;&gt;Rfirst1</title>
<path fill="none" stroke="#010101" d="M331.59,-75.5C324.12,-65.82 313.88,-52.55 305.21,-41.3" />
<polygon fill="#010101" stroke="#010101" points="308.18,-39.43 299.3,-33.65 302.64,-43.71 308.18,-39.43" />
</g>
<!-- Radd&#45;&gt;Rplus -->
<g id="edge13" class="edge">
<title>Radd&#45;&gt;Rplus</title>
<path fill="none" stroke="#010101" d="M342,-72.05C342,-64.57 342,-55.58 342,-47.14" />
<polygon fill="#010101" stroke="#010101" points="345.5,-47.3 342,-37.3 338.5,-47.3 345.5,-47.3" />
</g>
<!-- Radd&#45;&gt;Rsecond1 -->
<g id="edge14" class="edge">
<title>Radd&#45;&gt;Rsecond1</title>
<path fill="none" stroke="#010101" d="M352.41,-75.5C359.88,-65.82 370.12,-52.55 378.79,-41.3" />
<polygon fill="#010101" stroke="#010101" points="381.36,-43.71 384.7,-33.65 375.82,-39.43 381.36,-43.71" />
</g>
<!-- Rhidden -->
<g id="node13" class="node">
<title>Rhidden</title>
</g>
<!-- Rstar -->
<g id="node14" class="node">
<title>Rstar</title>
<ellipse fill="none" stroke="#010101" cx="450" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="450" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">*</text>
</g>
<!-- Rthird1 -->
<g id="node15" class="node">
<title>Rthird1</title>
<ellipse fill="none" stroke="#010101" cx="504" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="504" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- Rmul -->
<g id="node16" class="node">
<title>Rmul</title>
<ellipse fill="none" stroke="#010101" cx="423" cy="-162" rx="18" ry="18" />
<text text-anchor="middle" x="423" y="-156.95" font-family="Times,serif" font-size="14.00" fill="#010101">S</text>
</g>
<!-- Rmul&#45;&gt;Radd -->
<g id="edge8" class="edge">
<title>Rmul&#45;&gt;Radd</title>
<path fill="none" stroke="#010101" d="M409.99,-149.75C397.47,-138.94 378.32,-122.39 363.53,-109.6" />
<polygon fill="#010101" stroke="#010101" points="365.98,-107.1 356.13,-103.21 361.4,-112.4 365.98,-107.1" />
</g>
<!-- Rmul&#45;&gt;Rhidden -->
<!-- Rmul&#45;&gt;Rstar -->
<g id="edge10" class="edge">
<title>Rmul&#45;&gt;Rstar</title>
<path fill="none" stroke="#010101" d="M429.13,-145.12C432.27,-136.97 436.18,-126.83 439.76,-117.54" />
<polygon fill="#010101" stroke="#010101" points="443.02,-118.82 443.35,-108.23 436.49,-116.3 443.02,-118.82" />
</g>
<!-- Rmul&#45;&gt;Rthird1 -->
<g id="edge11" class="edge">
<title>Rmul&#45;&gt;Rthird1</title>
<path fill="none" stroke="#010101" d="M436.01,-149.75C448.53,-138.94 467.68,-122.39 482.47,-109.6" />
<polygon fill="#010101" stroke="#010101" points="484.6,-112.4 489.87,-103.21 480.02,-107.1 484.6,-112.4" />
</g>
</g>
</svg>
</div>

<p>Notice how the leaves of the two trees are in the same order left-to-right as the input, but for the left tree the plus is higher up in the tree while in the right tree the star is higher up. If we want to interpreter the input as simple arithmetic, where multiplication binds tighter than addition, the left tree is the one we want. This is the predecedence of the operators, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∗</mo><mo>&gt;</mo><mo>+</mo></mrow><annotation encoding="application/x-tex"> * &gt; + </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">+</span></span></span></span>.</p>

<p>When you can get multiple trees like this, the grammar is called ambiguous. More formally, if you use only leftmost derivations (or only rightmost) and still find two distinct derivations that give the same sentence, the grammar is ambiguous. So to be clear: the above trees can be created with only leftmost derivations, it’s not a matter of choosing one or the other for the two trees. Derivation order (leftmost or rightmost) has to do with <em>side-effect order</em> of semantic actions only. When you build trees you don’t really need side-effects, so the derivation order has no effect on it.</p>

<p><strong>With that recap out of the way:</strong> For the purposes of <em>this</em> blog post, we’ll look at <em>un</em>ambiguous grammars for the languages we want to parse. Still, whether you use leftmost derivation or rightmost derivation in a parser that parses unambiguous grammars matters quite a lot in terms of what languages you can describe deterministically. It also influences how easily you can write a parser by hand for such a grammar, and how easily you can (programmatically) explain why your parser <em>doesn’t</em> accept certain inputs (parser error messages). So let’s have a look at LL and LR parsing techniques, where the first L in those abbreviations stands for Left-to-right (as in reading direction in text), and the second letters are respectively leftmost and rightmost derivation.</p>

<h1 id="topdown-strong-ll-parsing">Topdown, (Strong) LL parsing</h1>

<p>To take a good look at LL parsing, we will first work with a grammar that is not ambiguous or left-recursive:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>F</mi></mrow><annotation encoding="application/x-tex"> S = F </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">(</mo><mi>S</mi><mo>+</mo><mi>F</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> S = ( S + F ) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mclose">)</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex"> F = a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>So sort <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex"> S </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> is the start symbol, we also have sort <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex"> F </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>, and we have round brackets, plusses, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex"> a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>’s. This is enough information to create a table that, based on (1) the next sort to be parsed and (2) the next symbol in the input, predicts which rule from the grammar to use to parse the input further. In other words, if you know where you are in the input and grammar, you can look ahead at the next symbol of input and tell which <em>unique</em> grammar rule predicts the next bit of input (assuming the input fits the grammar). The table for the above grammar looks like so:</p>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">(</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">a</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span></td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">3</td>
    </tr>
  </tbody>
</table>

<p>A table like the above is an LL(1) parse table, because it uses only 1 symbol of “look-ahead” in the columns. LL(1) grammars are always strong LL grammars, which means that they only need the combination of the sort to be parsed and the next symbol(s) to decide on a unique grammar rule to apply. In general, LL(k) grammars do not have to be strong, and if they are not, you also need to know what was already parsed from the input (the “left context”) in order to choose a unique grammar rule<sup id="fnref:LLdef" role="doc-noteref"><a href="#fn:LLdef" class="footnote" rel="footnote">1</a></sup>. For example, the following grammar is LL(2), and not strong:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>A</mi><mtext> </mtext><mi>a</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>a</mi></mrow><annotation encoding="application/x-tex"> S = A\ a\ b\ A\ b\ a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">a</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex"> A = a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo></mrow><annotation encoding="application/x-tex"> A = </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>You can see this if you try to write an LL(2) parse table for it:</p>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">a a</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">a b</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">b a</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2,3</td>
      <td style="text-align: right">3</td>
    </tr>
  </tbody>
</table>

<p>If you look ahead to <code class="language-plaintext highlighter-rouge">a b</code> on the input, and the next sort is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, then it really depends on whether you are at the start of the input or in the middle of rule 1. If you’re at the start, you must choose rule 3 so you can parse <code class="language-plaintext highlighter-rouge">a b</code> as part of the rule 1, but if you’re already in the middle of rule 1, you must choose rule 2 for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> so you can continue to parse <code class="language-plaintext highlighter-rouge">b a</code> of rule 1.</p>

<p>If you mark <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> in rule 1 with where you are in rule 1 (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msub><mi>A</mi><mn>1</mn></msub><mtext> </mtext><mi>a</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><msub><mi>A</mi><mn>2</mn></msub><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>a</mi></mrow><annotation encoding="application/x-tex"> S = A₁\ a\ b\ A₂\ b\ a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">a</span></span></span></span>), you get an LL(2) grammar that is strong, although the table for it is larger<sup id="fnref:table" role="doc-noteref"><a href="#fn:table" class="footnote" rel="footnote">2</a></sup>:</p>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">a a</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">a b</code></th>
      <th style="text-align: right"><code class="language-plaintext highlighter-rouge">b a</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">A_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">A_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
      <td style="text-align: right"> </td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
    </tr>
  </tbody>
</table>

<p>In general, you can always use this trick to construct a strong, <em>structurally equivalent</em> LL grammar with the same look-ahead. This is quite useful for constructing simple LL parsers. However, the downside of these parsers is that on wrong input they can fail later than a more complicated LL(k) parser that works for the non-strong grammar. And that matters if you want to give nice error messages.</p>

<h3 id="an-intuition-for-table-construction-by-automaton">An intuition for table construction by automaton</h3>

<p>Building the above tables was a matter of keeping in mind what they mean, and squinting a little. But in the case of a larger grammar, or a parsetable generator, of course you want an exact process. Before I dive into <em>First</em> and <em>Follow</em> sets that are the traditional method for building these tables, let me give you a method that is less practical but in my opinion more intuitive.</p>

<p>Step 1: Let’s build a simple automaton for each rule of the grammar, where we assume both sorts and terminals are on the input.</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Simple automata for each grammar rule from the last example Pages: 1 -->
<svg role="img" aria-label="Simple automata for each grammar rule from the last example" width="561pt" height="153pt" viewBox="0.00 0.00 561.12 152.80">
<title>Simple automata for each grammar rule from the last example</title>
<desc>digraph &quot;Simple automata for each grammar rule from the last example&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;
subgraph {
start1 [shape=none, label=&quot;&quot;, width=0];
S₁ [shape=doublecircle, width=0.4];
start1 -&gt; S₁₀;
S₁₀ -&gt; S₁₁ [label=&quot;A&quot;];
S₁₁ -&gt; S₁₂ [label=&quot;a&quot;];
S₁₂ -&gt; S₁₃ [label=&quot;b&quot;];
S₁₃ -&gt; S₁₄ [label=&quot;A&quot;];
S₁₄ -&gt; S₁₅ [label=&quot;b&quot;];
S₁₅ -&gt; S₁ [label=&quot;a&quot;];
}
subgraph {
node [style=filled, fillcolor=&quot;#ddd&quot;];
start2 [style=&quot;&quot;, shape=none, label=&quot;&quot;, width=0];
A₂ [shape=doublecircle, width=0.4];
start2 -&gt; A₂₀;
A₂₀ -&gt; A₂ [label=&quot;a&quot;];
}
subgraph {
node [style=filled, fillcolor=&quot;#aaa&quot;];
start3 [style=&quot;&quot;, shape=none, label=&quot;&quot;, width=0];
A₃ [shape=doublecircle, width=0.4];
start3 -&gt; A₃;
}
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 148.8)">
<title>Simple automata for each grammar rule from the last example</title>
<!-- start1 -->
<g id="node1" class="node">
<title>start1</title>
</g>
<!-- S₁₀ -->
<g id="node3" class="node">
<title>S₁₀</title>
<ellipse fill="none" stroke="#010101" cx="56.12" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="56.12" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
</g>
<!-- start1&#45;&gt;S₁₀ -->
<g id="edge1" class="edge">
<title>start1&#45;&gt;S₁₀</title>
<path fill="none" stroke="#010101" d="M18.23,-18.4C21.06,-18.4 24.05,-18.4 27.05,-18.4" />
<polygon fill="#010101" stroke="#010101" points="26.87,-21.9 36.87,-18.4 26.87,-14.9 26.87,-21.9" />
</g>
<!-- S₁ -->
<g id="node2" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="534.72" cy="-18.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="534.72" cy="-18.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="534.72" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁₁ -->
<g id="node4" class="node">
<title>S₁₁</title>
<ellipse fill="none" stroke="#010101" cx="138.67" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="138.67" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
</g>
<!-- S₁₀&#45;&gt;S₁₁ -->
<g id="edge2" class="edge">
<title>S₁₀&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M73.81,-18.4C84.11,-18.4 97.59,-18.4 109.5,-18.4" />
<polygon fill="#010101" stroke="#010101" points="109.21,-21.9 119.21,-18.4 109.21,-14.9 109.21,-21.9" />
<text text-anchor="middle" x="97.4" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- S₁₂ -->
<g id="node5" class="node">
<title>S₁₂</title>
<ellipse fill="none" stroke="#010101" cx="217.07" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="217.07" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₂</text>
</g>
<!-- S₁₁&#45;&gt;S₁₂ -->
<g id="edge3" class="edge">
<title>S₁₁&#45;&gt;S₁₂</title>
<path fill="none" stroke="#010101" d="M156.63,-18.4C165.82,-18.4 177.43,-18.4 187.95,-18.4" />
<polygon fill="#010101" stroke="#010101" points="187.65,-21.9 197.65,-18.4 187.65,-14.9 187.65,-21.9" />
<text text-anchor="middle" x="178.07" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- S₁₃ -->
<g id="node6" class="node">
<title>S₁₃</title>
<ellipse fill="none" stroke="#010101" cx="295.82" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="295.82" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₃</text>
</g>
<!-- S₁₂&#45;&gt;S₁₃ -->
<g id="edge4" class="edge">
<title>S₁₂&#45;&gt;S₁₃</title>
<path fill="none" stroke="#010101" d="M234.72,-18.4C244.01,-18.4 255.83,-18.4 266.53,-18.4" />
<polygon fill="#010101" stroke="#010101" points="266.42,-21.9 276.42,-18.4 266.42,-14.9 266.42,-21.9" />
<text text-anchor="middle" x="256.44" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- S₁₄ -->
<g id="node7" class="node">
<title>S₁₄</title>
<ellipse fill="none" stroke="#010101" cx="377.57" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="377.57" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₄</text>
</g>
<!-- S₁₃&#45;&gt;S₁₄ -->
<g id="edge5" class="edge">
<title>S₁₃&#45;&gt;S₁₄</title>
<path fill="none" stroke="#010101" d="M313.73,-18.4C323.78,-18.4 336.77,-18.4 348.33,-18.4" />
<polygon fill="#010101" stroke="#010101" points="348.17,-21.9 358.17,-18.4 348.17,-14.9 348.17,-21.9" />
<text text-anchor="middle" x="336.69" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- S₁₅ -->
<g id="node8" class="node">
<title>S₁₅</title>
<ellipse fill="none" stroke="#010101" cx="456.32" cy="-18.4" rx="18" ry="18" />
<text text-anchor="middle" x="456.32" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₅</text>
</g>
<!-- S₁₄&#45;&gt;S₁₅ -->
<g id="edge6" class="edge">
<title>S₁₄&#45;&gt;S₁₅</title>
<path fill="none" stroke="#010101" d="M395.22,-18.4C404.51,-18.4 416.33,-18.4 427.03,-18.4" />
<polygon fill="#010101" stroke="#010101" points="426.92,-21.9 436.92,-18.4 426.92,-14.9 426.92,-21.9" />
<text text-anchor="middle" x="416.94" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- S₁₅&#45;&gt;S₁ -->
<g id="edge7" class="edge">
<title>S₁₅&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M474.28,-18.4C483.31,-18.4 494.67,-18.4 505.04,-18.4" />
<polygon fill="#010101" stroke="#010101" points="505.03,-21.9 515.03,-18.4 505.03,-14.9 505.03,-21.9" />
<text text-anchor="middle" x="495.32" y="-21.6" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- start2 -->
<g id="node9" class="node">
<title>start2</title>
</g>
<!-- A₂₀ -->
<g id="node11" class="node">
<title>A₂₀</title>
<ellipse fill="#dddddd" stroke="#010101" cx="56.12" cy="-72.4" rx="18" ry="18" />
<text text-anchor="middle" x="56.12" y="-67.35" font-family="Times,serif" font-size="14.00" fill="#010101">A₂₀</text>
</g>
<!-- start2&#45;&gt;A₂₀ -->
<g id="edge8" class="edge">
<title>start2&#45;&gt;A₂₀</title>
<path fill="none" stroke="#010101" d="M18.23,-72.4C21.06,-72.4 24.05,-72.4 27.05,-72.4" />
<polygon fill="#010101" stroke="#010101" points="26.87,-75.9 36.87,-72.4 26.87,-68.9 26.87,-75.9" />
</g>
<!-- A₂ -->
<g id="node10" class="node">
<title>A₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="138.67" cy="-72.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="138.67" cy="-72.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="138.67" y="-67.35" font-family="Times,serif" font-size="14.00" fill="#010101">A₂</text>
</g>
<!-- A₂₀&#45;&gt;A₂ -->
<g id="edge9" class="edge">
<title>A₂₀&#45;&gt;A₂</title>
<path fill="none" stroke="#010101" d="M73.81,-72.4C84.04,-72.4 97.4,-72.4 109.26,-72.4" />
<polygon fill="#010101" stroke="#010101" points="108.93,-75.9 118.93,-72.4 108.93,-68.9 108.93,-75.9" />
<text text-anchor="middle" x="97.4" y="-75.6" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- start3 -->
<g id="node12" class="node">
<title>start3</title>
</g>
<!-- A₃ -->
<g id="node13" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="56.12" cy="-126.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="56.12" cy="-126.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="56.12" y="-121.35" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- start3&#45;&gt;A₃ -->
<g id="edge10" class="edge">
<title>start3&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M18.23,-126.4C20.91,-126.4 23.72,-126.4 26.56,-126.4" />
<polygon fill="#010101" stroke="#010101" points="26.5,-129.9 36.5,-126.4 26.5,-122.9 26.5,-129.9" />
</g>
</g>
</svg>
</div>

<p>Note how each node of a rule automaton has the number of the rule followed by the offset into the body of the rule. The state represents where we are in the rule while parsing by that rule. The last node doesn’t have this offset so you can easily identify it, even when it’s no longer a final state.</p>

<p>Typically you’ll find texts on parsers display the position in a rule more visually with “LR item” notation. This uses the actual rule and a dot to indicate where we are in the rule. While this makes individual automata states more readable, it makes the automata large and therefore harder to display in a readable way as a whole. That’s why you won’t find that notation in this post’s automata. But just to illustrate an example of the notation:</p>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left">Shorthand in this blog</th>
      <th style="text-align: left">LR Item notation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">S₁₀</td>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi mathvariant="normal">.</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>a</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>a</mi></mrow><annotation encoding="application/x-tex"> S = .\ A\ a\ b\ A\ b\ a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">.</span><span class="mspace"> </span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">a</span></span></span></span></td>
    </tr>
    <tr>
      <td style="text-align: left">S₁₁</td>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>A</mi><mtext> </mtext><mi mathvariant="normal">.</mi><mtext> </mtext><mi>a</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>a</mi></mrow><annotation encoding="application/x-tex"> S = A\ .\ a\ b\ A\ b\ a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord">.</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">a</span></span></span></span></td>
    </tr>
    <tr>
      <td style="text-align: left">S₁₅</td>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>A</mi><mtext> </mtext><mi>a</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi mathvariant="normal">.</mi><mtext> </mtext><mi>a</mi></mrow><annotation encoding="application/x-tex"> S = A\ a\ b\ A\ b\ .\ a </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord">.</span><span class="mspace"> </span><span class="mord mathnormal">a</span></span></span></span></td>
    </tr>
    <tr>
      <td style="text-align: left">S₁</td>
      <td style="text-align: left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>A</mi><mtext> </mtext><mi>a</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>a</mi><mtext> </mtext><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex"> S = A\ a\ b\ A\ b\ a\ . </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord">.</span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>Step 2: Now instead of consuming a sort with an automaton, we’ll use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span> rules to jump to the automata of the rules for that sort instead. We’ll use the PDA stack with unique labels to get back to where you would be after consuming the sort.</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Single PDA using the automata from the grammar rules Pages: 1 -->
<svg role="img" aria-label="Single PDA using the automata from the grammar rules" width="560pt" height="200pt" viewBox="0.00 0.00 559.77 199.87">
<title>Single PDA using the automata from the grammar rules</title>
<desc>digraph &quot;Single PDA using the automata from the grammar rules&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

start1 [shape=none, label=&quot;&quot;, width=0];
S₁ [shape=doublecircle, width=0.4];
subgraph {
rank=same;
edge [style=invis];
A₂₀ [style=filled, fillcolor=&quot;#ddd&quot;];
S₁₀ -&gt; A₂₀;
}
subgraph {
rank=same;
edge [style=invis];
A₂ [style=filled, fillcolor=&quot;#ddd&quot;];
A₃ [style=filled, fillcolor=&quot;#aaa&quot;];
A₃ -&gt; S₁₁;
S₁₁ -&gt; A₂;
}
subgraph {
start1 -&gt; S₁₀;
S₁₀ -&gt; S₁₁ [label=&quot;A&quot;, fontcolor=&quot;#01010140&quot;, color=&quot;#01010140&quot;];
S₁₁ -&gt; S₁₂ [label=&quot;a&quot;];
S₁₂ -&gt; S₁₃ [label=&quot;b&quot;];
S₁₃ -&gt; S₁₄ [label=&quot;A&quot;, fontcolor=&quot;#01010140&quot;, color=&quot;#01010140&quot;];
S₁₄ -&gt; S₁₅ [label=&quot;b&quot;];
S₁₅ -&gt; S₁ [label=&quot;a&quot;];
}

subgraph {
A₂₀ -&gt; A₂ [label=&quot;a&quot;];
}

S₁₀ -&gt; A₂₀ [taillabel=&quot;↓S₁₁&quot;, labelangle=70, labeldistance=1.5, constraint=false];
A₂ -&gt; S₁₁ [taillabel=&quot;↑S₁₁&quot;, labelangle=-60, labeldistance=2, constraint=false];
S₁₀ -&gt; A₃ [taillabel=&quot;↓S₁₁&quot;, labelangle=60, labeldistance=1.75, constraint=false];
A₃ -&gt; S₁₁ [taillabel=&quot;↑S₁₁&quot;, labelangle=60, labeldistance=2, constraint=false];

S₁₃ -&gt; A₂₀ [taillabel=&quot;↓S₁₄&quot;, labelangle=-35, labeldistance=3, constraint=false];
A₂ -&gt; S₁₄ [taillabel=&quot;↑S₁₄&quot;, labelangle=40, labeldistance=2, constraint=false];
S₁₃ -&gt; A₃ [taillabel=&quot;↓S₁₄&quot;, labelangle=-50, labeldistance=2, constraint=false];
A₃ -&gt; S₁₄ [taillabel=&quot;↑ S₁₄&quot;, labelangle=40, labeldistance=2, constraint=false];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 195.87)">
<title>Single PDA using the automata from the grammar rules</title>
<!-- start1 -->
<g id="node1" class="node">
<title>start1</title>
</g>
<!-- S₁₀ -->
<g id="node4" class="node">
<title>S₁₀</title>
<ellipse fill="none" stroke="#010101" cx="55.84" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="55.84" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
</g>
<!-- start1&#45;&gt;S₁₀ -->
<g id="edge4" class="edge">
<title>start1&#45;&gt;S₁₀</title>
<path fill="none" stroke="#010101" d="M18.14,-101.87C20.96,-101.87 23.93,-101.87 26.91,-101.87" />
<polygon fill="#010101" stroke="#010101" points="26.68,-105.37 36.68,-101.87 26.68,-98.37 26.68,-105.37" />
</g>
<!-- S₁ -->
<g id="node2" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="533.37" cy="-101.87" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="533.37" cy="-101.87" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="533.37" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- A₂₀ -->
<g id="node3" class="node">
<title>A₂₀</title>
<ellipse fill="#dddddd" stroke="#010101" cx="55.84" cy="-29.87" rx="18" ry="18" />
<text text-anchor="middle" x="55.84" y="-24.82" font-family="Times,serif" font-size="14.00" fill="#010101">A₂₀</text>
</g>
<!-- A₂ -->
<g id="node5" class="node">
<title>A₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="137.72" cy="-29.87" rx="18" ry="18" />
<text text-anchor="middle" x="137.72" y="-24.82" font-family="Times,serif" font-size="14.00" fill="#010101">A₂</text>
</g>
<!-- A₂₀&#45;&gt;A₂ -->
<g id="edge11" class="edge">
<title>A₂₀&#45;&gt;A₂</title>
<path fill="none" stroke="#010101" d="M73.78,-29.87C83.84,-29.87 96.86,-29.87 108.44,-29.87" />
<polygon fill="#010101" stroke="#010101" points="108.29,-33.37 118.29,-29.87 108.29,-26.37 108.29,-33.37" />
<text text-anchor="middle" x="96.84" y="-33.07" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- S₁₀&#45;&gt;A₂₀ -->
<!-- S₁₀&#45;&gt;A₂₀ -->
<g id="edge12" class="edge">
<title>S₁₀&#45;&gt;A₂₀</title>
<path fill="none" stroke="#010101" d="M46.68,-86.41C42.34,-76.35 41.19,-66.3 43.22,-56.25" />
<polygon fill="#010101" stroke="#010101" points="46.54,-57.37 46.22,-46.78 39.86,-55.26 46.54,-57.37" />
<text text-anchor="middle" x="57.87" y="-71.37" font-family="Times,serif" font-size="14.00" fill="#010101">↓S₁₁</text>
</g>
<!-- A₃ -->
<g id="node6" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="137.72" cy="-173.87" rx="18" ry="18" />
<text text-anchor="middle" x="137.72" y="-168.82" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- S₁₀&#45;&gt;A₃ -->
<g id="edge14" class="edge">
<title>S₁₀&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M69.33,-113.12C81.68,-124.25 100.83,-141.51 115.56,-154.79" />
<polygon fill="#010101" stroke="#010101" points="113.17,-157.35 122.94,-161.44 117.85,-152.15 113.17,-157.35" />
<text text-anchor="middle" x="65.68" y="-125.18" font-family="Times,serif" font-size="14.00" fill="#010101">↓S₁₁</text>
</g>
<!-- S₁₁ -->
<g id="node7" class="node">
<title>S₁₁</title>
<ellipse fill="none" stroke="#010101" cx="137.72" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="137.72" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
</g>
<!-- S₁₀&#45;&gt;S₁₁ -->
<g id="edge5" class="edge">
<title>S₁₀&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" stroke-opacity="0.250980" d="M73.78,-101.87C83.84,-101.87 96.86,-101.87 108.44,-101.87" />
<polygon fill="#010101" fill-opacity="0.250980" stroke="#010101" stroke-opacity="0.250980" points="108.29,-105.37 118.29,-101.87 108.29,-98.37 108.29,-105.37" />
<text text-anchor="middle" x="96.84" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101" fill-opacity="0.250980">A</text>
</g>
<!-- A₂&#45;&gt;S₁₁ -->
<g id="edge13" class="edge">
<title>A₂&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M128.61,-45.33C124.31,-55.39 123.17,-65.44 125.19,-75.5" />
<polygon fill="#010101" stroke="#010101" points="121.82,-76.47 128.16,-84.96 128.5,-74.38 121.82,-76.47" />
<text text-anchor="middle" x="141.03" y="-55.96" font-family="Times,serif" font-size="14.00" fill="#010101">↑S₁₁</text>
</g>
<!-- S₁₄ -->
<g id="node10" class="node">
<title>S₁₄</title>
<ellipse fill="none" stroke="#010101" cx="376.22" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="376.22" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₄</text>
</g>
<!-- A₂&#45;&gt;S₁₄ -->
<g id="edge17" class="edge">
<title>A₂&#45;&gt;S₁₄</title>
<path fill="none" stroke="#010101" d="M155.26,-33.26C186.43,-39.86 255.87,-55.49 312.47,-74.87 324.92,-79.13 338.38,-84.77 349.62,-89.8" />
<polygon fill="#010101" stroke="#010101" points="348.08,-92.94 358.63,-93.91 350.99,-86.57 348.08,-92.94" />
<text text-anchor="middle" x="167.53" y="-44" font-family="Times,serif" font-size="14.00" fill="#010101">↑S₁₄</text>
</g>
<!-- A₃&#45;&gt;S₁₁ -->
<!-- A₃&#45;&gt;S₁₁ -->
<g id="edge15" class="edge">
<title>A₃&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M128.62,-158.41C124.31,-148.35 123.17,-138.3 125.18,-128.25" />
<polygon fill="#010101" stroke="#010101" points="128.5,-129.37 128.16,-118.78 121.82,-127.27 128.5,-129.37" />
<text text-anchor="middle" x="141.03" y="-137.68" font-family="Times,serif" font-size="14.00" fill="#010101">↑S₁₁</text>
</g>
<!-- A₃&#45;&gt;S₁₄ -->
<g id="edge19" class="edge">
<title>A₃&#45;&gt;S₁₄</title>
<path fill="none" stroke="#010101" d="M155.47,-171.33C190.75,-165.6 274.82,-149.94 340.22,-121.87 343.87,-120.3 347.62,-118.45 351.24,-116.51" />
<polygon fill="#010101" stroke="#010101" points="352.67,-119.72 359.64,-111.75 349.21,-113.64 352.67,-119.72" />
<text text-anchor="middle" x="172.72" y="-176.41" font-family="Times,serif" font-size="14.00" fill="#010101">↑ S₁₄</text>
</g>
<!-- S₁₁&#45;&gt;A₂ -->
<!-- S₁₂ -->
<g id="node8" class="node">
<title>S₁₂</title>
<ellipse fill="none" stroke="#010101" cx="215.72" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="215.72" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₂</text>
</g>
<!-- S₁₁&#45;&gt;S₁₂ -->
<g id="edge6" class="edge">
<title>S₁₁&#45;&gt;S₁₂</title>
<path fill="none" stroke="#010101" d="M155.59,-101.87C164.64,-101.87 176.04,-101.87 186.41,-101.87" />
<polygon fill="#010101" stroke="#010101" points="186.39,-105.37 196.39,-101.87 186.39,-98.37 186.39,-105.37" />
<text text-anchor="middle" x="176.72" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- S₁₃ -->
<g id="node9" class="node">
<title>S₁₃</title>
<ellipse fill="none" stroke="#010101" cx="294.47" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="294.47" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₃</text>
</g>
<!-- S₁₂&#45;&gt;S₁₃ -->
<g id="edge7" class="edge">
<title>S₁₂&#45;&gt;S₁₃</title>
<path fill="none" stroke="#010101" d="M233.37,-101.87C242.66,-101.87 254.48,-101.87 265.18,-101.87" />
<polygon fill="#010101" stroke="#010101" points="265.07,-105.37 275.07,-101.87 265.07,-98.37 265.07,-105.37" />
<text text-anchor="middle" x="255.09" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- S₁₃&#45;&gt;A₂₀ -->
<g id="edge16" class="edge">
<title>S₁₃&#45;&gt;A₂₀</title>
<path fill="none" stroke="#010101" d="M281.7,-89.26C259.62,-66.64 209.32,-19.93 155.72,-2.87 130.42,5.19 101.03,-5.32 80.91,-15.48" />
<polygon fill="#010101" stroke="#010101" points="79.5,-12.27 72.37,-20.1 82.83,-18.42 79.5,-12.27" />
<text text-anchor="middle" x="252.16" y="-78.98" font-family="Times,serif" font-size="14.00" fill="#010101">↓S₁₄</text>
</g>
<!-- S₁₃&#45;&gt;A₃ -->
<g id="edge18" class="edge">
<title>S₁₃&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M279.07,-110.69C272.84,-114.35 265.4,-118.52 258.47,-121.87 221.93,-139.53 210.64,-139.01 173.72,-155.87 170.47,-157.35 167.08,-158.98 163.76,-160.63" />
<polygon fill="#010101" stroke="#010101" points="162.22,-157.49 154.9,-165.16 165.4,-163.72 162.22,-157.49" />
<text text-anchor="middle" x="275.69" y="-125.36" font-family="Times,serif" font-size="14.00" fill="#010101">↓S₁₄</text>
</g>
<!-- S₁₃&#45;&gt;S₁₄ -->
<g id="edge8" class="edge">
<title>S₁₃&#45;&gt;S₁₄</title>
<path fill="none" stroke="#010101" stroke-opacity="0.250980" d="M312.38,-101.87C322.43,-101.87 335.42,-101.87 346.98,-101.87" />
<polygon fill="#010101" fill-opacity="0.250980" stroke="#010101" stroke-opacity="0.250980" points="346.82,-105.37 356.82,-101.87 346.82,-98.37 346.82,-105.37" />
<text text-anchor="middle" x="335.34" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101" fill-opacity="0.250980">A</text>
</g>
<!-- S₁₅ -->
<g id="node11" class="node">
<title>S₁₅</title>
<ellipse fill="none" stroke="#010101" cx="454.97" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="454.97" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₅</text>
</g>
<!-- S₁₄&#45;&gt;S₁₅ -->
<g id="edge9" class="edge">
<title>S₁₄&#45;&gt;S₁₅</title>
<path fill="none" stroke="#010101" d="M393.87,-101.87C403.16,-101.87 414.98,-101.87 425.68,-101.87" />
<polygon fill="#010101" stroke="#010101" points="425.57,-105.37 435.57,-101.87 425.57,-98.37 425.57,-105.37" />
<text text-anchor="middle" x="415.59" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- S₁₅&#45;&gt;S₁ -->
<g id="edge10" class="edge">
<title>S₁₅&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M472.93,-101.87C481.96,-101.87 493.32,-101.87 503.69,-101.87" />
<polygon fill="#010101" stroke="#010101" points="503.68,-105.37 513.68,-101.87 503.68,-98.37 503.68,-105.37" />
<text text-anchor="middle" x="493.97" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
</g>
</svg>
</div>

<p>The <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>↓</mo><mrow></mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">\downarrow{}X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel">↓</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> is an abbreviation for an <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi><mo separator="true">,</mo><mi>ε</mi><mo>→</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">\varepsilon, \varepsilon \rightarrow X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ε</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ε</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> edge that pushes a symbol on the stack unconditionally, it was hard to get graphviz to cooperate on node placement of this graph otherwise… Now at every node that had a sort transition you have multiple transition options, these are where you need to look ahead. Soooo…</p>

<p>Step 3: at a sort transition node, for each <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>↓</mo></mrow><annotation encoding="application/x-tex">\downarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel">↓</span></span></span></span> transition, follow transitions until you’ve consumed <em>k</em> terminals (2 in this example) from the input. These are the terminals of the column in the parse table, and the rule of the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>↓</mo></mrow><annotation encoding="application/x-tex">\downarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel">↓</span></span></span></span> transition gets put into that cell. You can also put the look-ahead into the automaton:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Single PDA using the automata from the grammar rules Pages: 1 -->
<svg role="img" aria-label="Single PDA using the automata from the grammar rules" width="560pt" height="200pt" viewBox="0.00 0.00 559.77 199.87">
<title>Single PDA using the automata from the grammar rules</title>
<desc>digraph &quot;Single PDA using the automata from the grammar rules&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

start1 [shape=none, label=&quot;&quot;, width=0];
S₁ [shape=doublecircle, width=0.4];
subgraph {
rank=same;
edge [style=invis];
A₂₀ [style=filled, fillcolor=&quot;#ddd&quot;];
S₁₀ -&gt; A₂₀;
}
subgraph {
rank=same;
edge [style=invis];
A₂ [style=filled, fillcolor=&quot;#ddd&quot;];
A₃ [style=filled, fillcolor=&quot;#aaa&quot;];
A₃ -&gt; S₁₁;
S₁₁ -&gt; A₂;
}
subgraph {
start1 -&gt; S₁₀;
S₁₀ -&gt; S₁₁ [label=&quot;A&quot;, fontcolor=&quot;#01010140&quot;, color=&quot;#01010140&quot;];
S₁₁ -&gt; S₁₂ [label=&quot;a&quot;];
S₁₂ -&gt; S₁₃ [label=&quot;b&quot;];
S₁₃ -&gt; S₁₄ [label=&quot;A&quot;, fontcolor=&quot;#01010140&quot;, color=&quot;#01010140&quot;];
S₁₄ -&gt; S₁₅ [label=&quot;b&quot;];
S₁₅ -&gt; S₁ [label=&quot;a&quot;];
}

subgraph {
A₂₀ -&gt; A₂ [label=&quot;a&quot;];
}

S₁₀ -&gt; A₂₀ [taillabel=&quot;(aa), ↓S₁₁&quot;, labelangle=0, labeldistance=1.5, constraint=false];
A₂ -&gt; S₁₁ [taillabel=&quot;↑S₁₁&quot;, labelangle=-60, labeldistance=2, constraint=false];
S₁₀ -&gt; A₃ [taillabel=&quot;(ab), ↓S₁₁&quot;, labelangle=80, labeldistance=2.5, constraint=false];
A₃ -&gt; S₁₁ [taillabel=&quot;↑S₁₁&quot;, labelangle=60, labeldistance=2, constraint=false];

S₁₃ -&gt; A₂₀ [taillabel=&quot;(ab), ↓S₁₄&quot;, labelangle=-30, labeldistance=5, constraint=false];
A₂ -&gt; S₁₄ [taillabel=&quot;↑S₁₄&quot;, labelangle=40, labeldistance=2, constraint=false];
S₁₃ -&gt; A₃ [taillabel=&quot;(ba), ↓S₁₄&quot;, labelangle=-60 labeldistance=2, constraint=false];
A₃ -&gt; S₁₄ [taillabel=&quot;↑ S₁₄&quot;, labelangle=40, labeldistance=2, constraint=false];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 195.87)">
<title>Single PDA using the automata from the grammar rules</title>
<!-- start1 -->
<g id="node1" class="node">
<title>start1</title>
</g>
<!-- S₁₀ -->
<g id="node4" class="node">
<title>S₁₀</title>
<ellipse fill="none" stroke="#010101" cx="55.84" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="55.84" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
</g>
<!-- start1&#45;&gt;S₁₀ -->
<g id="edge4" class="edge">
<title>start1&#45;&gt;S₁₀</title>
<path fill="none" stroke="#010101" d="M18.14,-101.87C20.96,-101.87 23.93,-101.87 26.91,-101.87" />
<polygon fill="#010101" stroke="#010101" points="26.68,-105.37 36.68,-101.87 26.68,-98.37 26.68,-105.37" />
</g>
<!-- S₁ -->
<g id="node2" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="533.37" cy="-101.87" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="533.37" cy="-101.87" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="533.37" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- A₂₀ -->
<g id="node3" class="node">
<title>A₂₀</title>
<ellipse fill="#dddddd" stroke="#010101" cx="55.84" cy="-29.87" rx="18" ry="18" />
<text text-anchor="middle" x="55.84" y="-24.82" font-family="Times,serif" font-size="14.00" fill="#010101">A₂₀</text>
</g>
<!-- A₂ -->
<g id="node5" class="node">
<title>A₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="137.72" cy="-29.87" rx="18" ry="18" />
<text text-anchor="middle" x="137.72" y="-24.82" font-family="Times,serif" font-size="14.00" fill="#010101">A₂</text>
</g>
<!-- A₂₀&#45;&gt;A₂ -->
<g id="edge11" class="edge">
<title>A₂₀&#45;&gt;A₂</title>
<path fill="none" stroke="#010101" d="M73.78,-29.87C83.84,-29.87 96.86,-29.87 108.44,-29.87" />
<polygon fill="#010101" stroke="#010101" points="108.29,-33.37 118.29,-29.87 108.29,-26.37 108.29,-33.37" />
<text text-anchor="middle" x="96.84" y="-33.07" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- S₁₀&#45;&gt;A₂₀ -->
<!-- S₁₀&#45;&gt;A₂₀ -->
<g id="edge12" class="edge">
<title>S₁₀&#45;&gt;A₂₀</title>
<path fill="none" stroke="#010101" d="M46.68,-86.41C42.34,-76.35 41.19,-66.3 43.22,-56.25" />
<polygon fill="#010101" stroke="#010101" points="46.54,-57.37 46.22,-46.78 39.86,-55.26 46.54,-57.37" />
<text text-anchor="middle" x="41.12" y="-67.43" font-family="Times,serif" font-size="14.00" fill="#010101">(aa), ↓S₁₁</text>
</g>
<!-- A₃ -->
<g id="node6" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="137.72" cy="-173.87" rx="18" ry="18" />
<text text-anchor="middle" x="137.72" y="-168.82" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- S₁₀&#45;&gt;A₃ -->
<g id="edge14" class="edge">
<title>S₁₀&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M69.33,-113.12C81.68,-124.25 100.83,-141.51 115.56,-154.79" />
<polygon fill="#010101" stroke="#010101" points="113.17,-157.35 122.94,-161.44 117.85,-152.15 113.17,-157.35" />
<text text-anchor="middle" x="56.07" y="-129.26" font-family="Times,serif" font-size="14.00" fill="#010101">(ab), ↓S₁₁</text>
</g>
<!-- S₁₁ -->
<g id="node7" class="node">
<title>S₁₁</title>
<ellipse fill="none" stroke="#010101" cx="137.72" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="137.72" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
</g>
<!-- S₁₀&#45;&gt;S₁₁ -->
<g id="edge5" class="edge">
<title>S₁₀&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" stroke-opacity="0.250980" d="M73.78,-101.87C83.84,-101.87 96.86,-101.87 108.44,-101.87" />
<polygon fill="#010101" fill-opacity="0.250980" stroke="#010101" stroke-opacity="0.250980" points="108.29,-105.37 118.29,-101.87 108.29,-98.37 108.29,-105.37" />
<text text-anchor="middle" x="96.84" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101" fill-opacity="0.250980">A</text>
</g>
<!-- A₂&#45;&gt;S₁₁ -->
<g id="edge13" class="edge">
<title>A₂&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M128.61,-45.33C124.31,-55.39 123.17,-65.44 125.19,-75.5" />
<polygon fill="#010101" stroke="#010101" points="121.82,-76.47 128.16,-84.96 128.5,-74.38 121.82,-76.47" />
<text text-anchor="middle" x="141.03" y="-55.96" font-family="Times,serif" font-size="14.00" fill="#010101">↑S₁₁</text>
</g>
<!-- S₁₄ -->
<g id="node10" class="node">
<title>S₁₄</title>
<ellipse fill="none" stroke="#010101" cx="376.22" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="376.22" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₄</text>
</g>
<!-- A₂&#45;&gt;S₁₄ -->
<g id="edge17" class="edge">
<title>A₂&#45;&gt;S₁₄</title>
<path fill="none" stroke="#010101" d="M155.26,-33.26C186.43,-39.86 255.87,-55.49 312.47,-74.87 324.92,-79.13 338.38,-84.77 349.62,-89.8" />
<polygon fill="#010101" stroke="#010101" points="348.08,-92.94 358.63,-93.91 350.99,-86.57 348.08,-92.94" />
<text text-anchor="middle" x="167.53" y="-44" font-family="Times,serif" font-size="14.00" fill="#010101">↑S₁₄</text>
</g>
<!-- A₃&#45;&gt;S₁₁ -->
<!-- A₃&#45;&gt;S₁₁ -->
<g id="edge15" class="edge">
<title>A₃&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M128.62,-158.41C124.31,-148.35 123.17,-138.3 125.18,-128.25" />
<polygon fill="#010101" stroke="#010101" points="128.5,-129.37 128.16,-118.78 121.82,-127.27 128.5,-129.37" />
<text text-anchor="middle" x="141.03" y="-137.68" font-family="Times,serif" font-size="14.00" fill="#010101">↑S₁₁</text>
</g>
<!-- A₃&#45;&gt;S₁₄ -->
<g id="edge19" class="edge">
<title>A₃&#45;&gt;S₁₄</title>
<path fill="none" stroke="#010101" d="M155.47,-171.33C190.75,-165.6 274.82,-149.94 340.22,-121.87 343.87,-120.3 347.62,-118.45 351.24,-116.51" />
<polygon fill="#010101" stroke="#010101" points="352.67,-119.72 359.64,-111.75 349.21,-113.64 352.67,-119.72" />
<text text-anchor="middle" x="172.72" y="-176.41" font-family="Times,serif" font-size="14.00" fill="#010101">↑ S₁₄</text>
</g>
<!-- S₁₁&#45;&gt;A₂ -->
<!-- S₁₂ -->
<g id="node8" class="node">
<title>S₁₂</title>
<ellipse fill="none" stroke="#010101" cx="215.72" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="215.72" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₂</text>
</g>
<!-- S₁₁&#45;&gt;S₁₂ -->
<g id="edge6" class="edge">
<title>S₁₁&#45;&gt;S₁₂</title>
<path fill="none" stroke="#010101" d="M155.59,-101.87C164.64,-101.87 176.04,-101.87 186.41,-101.87" />
<polygon fill="#010101" stroke="#010101" points="186.39,-105.37 196.39,-101.87 186.39,-98.37 186.39,-105.37" />
<text text-anchor="middle" x="176.72" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- S₁₃ -->
<g id="node9" class="node">
<title>S₁₃</title>
<ellipse fill="none" stroke="#010101" cx="294.47" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="294.47" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₃</text>
</g>
<!-- S₁₂&#45;&gt;S₁₃ -->
<g id="edge7" class="edge">
<title>S₁₂&#45;&gt;S₁₃</title>
<path fill="none" stroke="#010101" d="M233.37,-101.87C242.66,-101.87 254.48,-101.87 265.18,-101.87" />
<polygon fill="#010101" stroke="#010101" points="265.07,-105.37 275.07,-101.87 265.07,-98.37 265.07,-105.37" />
<text text-anchor="middle" x="255.09" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- S₁₃&#45;&gt;A₂₀ -->
<g id="edge16" class="edge">
<title>S₁₃&#45;&gt;A₂₀</title>
<path fill="none" stroke="#010101" d="M281.7,-89.26C259.62,-66.64 209.32,-19.93 155.72,-2.87 130.42,5.19 101.03,-5.32 80.91,-15.48" />
<polygon fill="#010101" stroke="#010101" points="79.5,-12.27 72.37,-20.1 82.83,-18.42 79.5,-12.27" />
<text text-anchor="middle" x="233.42" y="-71.24" font-family="Times,serif" font-size="14.00" fill="#010101">(ab), ↓S₁₄</text>
</g>
<!-- S₁₃&#45;&gt;A₃ -->
<g id="edge18" class="edge">
<title>S₁₃&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M279.07,-110.69C272.84,-114.35 265.4,-118.52 258.47,-121.87 221.93,-139.53 210.64,-139.01 173.72,-155.87 170.47,-157.35 167.08,-158.98 163.76,-160.63" />
<polygon fill="#010101" stroke="#010101" points="162.22,-157.49 154.9,-165.16 165.4,-163.72 162.22,-157.49" />
<text text-anchor="middle" x="279.17" y="-125.64" font-family="Times,serif" font-size="14.00" fill="#010101">(ba), ↓S₁₄</text>
</g>
<!-- S₁₃&#45;&gt;S₁₄ -->
<g id="edge8" class="edge">
<title>S₁₃&#45;&gt;S₁₄</title>
<path fill="none" stroke="#010101" stroke-opacity="0.250980" d="M312.38,-101.87C322.43,-101.87 335.42,-101.87 346.98,-101.87" />
<polygon fill="#010101" fill-opacity="0.250980" stroke="#010101" stroke-opacity="0.250980" points="346.82,-105.37 356.82,-101.87 346.82,-98.37 346.82,-105.37" />
<text text-anchor="middle" x="335.34" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101" fill-opacity="0.250980">A</text>
</g>
<!-- S₁₅ -->
<g id="node11" class="node">
<title>S₁₅</title>
<ellipse fill="none" stroke="#010101" cx="454.97" cy="-101.87" rx="18" ry="18" />
<text text-anchor="middle" x="454.97" y="-96.82" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₅</text>
</g>
<!-- S₁₄&#45;&gt;S₁₅ -->
<g id="edge9" class="edge">
<title>S₁₄&#45;&gt;S₁₅</title>
<path fill="none" stroke="#010101" d="M393.87,-101.87C403.16,-101.87 414.98,-101.87 425.68,-101.87" />
<polygon fill="#010101" stroke="#010101" points="425.57,-105.37 435.57,-101.87 425.57,-98.37 425.57,-105.37" />
<text text-anchor="middle" x="415.59" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- S₁₅&#45;&gt;S₁ -->
<g id="edge10" class="edge">
<title>S₁₅&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M472.93,-101.87C481.96,-101.87 493.32,-101.87 503.69,-101.87" />
<polygon fill="#010101" stroke="#010101" points="503.68,-105.37 513.68,-101.87 503.68,-98.37 503.68,-105.37" />
<text text-anchor="middle" x="493.97" y="-105.07" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
</g>
</svg>
</div>

<h3 id="building-ll-tables-for-strong-ll-grammars-by-traditional-method">Building LL tables for strong LL grammars by traditional method</h3>

<p>While the above building of automata gives a visual intuition, it’s not the most efficient way to express how we can build LL tables. The traditional method does the same thing in essence, but using some pre-computed sets to calculate the cells in the table.</p>

<p>A cell at the row labeled with sort <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> and the column labeled with terminal(s) <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> should have the grammar rule <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>w</mi></mrow><annotation encoding="application/x-tex">A = w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> (where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> is a mix of terminals and sorts or <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span>), under the following condition: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> is in the <em>First</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span>, or <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span> is in the <em>First</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> is in the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>. In other words: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>∈</mo><mtext mathvariant="italic">First</mtext><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>⋅</mo><mtext mathvariant="italic">Follow</mtext><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v \in \textit{First}(w) \cdot \textit{Follow}(A)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textit">First</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textit">Follow</span></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span></span></span></span></p>

<p>Let’s unpack that. The <em>First</em> set of a terminal is a singleton set with that terminal. The <em>First</em> set of a sort is the set of first non-terminals that the sort can expand to, directly or indirectly. So a rule <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>a</mi><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle></mrow><annotation encoding="application/x-tex">A = a \textrm{\footnotesize[...]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8em;vertical-align:-0.2em;"></span><span class="mord mathnormal">a</span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span></span></span></span> causes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> to appear in the <em>First</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>B</mi><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle></mrow><annotation encoding="application/x-tex">A = B \textrm{\footnotesize[...]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8833em;vertical-align:-0.2em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span></span></span></span> causes the <em>First</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> to be included in the <em>First</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>ε</mi></mrow><annotation encoding="application/x-tex">A = \varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span> causes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span> to appear in the <em>First</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>. This last rule says <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> can be expanded to “nothing”, so if that’s an option we need to check the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>.</p>

<p>The <em>Follow</em> set is basically every non-terminal that can follow <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> in the grammar. So when you have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle><mi>A</mi><mtext> </mtext><mi>a</mi><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle></mrow><annotation encoding="application/x-tex">B = \textrm{\footnotesize[...]} A\ a \textrm{\footnotesize[...]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8833em;vertical-align:-0.2em;"></span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> is in the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>. A rule <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle><mi>A</mi></mrow><annotation encoding="application/x-tex">B = \textrm{\footnotesize[...]} A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8833em;vertical-align:-0.2em;"></span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span><span class="mord mathnormal">A</span></span></span></span> causes the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> to be included in the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>. And the <em>Follow</em> set of the start symbol has the end-of-file ‘terminal’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">$</mi></mrow><annotation encoding="application/x-tex">\$</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">$</span></span></span></span>.</p>

<p>The <em>Follow</em> set is basically every non-terminal that can follow <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> in the grammar. So when you have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle><mi>A</mi><mtext> </mtext><mi>a</mi><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle></mrow><annotation encoding="application/x-tex">B = \textrm{\footnotesize[...]} A\ a \textrm{\footnotesize[...]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8833em;vertical-align:-0.2em;"></span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> is in the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>. A rule <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mstyle mathsize="0.8em"><mtext>[...]</mtext></mstyle><mi>A</mi></mrow><annotation encoding="application/x-tex">B = \textrm{\footnotesize[...]} A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8833em;vertical-align:-0.2em;"></span><span class="mord text"><span class="mord textrm sizing reset-size6 size4">[…]</span></span><span class="mord mathnormal">A</span></span></span></span> causes the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> to be included in the <em>Follow</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>. And the <em>Follow</em> set of the start symbol has the end-of-file ‘terminal’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">$</mi></mrow><annotation encoding="application/x-tex">\$</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">$</span></span></span></span>.</p>

<p>Finally, there is the dot operator between the <em>First</em> and <em>Follow</em> sets: this is a <em>truncated product</em>, that takes every combination of the two sets, sticks them together (in order), and truncates to length k. That’s a bit of an abstraction over the k in LL(k), which I didn’t take into account in the explanation of <em>First</em> and <em>Follow</em> sets. The <em>First</em> sets should have length k strings of course, and so you may need to take more <em>First/Follow</em> sets into account when computing these. Another thing I glossed over is that we actually use the <em>First</em> set of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span>, a mix of terminals and sorts on the right-hand side of our grammar rules. If <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mtext> </mtext><mi>b</mi></mrow><annotation encoding="application/x-tex">a\ A\ B\ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">a</span><span class="mspace"> </span><span class="mord mathnormal">A</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace"> </span><span class="mord mathnormal">b</span></span></span></span>, then its <em>First</em> set is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>a</mi><mo stretchy="false">}</mo><mo>⋅</mo><mtext mathvariant="italic">First</mtext><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>⋅</mo><mtext mathvariant="italic">First</mtext><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">{</mo><mi>b</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{a\} \cdot \textit{First}(A) \cdot \textit{First}(B) \cdot \{b\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textit">First</span></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textit">First</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">b</span><span class="mclose">}</span></span></span></span>.</p>

<p>Ok, with that all done, we can use those tables. But before we do, a quick word about expressive power, because LL is not particularly powerful…</p>

<h3 id="limitations-and-expressive-power">Limitations and Expressive power</h3>

<p>There are always languages that cannot be captured by an LL(k) grammar that can be captured by an LL(k+1) grammar. In other words, look-ahead size is important in the expressivity of an LL grammar, and LL(k) for any specific k does not capture <em>all</em> deterministic context-free languages<sup id="fnref:nondet" role="doc-noteref"><a href="#fn:nondet" class="footnote" rel="footnote">3</a></sup>.</p>

<p>We’ve already seen an example of an LL(2) grammar, but what would be a language that cannot be captured by any LL(k)? Take the language of a’s followed by b’s, where the number of a’s <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\geq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mrel">≥</span></span></span></span> the number of b’s. Or as a grammar:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>S</mi></mrow><annotation encoding="application/x-tex"> S = a S         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>A</mi></mrow><annotation encoding="application/x-tex"> S = A           </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>a</mi><mi>A</mi><mi>b</mi></mrow><annotation encoding="application/x-tex"> A = a A b       </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">b</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>ε</mi></mrow><annotation encoding="application/x-tex"> A = \varepsilon </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(4)</mtext></mrow><annotation encoding="application/x-tex"> \text{(4)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(4)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>The problem for LL here is that we would have to look ahead in the input until we read the entire input before we could decide whether we can start consuming the input with Rule 1 or Rule 2 (and then Rule 3).</p>

<p>There is a class of grammars called LL-regular (LLR) grammars captures all LL(k) grammars for any k and slightly more. These LLR grammars are cool in that they are still parseable in linear time, as long as you have something called a “regular partition” of your grammar. Getting that is an undecidable problem though. And since there is an LR(1) grammar that is not in LLR, this stuff is the trifecta of confusing, impractical, and less powerful<sup id="fnref:LLR" role="doc-noteref"><a href="#fn:LLR" class="footnote" rel="footnote">4</a></sup> than a much more useful technique that we will cover later in this post: LR. But first, going from tables to parsers!</p>

<h2 id="predictive-parsing">Predictive Parsing</h2>

<p>Since we already know what the tables mean, we can write a simple parse table interpreter to finish our <em>predictive parser</em>. The parser is called predictive because based on the <em>k</em> look-ahead terminals, we decide the grammar rule to use to continue parsing, which typically predicts some of the structure of the input well beyond the part we peeked at for the look-ahead.</p>

<p>Ok, let’s write a quick parse table interpreter for our LL(2) example. We’ll start with some definitions.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">lazy_static</span><span class="p">::</span><span class="n">lazy_static</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">peekmore</span><span class="p">::</span><span class="n">PeekMore</span><span class="p">;</span>

<span class="k">type</span> <span class="n">Terminal</span> <span class="o">=</span> <span class="nb">char</span><span class="p">;</span>

<span class="nd">#[derive(Clone,</span> <span class="nd">Copy,</span> <span class="nd">Debug,</span> <span class="nd">Eq,</span> <span class="nd">Hash,</span> <span class="nd">PartialEq)]</span>
<span class="k">enum</span> <span class="n">Sort</span> <span class="p">{</span>
    <span class="n">S</span><span class="p">,</span>
    <span class="n">A1</span><span class="p">,</span>
    <span class="n">A2</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">Symbol</span> <span class="p">{</span>
    <span class="nf">Sort</span><span class="p">(</span><span class="n">Sort</span><span class="p">),</span>
    <span class="nf">Terminal</span><span class="p">(</span><span class="n">Terminal</span><span class="p">),</span>
<span class="p">}</span>

<span class="nd">#[derive(Debug,</span> <span class="nd">Eq,</span> <span class="nd">PartialEq)]</span>
<span class="k">enum</span> <span class="n">Rule</span> <span class="p">{</span>
    <span class="n">S</span><span class="p">,</span>
    <span class="n">Aa</span><span class="p">,</span>
    <span class="n">AEpsilon</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The imports become useful in a second, for now we have our terminals, sorts, a combination type <code class="language-plaintext highlighter-rouge">Symbol</code>, and the names of our grammar rules. Assuming we keep around a proper PDA stack of symbols, we can write our grammar rules now:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">impl</span> <span class="n">Rule</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Symbol</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">match</span> <span class="k">self</span> <span class="p">{</span>
            <span class="nn">Rule</span><span class="p">::</span><span class="n">S</span> <span class="k">=&gt;</span> <span class="nn">Self</span><span class="p">::</span><span class="nf">s</span><span class="p">(</span><span class="n">stack</span><span class="p">),</span>
            <span class="nn">Rule</span><span class="p">::</span><span class="n">Aa</span> <span class="k">=&gt;</span> <span class="nn">Self</span><span class="p">::</span><span class="nf">aa</span><span class="p">(</span><span class="n">stack</span><span class="p">),</span>
            <span class="nn">Rule</span><span class="p">::</span><span class="n">AEpsilon</span> <span class="k">=&gt;</span> <span class="nn">Self</span><span class="p">::</span><span class="nf">a_epsilon</span><span class="p">(</span><span class="n">stack</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">s</span><span class="p">(</span><span class="n">stack</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Symbol</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Terminal</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span>
        <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Terminal</span><span class="p">(</span><span class="sc">'b'</span><span class="p">));</span>
        <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Sort</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">A2</span><span class="p">));</span>
        <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Terminal</span><span class="p">(</span><span class="sc">'b'</span><span class="p">));</span>
        <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Terminal</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span>
        <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Sort</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">A1</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">aa</span><span class="p">(</span><span class="n">stack</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Symbol</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Terminal</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[allow(clippy::ptr_arg)]</span>
    <span class="k">fn</span> <span class="nf">a_epsilon</span><span class="p">(</span><span class="mi">_</span><span class="n">stack</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Symbol</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Clippy is great for catching all kinds of poor code, but for consistency I’ve chosen to <code class="language-plaintext highlighter-rouge">#[allow]</code> this time. Note that to effectively run a context-free grammar on a PDA, you need to push the symbols in your rules on the stack in reverse, <a href="#context-free-grammars-derivations-and-a-naive-pda-translation">as mentioned in the recap</a>.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">lazy_static!</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">ref</span> <span class="n">TABLE</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="p">(</span><span class="n">Sort</span><span class="p">,</span> <span class="n">Terminal</span><span class="p">,</span> <span class="n">Terminal</span><span class="p">),</span> <span class="n">Rule</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">table</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="n">table</span><span class="nf">.insert</span><span class="p">((</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">,</span>  <span class="sc">'a'</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">),</span> <span class="nn">Rule</span><span class="p">::</span><span class="n">S</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="n">table</span><span class="nf">.insert</span><span class="p">((</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">,</span>  <span class="sc">'a'</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">),</span> <span class="nn">Rule</span><span class="p">::</span><span class="n">S</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="n">table</span><span class="nf">.insert</span><span class="p">((</span><span class="nn">Sort</span><span class="p">::</span><span class="n">A1</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">),</span> <span class="nn">Rule</span><span class="p">::</span><span class="n">Aa</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="n">table</span><span class="nf">.insert</span><span class="p">((</span><span class="nn">Sort</span><span class="p">::</span><span class="n">A1</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">),</span> <span class="nn">Rule</span><span class="p">::</span><span class="n">AEpsilon</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="n">table</span><span class="nf">.insert</span><span class="p">((</span><span class="nn">Sort</span><span class="p">::</span><span class="n">A2</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">),</span> <span class="nn">Rule</span><span class="p">::</span><span class="n">Aa</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="n">table</span><span class="nf">.insert</span><span class="p">((</span><span class="nn">Sort</span><span class="p">::</span><span class="n">A2</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">),</span> <span class="nn">Rule</span><span class="p">::</span><span class="n">AEpsilon</span><span class="p">));</span>
        <span class="n">table</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Nothing very special really, just encoding what we had already. The main parse loop is also very unexciting now that we have implemented most of the logic of the grammar already. We basically manage the stack, eliminating terminals on the stack with those from the input and applying rules from the table based on sort and look-ahead, and give errors if we get unexpected input:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">lex</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Terminal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">input</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Argument string to parse"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="nf">lex</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.peekmore</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">stack</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">stack</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Symbol</span><span class="p">::</span><span class="nf">Sort</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">));</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="o">=</span> <span class="n">stack</span><span class="nf">.pop</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">match</span> <span class="n">symbol</span> <span class="p">{</span>
            <span class="nn">Symbol</span><span class="p">::</span><span class="nf">Terminal</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;&amp;</span><span class="n">actual</span><span class="p">)</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="n">predicted</span> <span class="o">==</span> <span class="n">actual</span> <span class="p">{</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span>
                        <span class="s">"Expected terminal {predicted:?}, but got {actual:?}."</span>
                    <span class="p">))</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Expected terminal {predicted:?}, but got EOF."</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nn">Symbol</span><span class="p">::</span><span class="nf">Sort</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="o">&amp;</span><span class="p">[</span><span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">term1</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">term2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.peek_amount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">=</span> <span class="n">TABLE</span><span class="nf">.get</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">term1</span><span class="p">,</span> <span class="n">term2</span><span class="p">))</span> <span class="p">{</span>
                        <span class="n">r</span><span class="nf">.apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">stack</span><span class="p">);</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span>
                            <span class="s">"Unexpected {term1:?} {term2:?} while parsing {sort:?}"</span>
                        <span class="p">))</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nf">Err</span><span class="p">(</span><span class="s">"Unexpected end of input."</span><span class="nf">.to_owned</span><span class="p">())</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">}</span>
    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="recursive-descent">Recursive Descent</h2>

<p>By encoding the parse table in data, we get some amount of <em>interpretive overhead</em>. We have a parse table interpreter with a stack we manage ourselves, but the stack is not really used any different from a call stack. So what if we use function calls instead? That’s the idea of <em>recursive descent</em> parsing. It actually makes our code smaller and more straight-forward, which is why it’s so popular as a technique for hand-written parsers.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">peekmore</span><span class="p">::</span><span class="n">PeekMore</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">peekmore</span><span class="p">::</span><span class="n">PeekMoreIterator</span><span class="p">;</span>

<span class="k">type</span> <span class="n">Iter</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PeekMoreIterator</span><span class="o">&lt;</span><span class="nn">std</span><span class="p">::</span><span class="nn">slice</span><span class="p">::</span><span class="n">Iter</span><span class="o">&lt;</span><span class="nv">'a</span><span class="p">,</span> <span class="n">Terminal</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">type</span> <span class="n">Terminal</span> <span class="o">=</span> <span class="nb">char</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">,</span> <span class="n">predicted</span><span class="p">:</span> <span class="n">Terminal</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">actual</span><span class="p">)</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">predicted</span> <span class="p">{</span>
            <span class="nf">Ok</span><span class="p">(())</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span>
                <span class="s">"Expected terminal {predicted:?}, but got {actual:?}."</span>
            <span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">Err</span><span class="p">(</span><span class="s">"Unexpected end of file."</span><span class="nf">.to_owned</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This time we only need terminals as a type, the rest is gone, and so is the hashmap import for the parsetable. We will need the input, and be able to remove predicted terminals from it, so <code class="language-plaintext highlighter-rouge">consume</code> comes in handy.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">sort_s</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// S</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.peek_amount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">)]</span> <span class="k">=&gt;</span> <span class="nf">s</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="sc">'b'</span><span class="p">)]</span> <span class="k">=&gt;</span> <span class="nf">s</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="n">term1</span><span class="p">,</span> <span class="n">term2</span><span class="p">]</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected {term1:?} {term2:?} while parsing S"</span><span class="p">)),</span>
        <span class="mi">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="s">"Unexpected end of file."</span><span class="nf">.to_owned</span><span class="p">()),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">sort_A1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// A1</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.peek_amount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">)]</span> <span class="k">=&gt;</span> <span class="nf">a_a</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="sc">'b'</span><span class="p">)]</span> <span class="k">=&gt;</span> <span class="nf">a_epsilon</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="n">term1</span><span class="p">,</span> <span class="n">term2</span><span class="p">]</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected {term1:?} {term2:?} while parsing A"</span><span class="p">)),</span>
        <span class="mi">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="s">"Unexpected end of file."</span><span class="nf">.to_owned</span><span class="p">()),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">sort_A2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">// A2</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.peek_amount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="sc">'b'</span><span class="p">)]</span> <span class="k">=&gt;</span> <span class="nf">a_a</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="nf">Some</span><span class="p">(</span><span class="sc">'b'</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">)]</span> <span class="k">=&gt;</span> <span class="nf">a_epsilon</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="o">&amp;</span><span class="p">[</span><span class="n">term1</span><span class="p">,</span> <span class="n">term2</span><span class="p">]</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected {term1:?} {term2:?} while parsing A"</span><span class="p">)),</span>
        <span class="mi">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="s">"Unexpected end of file."</span><span class="nf">.to_owned</span><span class="p">()),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">s</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">sort_A1</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="nf">sort_A2</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">a_a</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">a_epsilon</span><span class="p">(</span><span class="mi">_</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Our parse table has now become code directly, with these functions named after the sorts of the rows. They call rules that are also functions, which in turn use the sort functions. Those rules also use <code class="language-plaintext highlighter-rouge">consume</code>, this time without having to reverse the order of the rule body.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">lex</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Terminal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">input</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Argument string to parse"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="nf">lex</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.peekmore</span><span class="p">();</span>
    <span class="nf">sort_s</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finally, our main function just calls the right sort function instead of putting that sort on the stack. And the loop is gone, since we now use recursion.</p>

<h2 id="summary-of-ll-and-an-insight-from-the-automaton">Summary of LL, and an insight from the automaton</h2>

<p>We’ve now seen LL(k) parsing, left-to-right leftmost derivation. This leftmost derivation directly corresponds to walking through the parse tree topdown, depth-first, leftmost child first. Whenever we expand a leftmost sort by a rule for that sort, we have to choose a rule, therefore we use the look-ahead (with a length of <em>k</em>) to see ahead and choose based on this.</p>

<p>We’ve seen an LL(1) and an LL(2) grammar, and in general more look-ahead allows us to parse more grammars <em>and</em> more languages. Both are important: certain languages cannot be expressed in LL(1) or LL(2), and some LL(1) grammars are harder to read and write than the LL(2) grammar of the same language.</p>

<p>We’ve seen how we can construct simple DFAs for each rule in our grammar, and then replace the sort transitions <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mi>A</mi></mpadded></mover><msub><mi>N</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">N_1 \xrightarrow{A} N_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2503em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1003em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128 -16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20  11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7  39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85 -40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5 -12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67  151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> by a (PDA) push transition (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>↓</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">\downarrow A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel">↓</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>) from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to all starts of DFAs corresponding to rules of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, and a pop transition (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>↑</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">\uparrow A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel">↑</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>) from the ends of those DFAs to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">N_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. Then the LL table, the decision table of sort + look-ahead = rule, naturally follows from this PDA by finding what input will be consumed if a certain rule is chosen, and using that as the look-ahead to make the decision for that rule.</p>

<p>The recursive descent way of writing a parser directly as code is nice and simple, it really just follows the grammar. Since you’re writing plain old code with function calls, you can imagine people have found nice ways to extend and adapt the pattern of recursive descent parsers. For one, it’s quite easy to reason about where you are in the parse when hitting an error state, which makes it fairly easy to give friendly error messages when the parser doesn’t accept an input. You can also use a trick to fix up direct left-recursion called <a href="https://en.wikipedia.org/wiki/Tail_recursive_parser">node reparenting</a>, where you use a loop or tail-recursion locally construct the tree bottom-up. You could argue that such a parser is a hybrid between recursive descent and ascent, a “recursive descent-ascent parser”.</p>

<p>Finally, if we look back at the automaton, we can see that the PDAs we build have a very strict shape. We either have a non-deterministic choice due to multiple push transitions for a sort, or we have predicted input, a single path of terminals to consume from the input. If we think back to the <a href="/compsci/2016/04/10/finite-automata/">NFAs and DFAs</a> from early on in this blog post series, those used the input to chose what state to go to next. Now we have single-path DFAs that just consume input, and a separate table on a look-ahead to resolve non-determinism from the pushes and pops. The strict shape here indicated that we’re not really making full use of the power of automata. This will change with the next parsing technique.</p>

<h1 id="bottomup-lr-parsing">Bottomup, LR parsing</h1>

<p>LR stands for left-to-right, rightmost derivation <em>in reverse</em>. If you think about it, left-to-right and rightmost derivation are incompatible: The rightmost derivation chooses the rule for the rightmost sort first every time, but that means skipping over some unknown amount of input if you read left-to-right to even get to that point. However, the <em>reverse</em> of the rightmost derivation is a left-to-right form of parsing. This reverse derivation describes going bottomup, left-to-right through the parse tree.</p>

<h2 id="expressive-power-and-relation-to-ll">Expressive power and relation to LL</h2>

<p>One of the biggest upsides of LR(k) parsing is its <strong>expressivity</strong>. The set of all LL(k) languages of any <em>k</em> is a strict subset of all LR(1) languages. Note that this is speaking of languages, not grammars. For grammars it holds that any LL(k) grammar for a specific <em>k</em> is also an LR(k) grammar, and not necessarily the other way around.</p>

<p>An LR(k) grammar of any k greater than 1 can be automatically transformed into an LR(1) grammar that is not necessarily structurally equivalent. This is highlights the difference between grammar and language level equivalence. We can basically capture any LR language in an LR(1) grammar, but LR with larger <em>k</em> may be able to describe the language in a nicer way (smaller grammar).</p>

<p>A good overview of how LL and LR relate to each other on the grammar and language level is <a href="https://cs.stackexchange.com/a/48">summarised on the Computer Science Stack Exchange</a>. In the comments someone suggests making a list of examples for each of these relationships, which seems like a great idea, but not something I have the patience for right now. This blog post has enough scope creep already.</p>

<h2 id="how-lr-works">How LR works</h2>

<p>In order to give a reverse rightmost derivation, we need to figure what sorts can be at the leftmost leaf of the parse tree for our LR grammar. Then we try to apply the rules for those sorts all simultaneously. And to do so we can’t just use the automaton build we’ve used for LL.</p>

<p>Remember that the automata we’ve used previously mapped well on recursive descent, and showed us where to use an LL parse table with look-ahead to resolve ambiguity. Crucially, those automata observe every rule we go into. But for LR we need to explore down all the rules simultaneously. Let’s see if we can’t get somewhere with that idea and the example grammar of the language that wasn’t LL:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>S</mi></mrow><annotation encoding="application/x-tex"> S = a S         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>A</mi></mrow><annotation encoding="application/x-tex"> S = A           </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>a</mi><mi>A</mi><mi>b</mi></mrow><annotation encoding="application/x-tex"> A = a A b       </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">b</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>ε</mi></mrow><annotation encoding="application/x-tex"> A = \varepsilon </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ε</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(4)</mtext></mrow><annotation encoding="application/x-tex"> \text{(4)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(4)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>We start again with the separate automata for each rule:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Simple automata for each grammar rule from the example Pages: 1 -->
<svg role="img" aria-label="Simple automata for each grammar rule from the example" width="327pt" height="207pt" viewBox="0.00 0.00 327.17 206.80">
<title>Simple automata for each grammar rule from the example</title>
<desc>digraph &quot;Simple automata for each grammar rule from the example&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;
subgraph {
node [style=filled, fillcolor=&quot;#777&quot;, fontcolor=&quot;#fefefe&quot;];
start4 [style=&quot;&quot;, shape=none, label=&quot;&quot;, width=0];
A₄ [shape=doublecircle, width=0.4];
start4 -&gt; A₄;
}
subgraph {
node [style=filled, fillcolor=&quot;#aaa&quot;];
start3 [style=&quot;&quot;, shape=none, label=&quot;&quot;, width=0];
A₃ [shape=doublecircle, width=0.4];
start3 -&gt; A₃₀;
A₃₀ -&gt; A₃₁ [label=&quot;a&quot;];
A₃₁ -&gt; A₃₂ [label=&quot;A&quot;];
A₃₂ -&gt; A₃ [label=&quot;b&quot;];
}
subgraph {
node [style=filled, fillcolor=&quot;#ddd&quot;];
start2 [style=&quot;&quot;, shape=none, label=&quot;&quot;, width=0];
S₂ [shape=doublecircle, width=0.4];
start2 -&gt; S₂₀;
S₂₀ -&gt; S₂ [label=&quot;A&quot;];
}
subgraph {
start1 [shape=none, label=&quot;&quot;, width=0];
S₁ [shape=doublecircle, width=0.4];
start1 -&gt; S₁₀;
S₁₀ -&gt; S₁₁ [label=&quot;s&quot;];
S₁₁ -&gt; S₁ [label=&quot;A&quot;];
}
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 202.8)">
<title>Simple automata for each grammar rule from the example</title>
<!-- start4 -->
<g id="node1" class="node">
<title>start4</title>
</g>
<!-- A₄ -->
<g id="node2" class="node">
<title>A₄</title>
<ellipse fill="#777777" stroke="#010101" cx="56.12" cy="-18.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="56.12" cy="-18.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="56.12" y="-13.35" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
</g>
<!-- start4&#45;&gt;A₄ -->
<g id="edge1" class="edge">
<title>start4&#45;&gt;A₄</title>
<path fill="none" stroke="#010101" d="M18.23,-18.4C20.91,-18.4 23.72,-18.4 26.56,-18.4" />
<polygon fill="#010101" stroke="#010101" points="26.5,-21.9 36.5,-18.4 26.5,-14.9 26.5,-21.9" />
</g>
<!-- start3 -->
<g id="node3" class="node">
<title>start3</title>
</g>
<!-- A₃₀ -->
<g id="node5" class="node">
<title>A₃₀</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="56.12" cy="-72.4" rx="18" ry="18" />
<text text-anchor="middle" x="56.12" y="-67.35" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
</g>
<!-- start3&#45;&gt;A₃₀ -->
<g id="edge2" class="edge">
<title>start3&#45;&gt;A₃₀</title>
<path fill="none" stroke="#010101" d="M18.23,-72.4C21.06,-72.4 24.05,-72.4 27.05,-72.4" />
<polygon fill="#010101" stroke="#010101" points="26.87,-75.9 36.87,-72.4 26.87,-68.9 26.87,-75.9" />
</g>
<!-- A₃ -->
<g id="node4" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="300.77" cy="-72.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="300.77" cy="-72.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="300.77" y="-67.35" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- A₃₁ -->
<g id="node6" class="node">
<title>A₃₁</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="138.67" cy="-72.4" rx="18" ry="18" />
<text text-anchor="middle" x="138.67" y="-67.35" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₁</text>
</g>
<!-- A₃₀&#45;&gt;A₃₁ -->
<g id="edge3" class="edge">
<title>A₃₀&#45;&gt;A₃₁</title>
<path fill="none" stroke="#010101" d="M73.81,-72.4C84.11,-72.4 97.59,-72.4 109.5,-72.4" />
<polygon fill="#010101" stroke="#010101" points="109.21,-75.9 119.21,-72.4 109.21,-68.9 109.21,-75.9" />
<text text-anchor="middle" x="97.4" y="-75.6" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- A₃₂ -->
<g id="node7" class="node">
<title>A₃₂</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="221.22" cy="-72.4" rx="18" ry="18" />
<text text-anchor="middle" x="221.22" y="-67.35" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₂</text>
</g>
<!-- A₃₁&#45;&gt;A₃₂ -->
<g id="edge4" class="edge">
<title>A₃₁&#45;&gt;A₃₂</title>
<path fill="none" stroke="#010101" d="M156.36,-72.4C166.66,-72.4 180.14,-72.4 192.05,-72.4" />
<polygon fill="#010101" stroke="#010101" points="191.76,-75.9 201.76,-72.4 191.76,-68.9 191.76,-75.9" />
<text text-anchor="middle" x="179.95" y="-75.6" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- A₃₂&#45;&gt;A₃ -->
<g id="edge5" class="edge">
<title>A₃₂&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M239.05,-72.4C248.37,-72.4 260.21,-72.4 270.96,-72.4" />
<polygon fill="#010101" stroke="#010101" points="270.93,-75.9 280.93,-72.4 270.93,-68.9 270.93,-75.9" />
<text text-anchor="middle" x="261" y="-75.6" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- start2 -->
<g id="node8" class="node">
<title>start2</title>
</g>
<!-- S₂₀ -->
<g id="node10" class="node">
<title>S₂₀</title>
<ellipse fill="#dddddd" stroke="#010101" cx="56.12" cy="-126.4" rx="18" ry="18" />
<text text-anchor="middle" x="56.12" y="-121.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
</g>
<!-- start2&#45;&gt;S₂₀ -->
<g id="edge6" class="edge">
<title>start2&#45;&gt;S₂₀</title>
<path fill="none" stroke="#010101" d="M18.23,-126.4C21.06,-126.4 24.05,-126.4 27.05,-126.4" />
<polygon fill="#010101" stroke="#010101" points="26.87,-129.9 36.87,-126.4 26.87,-122.9 26.87,-129.9" />
</g>
<!-- S₂ -->
<g id="node9" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="138.67" cy="-126.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="138.67" cy="-126.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="138.67" y="-121.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂₀&#45;&gt;S₂ -->
<g id="edge7" class="edge">
<title>S₂₀&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M73.81,-126.4C84.04,-126.4 97.4,-126.4 109.26,-126.4" />
<polygon fill="#010101" stroke="#010101" points="108.93,-129.9 118.93,-126.4 108.93,-122.9 108.93,-129.9" />
<text text-anchor="middle" x="97.4" y="-129.6" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- start1 -->
<g id="node11" class="node">
<title>start1</title>
</g>
<!-- S₁₀ -->
<g id="node13" class="node">
<title>S₁₀</title>
<ellipse fill="none" stroke="#010101" cx="56.12" cy="-180.4" rx="18" ry="18" />
<text text-anchor="middle" x="56.12" y="-175.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
</g>
<!-- start1&#45;&gt;S₁₀ -->
<g id="edge8" class="edge">
<title>start1&#45;&gt;S₁₀</title>
<path fill="none" stroke="#010101" d="M18.23,-180.4C21.06,-180.4 24.05,-180.4 27.05,-180.4" />
<polygon fill="#010101" stroke="#010101" points="26.87,-183.9 36.87,-180.4 26.87,-176.9 26.87,-183.9" />
</g>
<!-- S₁ -->
<g id="node12" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="221.22" cy="-180.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="221.22" cy="-180.4" rx="18.4" ry="18.4" />
<text text-anchor="middle" x="221.22" y="-175.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁₁ -->
<g id="node14" class="node">
<title>S₁₁</title>
<ellipse fill="none" stroke="#010101" cx="138.67" cy="-180.4" rx="18" ry="18" />
<text text-anchor="middle" x="138.67" y="-175.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
</g>
<!-- S₁₀&#45;&gt;S₁₁ -->
<g id="edge9" class="edge">
<title>S₁₀&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M73.81,-180.4C84.11,-180.4 97.59,-180.4 109.5,-180.4" />
<polygon fill="#010101" stroke="#010101" points="109.21,-183.9 119.21,-180.4 109.21,-176.9 109.21,-183.9" />
<text text-anchor="middle" x="97.4" y="-183.6" font-family="Times,serif" font-size="14.00" fill="#010101">s</text>
</g>
<!-- S₁₁&#45;&gt;S₁ -->
<g id="edge10" class="edge">
<title>S₁₁&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M156.36,-180.4C166.59,-180.4 179.95,-180.4 191.81,-180.4" />
<polygon fill="#010101" stroke="#010101" points="191.48,-183.9 201.48,-180.4 191.48,-176.9 191.48,-183.9" />
<text text-anchor="middle" x="179.95" y="-183.6" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
</g>
</svg>
</div>

<p>Now in order to explore to the bottom-left of the parse tree, we need to be free to go into any rule. So we will connect the rules again to the nodes that expect a certain sort, but with epsilon transitions so we don’t observe how far down we are or with what rule in particular we got there. We’ll need that later, but let’s not worry about that until we have the downward exploration.</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Partially constructed automaton using the automata from the grammar rules, using epsilon transitions Pages: 1 -->
<svg role="img" aria-label="Partially constructed automaton using the automata from the grammar rules, using epsilon transitions" width="321pt" height="296pt" viewBox="0.00 0.00 320.97 296.00">
<title>Partially constructed automaton using the automata from the grammar rules, using epsilon transitions</title>
<desc>digraph &quot;Partially constructed automaton using the automata from the grammar rules, using epsilon transitions&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;
start1 [shape=none, label=&quot;&quot;, width=0];
start2 [shape=box, label=&quot;&quot;, width=0, color=&quot;#00000000&quot;];
start3 [shape=none, label=&quot;&quot;, width=0];
subgraph {
node [style=filled, fillcolor=&quot;#777&quot;, fontcolor=&quot;#fefefe&quot;];
A₄;
}
subgraph {
node [style=filled, fillcolor=&quot;#aaa&quot;];
A₃;
start3 -&gt; A₃₀ [style=invis, weight=3];
A₃₀ -&gt; A₃₁ [label=&quot;a&quot;, weight=10];
A₃₁ -&gt; A₃₂ [label=&quot;A&quot;, weight=3];
A₃₂ -&gt; A₃ [label=&quot;b&quot;, weight=3];
}
subgraph {
node [style=filled, fillcolor=&quot;#ddd&quot;];
S₂;
start1 -&gt; start2:w [arrowhead=none];
start2:e -&gt; S₂₀ [weight=3];
S₂₀ -&gt; S₂ [label=&quot;A&quot;, weight=3];
}
subgraph {
S₁;
start1 -&gt; S₁₀ [weight=3];
S₁₀ -&gt; S₁₁ [label=&quot;a&quot;, weight=3];
S₁₁ -&gt; S₁ [label=&quot;S&quot;, weight=3];
}
subgraph{
rank=same;
edge [style=invis];
start1 -&gt; start3 [minlen=3, weight=3];
}
subgraph{
rank=same;
edge [style=invis];
S₁₀ -&gt; start2 [weight=3];
start2 -&gt; A₃₀ [weight=3, minlen=2];
}
subgraph{
rank=same;
edge [style=invis];
S₁₁ -&gt; S₂₀ [weight=3];
S₂₀ -&gt; A₃₁ [weight=3, minlen=2];
A₃₁ -&gt; A₄ [weight=3];
}
subgraph{
rank=same;
edge [style=invis];
S₁ -&gt; S₂ [weight=3];
S₂ -&gt; A₃₂ [weight=3, minlen=2];
}
S₁₁ -&gt; S₂₀ [label=&quot;ε&quot;];
S₁₁ -&gt; S₁₀ [label=&quot;ε&quot;];
S₂₀ -&gt; A₃₀ [label=&quot;ε&quot;];
A₃₁ -&gt; A₄ [label=&quot;ε&quot;];
A₃₁ -&gt; A₃₀:se [label=&quot;ε&quot;];
S₂₀ -&gt; start3:n [arrowhead=&quot;none&quot;];
start3:s -&gt; A₄ [label=&quot;ε&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 292)">
<title>Partially constructed automaton using the automata from the grammar rules, using epsilon transitions</title>
<!-- start1 -->
<g id="node1" class="node">
<title>start1</title>
</g>
<!-- start2 -->
<g id="node2" class="node">
<title>start2</title>
<polygon fill="none" stroke="none" points="56.21,-216 55.49,-216 55.49,-180 56.21,-180 56.21,-216" />
</g>
<!-- start1&#45;&gt;start2 -->
<g id="edge5" class="edge">
<title>start1&#45;&gt;start2:w</title>
<path fill="none" stroke="#010101" d="M0.79,-233.9C2.3,-231.79 26.86,-198 54.85,-198" />
</g>
<!-- start3 -->
<g id="node3" class="node">
<title>start3</title>
</g>
<!-- start1&#45;&gt;start3 -->
<!-- S₁₀ -->
<g id="node12" class="node">
<title>S₁₀</title>
<ellipse fill="none" stroke="#010101" cx="55.85" cy="-270" rx="18" ry="18" />
<text text-anchor="middle" x="55.85" y="-264.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
</g>
<!-- start1&#45;&gt;S₁₀ -->
<g id="edge8" class="edge">
<title>start1&#45;&gt;S₁₀</title>
<path fill="none" stroke="#010101" d="M0.88,-234.1C2.54,-235.21 17.33,-245.05 31.01,-254.14" />
<polygon fill="#010101" stroke="#010101" points="29.04,-257.04 39.3,-259.66 32.91,-251.21 29.04,-257.04" />
</g>
<!-- A₃₀ -->
<g id="node6" class="node">
<title>A₃₀</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="55.85" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="55.85" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
</g>
<!-- start2&#45;&gt;A₃₀ -->
<!-- S₂₀ -->
<g id="node10" class="node">
<title>S₂₀</title>
<ellipse fill="#dddddd" stroke="#010101" cx="134.1" cy="-198" rx="18" ry="18" />
<text text-anchor="middle" x="134.1" y="-192.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
</g>
<!-- start2&#45;&gt;S₂₀ -->
<g id="edge6" class="edge">
<title>start2:e&#45;&gt;S₂₀</title>
<path fill="none" stroke="#010101" d="M56.85,-198C72.77,-198 90.57,-198 104.96,-198" />
<polygon fill="#010101" stroke="#010101" points="104.62,-201.5 114.62,-198 104.62,-194.5 104.62,-201.5" />
</g>
<!-- A₄ -->
<g id="node4" class="node">
<title>A₄</title>
<ellipse fill="#777777" stroke="#010101" cx="134.1" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="134.1" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
</g>
<!-- start3&#45;&gt;A₄ -->
<g id="edge25" class="edge">
<title>start3:s&#45;&gt;A₄</title>
<path fill="none" stroke="#010101" d="M0.36,-89C0.36,-41.97 65.95,-25.98 104.92,-20.62" />
<polygon fill="#010101" stroke="#010101" points="105.27,-24.11 114.78,-19.44 104.44,-17.16 105.27,-24.11" />
<text text-anchor="middle" x="55.85" y="-43.2" font-family="Times,serif" font-size="14.00" fill="#010101">ε</text>
</g>
<!-- start3&#45;&gt;A₃₀ -->
<!-- A₃ -->
<g id="node5" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="294.97" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="294.97" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- A₃₁ -->
<g id="node7" class="node">
<title>A₃₁</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="134.1" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="134.1" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₁</text>
</g>
<!-- A₃₀&#45;&gt;A₃₁ -->
<g id="edge2" class="edge">
<title>A₃₀&#45;&gt;A₃₁</title>
<path fill="none" stroke="#010101" d="M73.77,-90C82.95,-90 94.53,-90 105.03,-90" />
<polygon fill="#010101" stroke="#010101" points="104.71,-93.5 114.71,-90 104.71,-86.5 104.71,-93.5" />
<text text-anchor="middle" x="94.97" y="-93.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- A₃₁&#45;&gt;A₄ -->
<!-- A₃₁&#45;&gt;A₄ -->
<g id="edge22" class="edge">
<title>A₃₁&#45;&gt;A₄</title>
<path fill="none" stroke="#010101" d="M134.1,-72.16C134.1,-64.62 134.1,-55.65 134.1,-47.2" />
<polygon fill="#010101" stroke="#010101" points="137.6,-47.31 134.1,-37.31 130.6,-47.31 137.6,-47.31" />
<text text-anchor="middle" x="122.85" y="-48.95" font-family="Times,serif" font-size="14.00" fill="#010101">ε</text>
</g>
<!-- A₃₁&#45;&gt;A₃₀ -->
<g id="edge23" class="edge">
<title>A₃₁&#45;&gt;A₃₀:se</title>
<path fill="none" stroke="#010101" d="M119.5,-79.8C113.28,-75.75 105.6,-71.56 97.97,-69.5 89.77,-67.28 84.16,-67.27 78.69,-70.1" />
<polygon fill="#010101" stroke="#010101" points="76.77,-67.16 71.04,-76.07 81.08,-72.68 76.77,-67.16" />
<text text-anchor="middle" x="94.97" y="-73.2" font-family="Times,serif" font-size="14.00" fill="#010101">ε</text>
</g>
<!-- A₃₂ -->
<g id="node8" class="node">
<title>A₃₂</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="216.1" cy="-90" rx="18" ry="18" />
<text text-anchor="middle" x="216.1" y="-84.95" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₂</text>
</g>
<!-- A₃₁&#45;&gt;A₃₂ -->
<g id="edge3" class="edge">
<title>A₃₁&#45;&gt;A₃₂</title>
<path fill="none" stroke="#010101" d="M152.06,-90C162.14,-90 175.17,-90 186.77,-90" />
<polygon fill="#010101" stroke="#010101" points="186.64,-93.5 196.64,-90 186.64,-86.5 186.64,-93.5" />
<text text-anchor="middle" x="175.1" y="-93.2" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- A₃₂&#45;&gt;A₃ -->
<g id="edge4" class="edge">
<title>A₃₂&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M233.78,-90C243.08,-90 254.92,-90 265.63,-90" />
<polygon fill="#010101" stroke="#010101" points="265.54,-93.5 275.54,-90 265.54,-86.5 265.54,-93.5" />
<text text-anchor="middle" x="255.6" y="-93.2" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- S₂ -->
<g id="node9" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="216.1" cy="-198" rx="18" ry="18" />
<text text-anchor="middle" x="216.1" y="-192.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂&#45;&gt;A₃₂ -->
<!-- S₂₀&#45;&gt;start3 -->
<g id="edge24" class="edge">
<title>S₂₀&#45;&gt;start3:n</title>
<path fill="none" stroke="#010101" d="M118.13,-189.86C83.41,-170.48 0.36,-120.97 0.36,-91" />
</g>
<!-- S₂₀&#45;&gt;A₃₀ -->
<g id="edge21" class="edge">
<title>S₂₀&#45;&gt;A₃₀</title>
<path fill="none" stroke="#010101" d="M126.23,-181.91C119.9,-167.94 109.72,-147.5 97.97,-131.5 92.14,-123.57 84.83,-115.69 77.99,-108.96" />
<polygon fill="#010101" stroke="#010101" points="80.49,-106.51 70.82,-102.17 75.68,-111.59 80.49,-106.51" />
<text text-anchor="middle" x="94.97" y="-135.2" font-family="Times,serif" font-size="14.00" fill="#010101">ε</text>
</g>
<!-- S₂₀&#45;&gt;A₃₁ -->
<!-- S₂₀&#45;&gt;S₂ -->
<g id="edge7" class="edge">
<title>S₂₀&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M152.06,-198C162.14,-198 175.17,-198 186.77,-198" />
<polygon fill="#010101" stroke="#010101" points="186.64,-201.5 196.64,-198 186.64,-194.5 186.64,-201.5" />
<text text-anchor="middle" x="175.1" y="-201.2" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- S₁ -->
<g id="node11" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="216.1" cy="-270" rx="18" ry="18" />
<text text-anchor="middle" x="216.1" y="-264.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁&#45;&gt;S₂ -->
<!-- S₁₀&#45;&gt;start2 -->
<!-- S₁₁ -->
<g id="node13" class="node">
<title>S₁₁</title>
<ellipse fill="none" stroke="#010101" cx="134.1" cy="-270" rx="18" ry="18" />
<text text-anchor="middle" x="134.1" y="-264.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
</g>
<!-- S₁₀&#45;&gt;S₁₁ -->
<g id="edge9" class="edge">
<title>S₁₀&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M73.77,-270C82.95,-270 94.53,-270 105.03,-270" />
<polygon fill="#010101" stroke="#010101" points="104.71,-273.5 114.71,-270 104.71,-266.5 104.71,-273.5" />
<text text-anchor="middle" x="94.97" y="-273.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- S₁₁&#45;&gt;S₂₀ -->
<!-- S₁₁&#45;&gt;S₂₀ -->
<g id="edge19" class="edge">
<title>S₁₁&#45;&gt;S₂₀</title>
<path fill="none" stroke="#010101" d="M134.1,-252.16C134.1,-244.62 134.1,-235.65 134.1,-227.2" />
<polygon fill="#010101" stroke="#010101" points="137.6,-227.31 134.1,-217.31 130.6,-227.31 137.6,-227.31" />
<text text-anchor="middle" x="122.85" y="-228.95" font-family="Times,serif" font-size="14.00" fill="#010101">ε</text>
</g>
<!-- S₁₁&#45;&gt;S₁ -->
<g id="edge10" class="edge">
<title>S₁₁&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M152.06,-270C162.14,-270 175.17,-270 186.77,-270" />
<polygon fill="#010101" stroke="#010101" points="186.64,-273.5 196.64,-270 186.64,-266.5 186.64,-273.5" />
<text text-anchor="middle" x="175.1" y="-273.2" font-family="Times,serif" font-size="14.00" fill="#010101">S</text>
</g>
<!-- S₁₁&#45;&gt;S₁₀ -->
<g id="edge20" class="edge">
<title>S₁₁&#45;&gt;S₁₀</title>
<path fill="none" stroke="#010101" d="M120.65,-258.3C112.75,-252.29 102.14,-246.75 91.97,-249.5 88.03,-250.56 84.09,-252.19 80.33,-254.07" />
<polygon fill="#010101" stroke="#010101" points="78.65,-251 71.75,-259.04 82.16,-257.06 78.65,-251" />
<text text-anchor="middle" x="94.97" y="-253.2" font-family="Times,serif" font-size="14.00" fill="#010101">ε</text>
</g>
</g>
</svg>
</div>

<p>Obviously this is not a full automaton model of a parser yet, but it allows us to always go down to the next leaf of the parse tree without using the stack. Let’s clean up the automaton with an NFA-to-DFA conversion:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: Partially constructed automaton using the automata from the grammar rules, after merging states through NFA&#45;to&#45;DFA conversion Pages: 1 -->
<svg role="img" aria-label="Partially constructed automaton using the automata from the grammar rules, after merging states through NFA-to-DFA conversion" width="355pt" height="244pt" viewBox="0.00 0.00 354.72 244.00">
<title>Partially constructed automaton using the automata from the grammar rules, after merging states through NFA-to-DFA conversion</title>
<desc>digraph &quot;Partially constructed automaton using the automata from the grammar rules, after merging states through NFA-to-DFA conversion&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

start1 [shape=none, label=&quot;&quot;, width=0];
S₁;
S₂ [style=filled, fillcolor=&quot;#ddd&quot;];
A₃ [style=filled, fillcolor=&quot;#aaa&quot;];
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;A₄&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;S₁₁&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₁&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;A₄&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
Box2 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₂&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;a&quot;, weight=2];
Box0:t -&gt; S₂ [label=&quot;A&quot;];
Box1:t:n -&gt; Box1:t:n [label=&quot;a&quot;];
Box1:t -&gt; Box2:t [label=&quot;A&quot;, weight=2];
Box1:t -&gt; S₁ [label=&quot;S&quot;];
Box2:t -&gt; A₃ [label=&quot;b&quot;];

subgraph {
rank=same;
edge [style=invis];
Box2:t -&gt; S₁ [minlen=0];
}
subgraph {
rank=same;
edge [style=invis];
Box1:t -&gt; S₂ [minlen=0];
}
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 240)">
<title>Partially constructed automaton using the automata from the grammar rules, after merging states through NFA&#45;to&#45;DFA conversion</title>
<!-- start1 -->
<g id="node1" class="node">
<title>start1</title>
</g>
<!-- Box0 -->
<g id="node5" class="node">
<title>Box0</title>
<text text-anchor="start" x="51.85" y="-156.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-129 48.72,-149.5 72.97,-149.5 72.97,-129 48.72,-129" />
<text text-anchor="start" x="51.85" y="-134.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="48.72,-106.5 48.72,-127 72.97,-127 72.97,-106.5 48.72,-106.5" />
<text text-anchor="start" x="50.72" y="-111.7" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
<polygon fill="#777777" stroke="none" points="48.72,-84 48.72,-104.5 72.97,-104.5 72.97,-84 48.72,-84" />
<text text-anchor="start" x="53.35" y="-89.2" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
<polygon fill="none" stroke="#010101" points="45.72,-81 45.72,-175 75.97,-175 75.97,-81 45.72,-81" />
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge1" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.14,-128C23.26,-128 28.97,-128 34.48,-128" />
<polygon fill="#010101" stroke="#010101" points="34.4,-131.5 44.4,-128 34.4,-124.5 34.4,-131.5" />
</g>
<!-- S₁ -->
<g id="node2" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="244.85" cy="-63" rx="18" ry="18" />
<text text-anchor="middle" x="244.85" y="-57.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₂ -->
<g id="node3" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="152.85" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="152.85" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- A₃ -->
<g id="node4" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="328.72" cy="-128" rx="18" ry="18" />
<text text-anchor="middle" x="328.72" y="-122.95" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- Box0&#45;&gt;S₂ -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M75.88,-110.83C89.6,-94.04 111.09,-67.76 129.72,-45 131.1,-43.31 132.53,-41.56 133.97,-39.81" />
<polygon fill="#010101" stroke="#010101" points="136.45,-42.31 140.08,-32.35 131.03,-37.87 136.45,-42.31" />
<text text-anchor="middle" x="106.85" y="-80.2" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- Box1 -->
<g id="node6" class="node">
<title>Box1</title>
<text text-anchor="start" x="143.85" y="-179.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<text text-anchor="start" x="143.85" y="-156.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
<polygon fill="#dddddd" stroke="none" points="140.72,-129 140.72,-149.5 164.97,-149.5 164.97,-129 140.72,-129" />
<text text-anchor="start" x="143.85" y="-134.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="140.72,-106.5 140.72,-127 164.97,-127 164.97,-106.5 140.72,-106.5" />
<text text-anchor="start" x="142.72" y="-111.7" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
<polygon fill="#aaaaaa" stroke="none" points="140.72,-84 140.72,-104.5 164.97,-104.5 164.97,-84 140.72,-84" />
<text text-anchor="start" x="142.72" y="-89.2" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₁</text>
<polygon fill="#777777" stroke="none" points="140.72,-61.5 140.72,-82 164.97,-82 164.97,-61.5 140.72,-61.5" />
<text text-anchor="start" x="145.35" y="-66.7" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
<polygon fill="none" stroke="#010101" points="137.72,-58.5 137.72,-197.5 167.97,-197.5 167.97,-58.5 137.72,-58.5" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge2" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M75.91,-128C89.38,-128 110.03,-128 126.39,-128" />
<polygon fill="#010101" stroke="#010101" points="126.37,-131.5 136.37,-128 126.37,-124.5 126.37,-131.5" />
<text text-anchor="middle" x="106.85" y="-131.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- Box1&#45;&gt;S₁ -->
<g id="edge6" class="edge">
<title>Box1:t&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M167.91,-117.84C182.12,-107.58 204.33,-91.54 221.06,-79.46" />
<polygon fill="#010101" stroke="#010101" points="222.89,-82.45 228.95,-73.76 218.79,-76.78 222.89,-82.45" />
<text text-anchor="middle" x="198.85" y="-101.2" font-family="Times,serif" font-size="14.00" fill="#010101">S</text>
</g>
<!-- Box1&#45;&gt;S₂ -->
<!-- Box1&#45;&gt;Box1 -->
<g id="edge4" class="edge">
<title>Box1:n&#45;&gt;Box1:n</title>
<path fill="none" stroke="#010101" d="M152.85,-198C141.35,-207.5 141.35,-219.5 152.85,-219.5 160.93,-219.5 163.33,-213.57 160.05,-206.74" />
<polygon fill="#010101" stroke="#010101" points="162.87,-204.66 153.81,-199.17 157.46,-209.11 162.87,-204.66" />
<text text-anchor="middle" x="152.85" y="-222.7" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- Box2 -->
<g id="node7" class="node">
<title>Box2</title>
<polygon fill="#dddddd" stroke="none" points="232.72,-129 232.72,-149.5 256.97,-149.5 256.97,-129 232.72,-129" />
<text text-anchor="start" x="238.47" y="-134.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
<polygon fill="#aaaaaa" stroke="none" points="232.72,-106.5 232.72,-127 256.97,-127 256.97,-106.5 232.72,-106.5" />
<text text-anchor="start" x="234.72" y="-111.7" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₂</text>
<polygon fill="none" stroke="#010101" points="229.72,-103.5 229.72,-152.5 259.97,-152.5 259.97,-103.5 229.72,-103.5" />
</g>
<!-- Box1&#45;&gt;Box2 -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M167.91,-128C181.38,-128 202.03,-128 218.39,-128" />
<polygon fill="#010101" stroke="#010101" points="218.37,-131.5 228.37,-128 218.37,-124.5 218.37,-131.5" />
<text text-anchor="middle" x="198.85" y="-131.2" font-family="Times,serif" font-size="14.00" fill="#010101">A</text>
</g>
<!-- Box2&#45;&gt;S₁ -->
<!-- Box2&#45;&gt;A₃ -->
<g id="edge7" class="edge">
<title>Box2:t&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M259.73,-128C270.67,-128 286.28,-128 299.78,-128" />
<polygon fill="#010101" stroke="#010101" points="299.41,-131.5 309.41,-128 299.41,-124.5 299.41,-131.5" />
<text text-anchor="middle" x="289.35" y="-131.2" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
</g>
</svg>
</div>

<p>This is almost exactly how an LR(0) automaton would be drawn. Instead of S₁₀ and S₁₁, you write out the “LR item”s <code class="language-plaintext highlighter-rouge">S = . a S</code> and <code class="language-plaintext highlighter-rouge">S = a . S</code>. But otherwise it would be pretty much this. This is considered a PDA, though what’s happening on the stack is left implicit. That’s because what’s actually happening on the stack of LR automata is very structured, but a little involved. That makes the PDA harder to read and draw, but I’ll demonstrate it once:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: A fully explicit PDA that does LR parsing Pages: 1 -->
<svg role="img" aria-label="A fully explicit PDA that does LR parsing" width="506pt" height="333pt" viewBox="0.00 0.00 505.77 332.55">
<title>A fully explicit PDA that does LR parsing</title>
<desc>digraph &quot;A fully explicit PDA that does LR parsing&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;]
S₁;
S₂ [style=filled, fillcolor=&quot;#ddd&quot;];
A₃ [style=filled, fillcolor=&quot;#aaa&quot;];
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;A₄&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;S₁₁&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₁&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;A₄&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
Box2 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₂&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;a,↓[a,0]&quot;, weight=3];
Box0:t -&gt; S₂ [headlabel=&quot;↓[A,0]&quot;, labelangle=30, labeldistance=5];
Box1:t:n -&gt; Box1:t:n [label=&quot;a,↓[a,1]&quot;];
Box1:t -&gt; Box2:t [label=&quot;↓[A,1]&quot;, weight=3];
Box2:t -&gt; A₃ [label=&quot;b,↓[b,2]&quot;, weight=3];

S₁:e -&gt; S₁:e [taillabel=&quot; ↑[S,1] [a,1] ↓[S,1]&quot;, labeldistance=5, labelangle=-15];
S₁ -&gt; fin [headlabel=&quot;↑[S,1] [a,0]&quot;, labeldistance=4.5, labelangle=-30];
S₂ -&gt; fin [label=&quot;↑[A,0]     &quot;]
Box2:t -&gt; S₁:n [xlabel=&quot;\n\n↑[A,1] ↓[S,1]  &quot;];
A₃ -&gt; Box2:t [xlabel=&quot;↑[b,2] [A,1] [a,1] ↓[A,1]&quot;];
A₃ -&gt; S₂ [taillabel=&quot;↑[b,2] [A,1] [a,0] ↓[A,0]&quot;, labeldistance=5, labelangle=40];

subgraph {
rank=same;
edge [style=invis];
Box2:t -&gt; S₁ [minlen=4];
}
subgraph {
rank=same;
edge [style=invis];
Box1:t -&gt; S₂ [minlen=0];
S₂ -&gt; fin [minlen=0];
}
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328.55)">
<title>A fully explicit PDA that does LR parsing</title>
<!-- start1 -->
<g id="node1" class="node">
<title>start1</title>
</g>
<!-- Box0 -->
<g id="node6" class="node">
<title>Box0</title>
<text text-anchor="start" x="51.85" y="-245.25" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-217.55 48.72,-238.05 72.97,-238.05 72.97,-217.55 48.72,-217.55" />
<text text-anchor="start" x="51.85" y="-222.75" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="48.72,-195.05 48.72,-215.55 72.97,-215.55 72.97,-195.05 48.72,-195.05" />
<text text-anchor="start" x="50.72" y="-200.25" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
<polygon fill="#777777" stroke="none" points="48.72,-172.55 48.72,-193.05 72.97,-193.05 72.97,-172.55 48.72,-172.55" />
<text text-anchor="start" x="53.35" y="-177.75" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
<polygon fill="none" stroke="#010101" points="45.72,-169.55 45.72,-263.55 75.97,-263.55 75.97,-169.55 45.72,-169.55" />
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge1" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.14,-216.55C23.26,-216.55 28.97,-216.55 34.48,-216.55" />
<polygon fill="#010101" stroke="#010101" points="34.4,-220.05 44.4,-216.55 34.4,-213.05 34.4,-220.05" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="185.1" cy="-34.55" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="185.1" cy="-34.55" rx="18.4" ry="18.4" />
</g>
<!-- S₁ -->
<g id="node3" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="303.35" cy="-26.55" rx="18" ry="18" />
<text text-anchor="middle" x="303.35" y="-21.5" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁&#45;&gt;fin -->
<g id="edge8" class="edge">
<title>S₁&#45;&gt;fin</title>
<path fill="none" stroke="#010101" d="M285.5,-27.71C266.98,-28.99 236.89,-31.06 214.66,-32.59" />
<polygon fill="#010101" stroke="#010101" points="214.49,-29.09 204.76,-33.27 214.97,-36.07 214.49,-29.09" />
<text text-anchor="middle" x="240.58" y="-3.2" font-family="Times,serif" font-size="14.00" fill="#010101">↑[S,1] [a,0]</text>
</g>
<!-- S₁&#45;&gt;S₁ -->
<g id="edge7" class="edge">
<title>S₁:e&#45;&gt;S₁:e</title>
<path fill="none" stroke="#010101" d="M321.35,-26.55C331.2,-35.55 350.91,-35.55 350.91,-26.55 350.91,-20.08 340.73,-18.26 331.34,-21.09" />
<polygon fill="#010101" stroke="#010101" points="329.77,-17.96 322.67,-25.83 333.13,-24.11 329.77,-17.96" />
<text text-anchor="middle" x="367.7" y="-40.25" font-family="Times,serif" font-size="14.00" fill="#010101"> ↑[S,1] [a,1] ↓[S,1]</text>
</g>
<!-- S₂ -->
<g id="node4" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="185.1" cy="-106.55" rx="18" ry="18" />
<text text-anchor="middle" x="185.1" y="-101.5" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂&#45;&gt;fin -->
<g id="edge9" class="edge">
<title>S₂&#45;&gt;fin</title>
<path fill="none" stroke="#010101" d="M185.1,-88.64C185.1,-81.2 185.1,-72.36 185.1,-64.01" />
<polygon fill="#010101" stroke="#010101" points="188.6,-64.24 185.1,-54.24 181.6,-64.24 188.6,-64.24" />
<text text-anchor="middle" x="173.85" y="-65.7" font-family="Times,serif" font-size="14.00" fill="#010101">↑[A,0] &#160;&#160;&#160;&#160;</text>
</g>
<!-- S₂&#45;&gt;fin -->
<!-- A₃ -->
<g id="node5" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="423.97" cy="-216.55" rx="18" ry="18" />
<text text-anchor="middle" x="423.97" y="-211.5" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- A₃&#45;&gt;S₂ -->
<g id="edge12" class="edge">
<title>A₃&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M407.61,-209.42C367.81,-190.94 261,-141.34 211.69,-118.44" />
<polygon fill="#010101" stroke="#010101" points="213.19,-115.28 202.65,-114.24 210.24,-121.62 213.19,-115.28" />
<text text-anchor="middle" x="386.41" y="-159.09" font-family="Times,serif" font-size="14.00" fill="#010101">↑[b,2] [A,1] [a,0] ↓[A,0]</text>
</g>
<!-- Box2 -->
<g id="node8" class="node">
<title>Box2</title>
<polygon fill="#dddddd" stroke="none" points="291.22,-217.55 291.22,-238.05 315.47,-238.05 315.47,-217.55 291.22,-217.55" />
<text text-anchor="start" x="296.97" y="-222.75" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
<polygon fill="#aaaaaa" stroke="none" points="291.22,-195.05 291.22,-215.55 315.47,-215.55 315.47,-195.05 291.22,-195.05" />
<text text-anchor="start" x="293.22" y="-200.25" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₂</text>
<polygon fill="none" stroke="#010101" points="288.22,-192.05 288.22,-241.05 318.47,-241.05 318.47,-192.05 288.22,-192.05" />
</g>
<!-- A₃&#45;&gt;Box2 -->
<g id="edge11" class="edge">
<title>A₃&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M408.59,-225.9C402.49,-229.34 395.14,-232.82 387.97,-234.55 369.18,-239.1 363.38,-238.6 344.47,-234.55 339.2,-233.43 333.79,-231.55 328.72,-229.43" />
<polygon fill="#010101" stroke="#010101" points="330.24,-226.28 319.7,-225.22 327.28,-232.62 330.24,-226.28" />
<text text-anchor="middle" x="430.27" y="-240.83" font-family="Times,serif" font-size="14.00" fill="#010101">↑[b,2] [A,1] [a,1] ↓[A,1]</text>
</g>
<!-- Box0&#45;&gt;S₂ -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M75.87,-203.93C97.21,-184.74 137.97,-148.05 162.93,-125.6" />
<polygon fill="#010101" stroke="#010101" points="165.12,-128.33 170.22,-119.04 160.44,-123.13 165.12,-128.33" />
<text text-anchor="middle" x="122.43" y="-123.36" font-family="Times,serif" font-size="14.00" fill="#010101">↓[A,0]</text>
</g>
<!-- Box1 -->
<g id="node7" class="node">
<title>Box1</title>
<text text-anchor="start" x="176.1" y="-267.75" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<text text-anchor="start" x="176.1" y="-245.25" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
<polygon fill="#dddddd" stroke="none" points="172.97,-217.55 172.97,-238.05 197.22,-238.05 197.22,-217.55 172.97,-217.55" />
<text text-anchor="start" x="176.1" y="-222.75" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="172.97,-195.05 172.97,-215.55 197.22,-215.55 197.22,-195.05 172.97,-195.05" />
<text text-anchor="start" x="174.97" y="-200.25" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
<polygon fill="#aaaaaa" stroke="none" points="172.97,-172.55 172.97,-193.05 197.22,-193.05 197.22,-172.55 172.97,-172.55" />
<text text-anchor="start" x="174.97" y="-177.75" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₁</text>
<polygon fill="#777777" stroke="none" points="172.97,-150.05 172.97,-170.55 197.22,-170.55 197.22,-150.05 172.97,-150.05" />
<text text-anchor="start" x="177.6" y="-155.25" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
<polygon fill="none" stroke="#010101" points="169.97,-147.05 169.97,-286.05 200.22,-286.05 200.22,-147.05 169.97,-147.05" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge2" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M75.87,-216.55C96.13,-216.55 133.93,-216.55 159.05,-216.55" />
<polygon fill="#010101" stroke="#010101" points="158.72,-220.05 168.72,-216.55 158.72,-213.05 158.72,-220.05" />
<text text-anchor="middle" x="122.97" y="-219.75" font-family="Times,serif" font-size="14.00" fill="#010101">a,↓[a,0]</text>
</g>
<!-- Box1&#45;&gt;S₂ -->
<!-- Box1&#45;&gt;Box1 -->
<g id="edge4" class="edge">
<title>Box1:n&#45;&gt;Box1:n</title>
<path fill="none" stroke="#010101" d="M185.1,-286.55C170.31,-296.05 170.31,-308.05 185.1,-308.05 196.18,-308.05 198.95,-301.3 193.41,-293.92" />
<polygon fill="#010101" stroke="#010101" points="196.03,-291.57 186.23,-287.56 191.39,-296.81 196.03,-291.57" />
<text text-anchor="middle" x="185.1" y="-311.25" font-family="Times,serif" font-size="14.00" fill="#010101">a,↓[a,1]</text>
</g>
<!-- Box1&#45;&gt;Box2 -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M199.89,-216.55C218.94,-216.55 253.64,-216.55 277.33,-216.55" />
<polygon fill="#010101" stroke="#010101" points="277.06,-220.05 287.06,-216.55 277.06,-213.05 277.06,-220.05" />
<text text-anchor="middle" x="244.22" y="-219.75" font-family="Times,serif" font-size="14.00" fill="#010101">↓[A,1]</text>
</g>
<!-- Box2&#45;&gt;S₁ -->
<g id="edge10" class="edge">
<title>Box2:t&#45;&gt;S₁:n</title>
<path fill="none" stroke="#010101" d="M303.35,-57.62C303.35,-107.07 303.35,-161.97 303.35,-192.26" />
<polygon fill="#010101" stroke="#010101" points="306.85,-57.69 303.35,-47.69 299.85,-57.69 306.85,-57.69" />
<text text-anchor="middle" x="262.85" y="-73.84" font-family="Times,serif" font-size="14.00" fill="#010101">↑[A,1] ↓[S,1] &#160;</text>
</g>
<!-- Box2&#45;&gt;S₁ -->
<!-- Box2&#45;&gt;A₃ -->
<g id="edge6" class="edge">
<title>Box2:t&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M318.42,-216.55C337.21,-216.55 370.93,-216.55 395,-216.55" />
<polygon fill="#010101" stroke="#010101" points="394.73,-220.05 404.73,-216.55 394.73,-213.05 394.73,-220.05" />
<text text-anchor="middle" x="366.22" y="-219.75" font-family="Times,serif" font-size="14.00" fill="#010101">b,↓[b,2]</text>
</g>
</g>
</svg>
</div>

<p>This should look quite familiar. We’re pushing inputs on the stack as we consume them, paired with the state we’re in at that point. And then we’re popping whole bodies of rules off the stack and replacing them with the sort of that rule. The first thing is called a <em>shift</em> action, the second is called a <em>reduce</em> action. We’ve seen this trick before in the naive PDA built from a CFG, all the way at the start of this post in the refresher. But this time we get an automaton with more states.</p>

<p>Notice that <em>where</em> a reduce action goes depends on originating state of the last thing that’s popped. That’s why we keep track of those on the stack. When we reduce by rule 3 (state A₃), depending on whether the <code class="language-plaintext highlighter-rouge">a</code> came from box 1 or box 0, we go to different places. This is easier to see in our proper LR(0) automaton, where box 1 points to state S₁ with a transition labeled <code class="language-plaintext highlighter-rouge">A</code>. This is a <em>goto</em> action. In an LR parse table interpreter, the <em>goto</em> is a separate action that immediately follows a <em>reduce</em> action, which merely returns to the last popped state. When a reduce just returns that’s also more like a function call and return, so that’s nice. Anyway, that’s also why a reduce transition in the above automaton always labels the originating state of the pushed sort the same as the last thing popped from the stack.</p>

<p>Something worth repeating now that we’re looking at the details: LL decides what rule to take <em>before</em> consuming the input for that rule, whereas LR decides what rule to take <em>after</em> consuming all the input for that rule. In other words, we only reduce by a rule when we’ve seen the entire body of the rule, that why there’s less trouble with look-ahead.</p>

<p>Speaking of look-ahead: we have some shift-reduce problems in our automaton. And by that I mean: how do we choose when to shift and when to reduce when both are an option? This is a determinism issue in our current automaton, and just like in our LL automaton, we solve it with look-ahead (and yes, that can and will later be summarised in a parse table). Our latest automaton gives a clear view of what we will be able to do if we reduce, so the look-ahead follows from what input can be consumed next after each reduce:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: A fully explicit PDA that does LR parsing, with look&#45;ahead Pages: 1 -->
<svg role="img" aria-label="A fully explicit PDA that does LR parsing, with look-ahead" width="540pt" height="332pt" viewBox="0.00 0.00 539.52 331.71">
<title>A fully explicit PDA that does LR parsing, with look-ahead</title>
<desc>digraph &quot;A fully explicit PDA that does LR parsing, with look-ahead&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
S₁;
S₂ [style=filled, fillcolor=&quot;#ddd&quot;];
A₃ [style=filled, fillcolor=&quot;#aaa&quot;];
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;A₄&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;S₁₁&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₁&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;A₄&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
Box2 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;A₃₂&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;a,↓[a,0]&quot;, weight=3];
Box0:t -&gt; S₂ [headlabel=&quot;($), ↓[A,0]&quot;, labelangle=30, labeldistance=5];
Box1:t:n -&gt; Box1:t:n [label=&quot;a,↓[a,1]&quot;];
Box1:t -&gt; Box2:t [label=&quot;(b,$), ↓[A,1]&quot;, weight=3];
Box2:t -&gt; A₃ [label=&quot;b,↓[b,2]&quot;, weight=3];

S₁:e -&gt; S₁:e [taillabel=&quot; ↑[S,1] [a,1] ↓[S,1]&quot;, labeldistance=5, labelangle=-15];
S₁ -&gt; fin [headlabel=&quot;↑[S,1] [a,0]&quot;, labeldistance=4.5, labelangle=-30];
S₂ -&gt; fin [label=&quot;↑[A,0]     &quot;]
Box2:t -&gt; S₁:n [xlabel=&quot;\n\n($), ↑[A,1] ↓[S,1]  &quot;];
A₃ -&gt; Box2:t [xlabel=&quot;↑[b,2] [A,1] [a,1] ↓[A,1]&quot;];
A₃ -&gt; S₂ [taillabel=&quot;↑[b,2] [A,1] [a,0] ↓[A,0]&quot;, labeldistance=5, labelangle=40];

subgraph {
rank=same;
edge [style=invis];
Box2:t -&gt; S₁ [minlen=4];
}
subgraph {
rank=same;
edge [style=invis];
Box1:t -&gt; S₂ [minlen=0];
S₂ -&gt; fin [minlen=0];
}
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 327.71)">
<title>A fully explicit PDA that does LR parsing, with look&#45;ahead</title>
<!-- start1 -->
<g id="node1" class="node">
<title>start1</title>
</g>
<!-- Box0 -->
<g id="node6" class="node">
<title>Box0</title>
<text text-anchor="start" x="51.85" y="-244.41" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-216.71 48.72,-237.21 72.97,-237.21 72.97,-216.71 48.72,-216.71" />
<text text-anchor="start" x="51.85" y="-221.91" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="48.72,-194.21 48.72,-214.71 72.97,-214.71 72.97,-194.21 48.72,-194.21" />
<text text-anchor="start" x="50.72" y="-199.41" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
<polygon fill="#777777" stroke="none" points="48.72,-171.71 48.72,-192.21 72.97,-192.21 72.97,-171.71 48.72,-171.71" />
<text text-anchor="start" x="53.35" y="-176.91" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
<polygon fill="none" stroke="#010101" points="45.72,-168.71 45.72,-262.71 75.97,-262.71 75.97,-168.71 45.72,-168.71" />
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge1" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.14,-215.71C23.26,-215.71 28.97,-215.71 34.48,-215.71" />
<polygon fill="#010101" stroke="#010101" points="34.4,-219.21 44.4,-215.71 34.4,-212.21 34.4,-219.21" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="185.1" cy="-33.71" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="185.1" cy="-33.71" rx="18.4" ry="18.4" />
</g>
<!-- S₁ -->
<g id="node3" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="337.1" cy="-25.71" rx="18" ry="18" />
<text text-anchor="middle" x="337.1" y="-20.66" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁&#45;&gt;fin -->
<g id="edge8" class="edge">
<title>S₁&#45;&gt;fin</title>
<path fill="none" stroke="#010101" d="M319.55,-26.59C294.26,-27.94 245.7,-30.53 214.65,-32.19" />
<polygon fill="#010101" stroke="#010101" points="214.61,-28.69 204.81,-32.71 214.99,-35.68 214.61,-28.69" />
<text text-anchor="middle" x="241.02" y="-3.2" font-family="Times,serif" font-size="14.00" fill="#010101">↑[S,1] [a,0]</text>
</g>
<!-- S₁&#45;&gt;S₁ -->
<g id="edge7" class="edge">
<title>S₁:e&#45;&gt;S₁:e</title>
<path fill="none" stroke="#010101" d="M355.1,-25.71C365.57,-34.71 386.53,-34.71 386.53,-25.71 386.53,-19.1 375.23,-17.35 365.07,-20.44" />
<polygon fill="#010101" stroke="#010101" points="363.64,-17.24 356.43,-25 366.91,-23.43 363.64,-17.24" />
<text text-anchor="middle" x="401.98" y="-38.04" font-family="Times,serif" font-size="14.00" fill="#010101"> ↑[S,1] [a,1] ↓[S,1]</text>
</g>
<!-- S₂ -->
<g id="node4" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="185.1" cy="-105.71" rx="18" ry="18" />
<text text-anchor="middle" x="185.1" y="-100.66" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂&#45;&gt;fin -->
<g id="edge9" class="edge">
<title>S₂&#45;&gt;fin</title>
<path fill="none" stroke="#010101" d="M185.1,-87.8C185.1,-80.35 185.1,-71.52 185.1,-63.17" />
<polygon fill="#010101" stroke="#010101" points="188.6,-63.39 185.1,-53.39 181.6,-63.39 188.6,-63.39" />
<text text-anchor="middle" x="173.85" y="-64.86" font-family="Times,serif" font-size="14.00" fill="#010101">↑[A,0] &#160;&#160;&#160;&#160;</text>
</g>
<!-- S₂&#45;&gt;fin -->
<!-- A₃ -->
<g id="node5" class="node">
<title>A₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="457.72" cy="-215.71" rx="18" ry="18" />
<text text-anchor="middle" x="457.72" y="-210.66" font-family="Times,serif" font-size="14.00" fill="#010101">A₃</text>
</g>
<!-- A₃&#45;&gt;S₂ -->
<g id="edge12" class="edge">
<title>A₃&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M440.96,-209.3C396.15,-191.09 267.74,-138.9 212.2,-116.32" />
<polygon fill="#010101" stroke="#010101" points="213.8,-113.19 203.22,-112.67 211.16,-119.68 213.8,-113.19" />
<text text-anchor="middle" x="417.58" y="-160.06" font-family="Times,serif" font-size="14.00" fill="#010101">↑[b,2] [A,1] [a,0] ↓[A,0]</text>
</g>
<!-- Box2 -->
<g id="node8" class="node">
<title>Box2</title>
<polygon fill="#dddddd" stroke="none" points="324.97,-216.71 324.97,-237.21 349.22,-237.21 349.22,-216.71 324.97,-216.71" />
<text text-anchor="start" x="330.72" y="-221.91" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
<polygon fill="#aaaaaa" stroke="none" points="324.97,-194.21 324.97,-214.71 349.22,-214.71 349.22,-194.21 324.97,-194.21" />
<text text-anchor="start" x="326.97" y="-199.41" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₂</text>
<polygon fill="none" stroke="#010101" points="321.97,-191.21 321.97,-240.21 352.22,-240.21 352.22,-191.21 321.97,-191.21" />
</g>
<!-- A₃&#45;&gt;Box2 -->
<g id="edge11" class="edge">
<title>A₃&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M442.34,-225.06C436.24,-228.5 428.89,-231.98 421.72,-233.71 402.93,-238.26 397.13,-237.76 378.22,-233.71 372.95,-232.58 367.54,-230.71 362.47,-228.59" />
<polygon fill="#010101" stroke="#010101" points="363.99,-225.44 353.45,-224.38 361.03,-231.78 363.99,-225.44" />
<text text-anchor="middle" x="464.02" y="-239.99" font-family="Times,serif" font-size="14.00" fill="#010101">↑[b,2] [A,1] [a,1] ↓[A,1]</text>
</g>
<!-- Box0&#45;&gt;S₂ -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M75.87,-203.09C97.21,-183.89 137.97,-147.21 162.93,-124.76" />
<polygon fill="#010101" stroke="#010101" points="165.12,-127.49 170.22,-118.2 160.44,-122.29 165.12,-127.49" />
<text text-anchor="middle" x="122.43" y="-122.52" font-family="Times,serif" font-size="14.00" fill="#010101">($), ↓[A,0]</text>
</g>
<!-- Box1 -->
<g id="node7" class="node">
<title>Box1</title>
<text text-anchor="start" x="176.1" y="-266.91" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<text text-anchor="start" x="176.1" y="-244.41" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
<polygon fill="#dddddd" stroke="none" points="172.97,-216.71 172.97,-237.21 197.22,-237.21 197.22,-216.71 172.97,-216.71" />
<text text-anchor="start" x="176.1" y="-221.91" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="172.97,-194.21 172.97,-214.71 197.22,-214.71 197.22,-194.21 172.97,-194.21" />
<text text-anchor="start" x="174.97" y="-199.41" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₀</text>
<polygon fill="#aaaaaa" stroke="none" points="172.97,-171.71 172.97,-192.21 197.22,-192.21 197.22,-171.71 172.97,-171.71" />
<text text-anchor="start" x="174.97" y="-176.91" font-family="Times,serif" font-size="14.00" fill="#010101">A₃₁</text>
<polygon fill="#777777" stroke="none" points="172.97,-149.21 172.97,-169.71 197.22,-169.71 197.22,-149.21 172.97,-149.21" />
<text text-anchor="start" x="177.6" y="-154.41" font-family="Times,serif" font-size="14.00" fill="#fefefe">A₄</text>
<polygon fill="none" stroke="#010101" points="169.97,-146.21 169.97,-285.21 200.22,-285.21 200.22,-146.21 169.97,-146.21" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge2" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M75.87,-215.71C96.13,-215.71 133.93,-215.71 159.05,-215.71" />
<polygon fill="#010101" stroke="#010101" points="158.72,-219.21 168.72,-215.71 158.72,-212.21 158.72,-219.21" />
<text text-anchor="middle" x="122.97" y="-218.91" font-family="Times,serif" font-size="14.00" fill="#010101">a,↓[a,0]</text>
</g>
<!-- Box1&#45;&gt;S₂ -->
<!-- Box1&#45;&gt;Box1 -->
<g id="edge4" class="edge">
<title>Box1:n&#45;&gt;Box1:n</title>
<path fill="none" stroke="#010101" d="M185.1,-285.71C169.56,-295.21 169.56,-307.21 185.1,-307.21 196.74,-307.21 199.66,-300.46 193.83,-293.08" />
<polygon fill="#010101" stroke="#010101" points="196.15,-290.46 186.25,-286.69 191.64,-295.81 196.15,-290.46" />
<text text-anchor="middle" x="185.1" y="-310.41" font-family="Times,serif" font-size="14.00" fill="#010101">a,↓[a,1]</text>
</g>
<!-- Box1&#45;&gt;Box2 -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M200.21,-215.71C225.57,-215.71 279.19,-215.71 310.97,-215.71" />
<polygon fill="#010101" stroke="#010101" points="310.83,-219.21 320.83,-215.71 310.83,-212.21 310.83,-219.21" />
<text text-anchor="middle" x="261.1" y="-218.91" font-family="Times,serif" font-size="14.00" fill="#010101">(b,$), ↓[A,1]</text>
</g>
<!-- Box2&#45;&gt;S₁ -->
<g id="edge10" class="edge">
<title>Box2:t&#45;&gt;S₁:n</title>
<path fill="none" stroke="#010101" d="M337.1,-56.77C337.1,-106.23 337.1,-161.13 337.1,-191.42" />
<polygon fill="#010101" stroke="#010101" points="340.6,-56.84 337.1,-46.84 333.6,-56.84 340.6,-56.84" />
<text text-anchor="middle" x="284.97" y="-73" font-family="Times,serif" font-size="14.00" fill="#010101">($), ↑[A,1] ↓[S,1] &#160;</text>
</g>
<!-- Box2&#45;&gt;S₁ -->
<!-- Box2&#45;&gt;A₃ -->
<g id="edge6" class="edge">
<title>Box2:t&#45;&gt;A₃</title>
<path fill="none" stroke="#010101" d="M352.17,-215.71C370.96,-215.71 404.68,-215.71 428.75,-215.71" />
<polygon fill="#010101" stroke="#010101" points="428.48,-219.21 438.48,-215.71 428.48,-212.21 428.48,-219.21" />
<text text-anchor="middle" x="399.97" y="-218.91" font-family="Times,serif" font-size="14.00" fill="#010101">b,↓[b,2]</text>
</g>
</g>
</svg>
</div>

<p>As you can see, we need at most 1 look-ahead to deterministically parse this grammar. We’re sometimes looking ahead to the end-of-input represented with <code class="language-plaintext highlighter-rouge">$</code>. The look-ahead makes this an LALR(1) grammar; what that is and why it’s different from normal LR(1) is what we’ll see in the next section.</p>

<h2 id="lr-parsetable-construction-and-expressivity">LR parsetable construction and expressivity</h2>

<p>Let’s look at some example grammars, how to construct their tables, and when you need a better parsetable construction method.</p>

<h3 id="lr0">LR(0)</h3>

<p>LR(0) does not look ahead but just reduces whenever possible. If there are multiple options, you have a shift-reduce or a reduce-reduce conflict. Shift-shift conflicts don’t exist in LR since the NFA-to-DFA process would have merged the two states such conflicting transitions would point to.
Let’s look at an LR(0) grammar:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>E</mi><mn>2</mn></mrow><annotation encoding="application/x-tex"> S = E 2         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">2</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>E</mi><mn>1</mn></mrow><annotation encoding="application/x-tex"> E = E 1         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">1</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> E = 1           </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>The LR automaton for this grammar is:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: An LR(0) automaton for the above grammar Pages: 1 -->
<svg role="img" aria-label="An LR(0) automaton for the above grammar" width="351pt" height="202pt" viewBox="0.00 0.00 350.72 202.40">
<title>An LR(0) automaton for the above grammar</title>
<desc>digraph &quot;An LR(0) automaton for the above grammar&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

subgraph {
rank=same;
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box0&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;E₂₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₃₀&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
Box0:t:s -&gt; fin:n [xlabel=&quot;S  &quot;];
}

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
S₁;
E₂ [style=filled, fillcolor=&quot;#ddd&quot;];
E₃ [style=filled, fillcolor=&quot;#aaa&quot;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
&lt;tr&gt;&lt;td&gt;Box1&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;S₁₁&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;E₂₁&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;E&quot;, weight=2, minlen=2];
Box0:t -&gt; E₃ [label=&quot;1&quot;];
Box1:t -&gt; S₁ [label=&quot;2&quot;];
Box1:t -&gt; E₂ [label=&quot;1&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 198.4)">
<title>An LR(0) automaton for the above grammar</title>
<!-- Box0 -->
<g id="node1" class="node">
<title>Box0</title>
<text text-anchor="start" x="50.72" y="-152.1" font-family="Times,serif" font-size="14.00" fill="#010101">Box0</text>
<text text-anchor="start" x="56.35" y="-129.6" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-101.9 48.72,-122.4 81.97,-122.4 81.97,-101.9 48.72,-101.9" />
<text text-anchor="start" x="55.97" y="-107.1" font-family="Times,serif" font-size="14.00" fill="#010101">E₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="48.72,-79.4 48.72,-99.9 81.97,-99.9 81.97,-79.4 48.72,-79.4" />
<text text-anchor="start" x="55.97" y="-84.6" font-family="Times,serif" font-size="14.00" fill="#010101">E₃₀</text>
<polygon fill="none" stroke="#010101" points="45.72,-76.4 45.72,-170.4 84.97,-170.4 84.97,-76.4 45.72,-76.4" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-18.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-18.4" rx="18.4" ry="18.4" />
</g>
<!-- Box0&#45;&gt;fin -->
<g id="edge1" class="edge">
<title>Box0:s&#45;&gt;fin:n</title>
<path fill="none" stroke="#010101" d="M65.35,-48.23C65.35,-57.14 65.35,-62.8 65.35,-75.4" />
<polygon fill="#010101" stroke="#010101" points="68.85,-48.31 65.35,-38.31 61.85,-48.31 68.85,-48.31" />
<text text-anchor="middle" x="57.85" y="-42.64" font-family="Times,serif" font-size="14.00" fill="#010101">S &#160;</text>
</g>
<!-- E₃ -->
<g id="node6" class="node">
<title>E₃</title>
<ellipse fill="#aaaaaa" stroke="#010101" cx="153.72" cy="-176.4" rx="18" ry="18" />
<text text-anchor="middle" x="153.72" y="-171.35" font-family="Times,serif" font-size="14.00" fill="#010101">E₃</text>
</g>
<!-- Box0&#45;&gt;E₃ -->
<g id="edge4" class="edge">
<title>Box0:t&#45;&gt;E₃</title>
<path fill="none" stroke="#010101" d="M84.66,-134.64C97.49,-142.51 114.77,-153.11 128.7,-161.66" />
<polygon fill="#010101" stroke="#010101" points="126.5,-164.42 136.86,-166.67 130.16,-158.45 126.5,-164.42" />
<text text-anchor="middle" x="114.35" y="-157.6" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- Box1 -->
<g id="node7" class="node">
<title>Box1</title>
<text text-anchor="start" x="221.72" y="-140.85" font-family="Times,serif" font-size="14.00" fill="#010101">Box1</text>
<text text-anchor="start" x="227.35" y="-118.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
<polygon fill="#dddddd" stroke="none" points="219.72,-90.65 219.72,-111.15 252.97,-111.15 252.97,-90.65 219.72,-90.65" />
<text text-anchor="start" x="226.97" y="-95.85" font-family="Times,serif" font-size="14.00" fill="#010101">E₂₁</text>
<polygon fill="none" stroke="#010101" points="216.72,-87.65 216.72,-159.15 255.97,-159.15 255.97,-87.65 216.72,-87.65" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M84.75,-123.4C113.83,-123.4 170.68,-123.4 205.6,-123.4" />
<polygon fill="#010101" stroke="#010101" points="205.45,-126.9 215.45,-123.4 205.45,-119.9 205.45,-126.9" />
<text text-anchor="middle" x="153.72" y="-126.6" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- start1 -->
<g id="node3" class="node">
<title>start1</title>
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge2" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.11,-123.4C23.26,-123.4 29.06,-123.4 34.76,-123.4" />
<polygon fill="#010101" stroke="#010101" points="34.58,-126.9 44.58,-123.4 34.58,-119.9 34.58,-126.9" />
</g>
<!-- S₁ -->
<g id="node4" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="324.72" cy="-150.4" rx="18" ry="18" />
<text text-anchor="middle" x="324.72" y="-145.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- E₂ -->
<g id="node5" class="node">
<title>E₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="324.72" cy="-96.4" rx="18" ry="18" />
<text text-anchor="middle" x="324.72" y="-91.35" font-family="Times,serif" font-size="14.00" fill="#010101">E₂</text>
</g>
<!-- Box1&#45;&gt;S₁ -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M255.66,-129.13C267.54,-132.84 283.21,-137.74 296.53,-141.9" />
<polygon fill="#010101" stroke="#010101" points="295.43,-145.22 306.02,-144.87 297.52,-138.54 295.43,-145.22" />
<text text-anchor="middle" x="285.35" y="-141.6" font-family="Times,serif" font-size="14.00" fill="#010101">2</text>
</g>
<!-- Box1&#45;&gt;E₂ -->
<g id="edge6" class="edge">
<title>Box1:t&#45;&gt;E₂</title>
<path fill="none" stroke="#010101" d="M255.66,-117.67C267.54,-113.96 283.21,-109.06 296.53,-104.9" />
<polygon fill="#010101" stroke="#010101" points="297.52,-108.26 306.02,-101.93 295.43,-101.58 297.52,-108.26" />
<text text-anchor="middle" x="285.35" y="-112.6" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
</g>
</svg>
</div>

<p>The corresponding parse table follows this automaton:</p>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">1</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">2</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">$</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">E</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Box0</strong></td>
      <td style="text-align: center">s E₃</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"><em>accept</em></td>
      <td style="text-align: center">Box1</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Box1</strong></td>
      <td style="text-align: center">s E₂</td>
      <td style="text-align: center">s S₁</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>E₃</strong></td>
      <td style="text-align: center">r 3</td>
      <td style="text-align: center">r 3</td>
      <td style="text-align: center">r 3</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>E₂</strong></td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₁</strong></td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>The transition from box 0 to E₃ that shifts <code class="language-plaintext highlighter-rouge">1</code> becomes a shift action to E₃ in the row of box 0 and the column of <code class="language-plaintext highlighter-rouge">1</code>. The transition from box 0 to box 1 with <code class="language-plaintext highlighter-rouge">E</code> becomes a goto to box 1 in the row of box 0 and column of <code class="language-plaintext highlighter-rouge">E</code>. Finally a state that’s at the end of a rule will get all reduce actions by that rule (indicated by its number) in the column for input. Accepting the input is typically based on look-ahead of the end-of-input.</p>

<h3 id="simple-lr-slr">Simple LR (SLR)</h3>

<p>The smallest motivating example for Simple LR is the following grammar that parses the same language as before:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>E</mi><mn>2</mn></mrow><annotation encoding="application/x-tex"> S = E 2         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">2</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>1</mn><mi>E</mi></mrow><annotation encoding="application/x-tex"> E = 1 E         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> E = 1           </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>Notice how rule 2 is now right-recursive instead of left-recursive. It’s a nice symmetry how left-recursive rules give you trouble in LL, and right-recursive rules (can) give you trouble in LR<sup id="fnref:indirect-recursion" role="doc-noteref"><a href="#fn:indirect-recursion" class="footnote" rel="footnote">5</a></sup>.</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: An LR(0) automaton for the above grammar Pages: 1 -->
<svg role="img" aria-label="An LR(0) automaton for the above grammar" width="281pt" height="236pt" viewBox="0.00 0.00 280.72 236.40">
<title>An LR(0) automaton for the above grammar</title>
<desc>digraph &quot;An LR(0) automaton for the above grammar&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

subgraph {
rank=same;
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
&lt;tr&gt;&lt;td&gt;Box0&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;E₂₀&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₃₀&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
Box0:t:s -&gt; fin:n [xlabel=&quot;S  &quot;];
}

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
S₁₁;
E₂ [style=filled, fillcolor=&quot;#ddd&quot;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
&lt;tr&gt;&lt;td&gt;Box1&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;E₂₀&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;E₂₁&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₃&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;1&quot;, weight=2];
Box0:t -&gt; S₁₁ [label=&quot;E&quot;];
S₁₁ -&gt; S₁ [label=&quot;2&quot;];
Box1:t -&gt; E₂ [label=&quot;E&quot;];
Box1:t:s -&gt; Box1:t:s [label=&quot;1&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 232.4)">
<title>An LR(0) automaton for the above grammar</title>
<!-- Box0 -->
<g id="node1" class="node">
<title>Box0</title>
<text text-anchor="start" x="50.72" y="-152.1" font-family="Times,serif" font-size="14.00" fill="#010101">Box0</text>
<text text-anchor="start" x="56.35" y="-129.6" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-101.9 48.72,-122.4 81.97,-122.4 81.97,-101.9 48.72,-101.9" />
<text text-anchor="start" x="55.97" y="-107.1" font-family="Times,serif" font-size="14.00" fill="#010101">E₂₀</text>
<polygon fill="#aaaaaa" stroke="none" points="48.72,-79.4 48.72,-99.9 81.97,-99.9 81.97,-79.4 48.72,-79.4" />
<text text-anchor="start" x="55.97" y="-84.6" font-family="Times,serif" font-size="14.00" fill="#010101">E₃₀</text>
<polygon fill="none" stroke="#010101" points="45.72,-76.4 45.72,-170.4 84.97,-170.4 84.97,-76.4 45.72,-76.4" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-18.4" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-18.4" rx="18.4" ry="18.4" />
</g>
<!-- Box0&#45;&gt;fin -->
<g id="edge1" class="edge">
<title>Box0:s&#45;&gt;fin:n</title>
<path fill="none" stroke="#010101" d="M65.35,-48.23C65.35,-57.14 65.35,-62.8 65.35,-75.4" />
<polygon fill="#010101" stroke="#010101" points="68.85,-48.31 65.35,-38.31 61.85,-48.31 68.85,-48.31" />
<text text-anchor="middle" x="57.85" y="-42.64" font-family="Times,serif" font-size="14.00" fill="#010101">S &#160;</text>
</g>
<!-- S₁₁ -->
<g id="node4" class="node">
<title>S₁₁</title>
<ellipse fill="none" stroke="#010101" cx="164.85" cy="-210.4" rx="18" ry="18" />
<text text-anchor="middle" x="164.85" y="-205.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
</g>
<!-- Box0&#45;&gt;S₁₁ -->
<g id="edge4" class="edge">
<title>Box0:t&#45;&gt;S₁₁</title>
<path fill="none" stroke="#010101" d="M84.68,-139.76C101.22,-154.52 125.53,-176.21 142.84,-191.65" />
<polygon fill="#010101" stroke="#010101" points="140.25,-194.04 150.04,-198.09 144.91,-188.82 140.25,-194.04" />
<text text-anchor="middle" x="115.1" y="-172.6" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box1 -->
<g id="node6" class="node">
<title>Box1</title>
<text text-anchor="start" x="150.22" y="-152.1" font-family="Times,serif" font-size="14.00" fill="#010101">Box1</text>
<polygon fill="#dddddd" stroke="none" points="148.22,-124.4 148.22,-144.9 181.47,-144.9 181.47,-124.4 148.22,-124.4" />
<text text-anchor="start" x="155.47" y="-129.6" font-family="Times,serif" font-size="14.00" fill="#010101">E₂₀</text>
<polygon fill="#dddddd" stroke="none" points="148.22,-101.9 148.22,-122.4 181.47,-122.4 181.47,-101.9 148.22,-101.9" />
<text text-anchor="start" x="155.47" y="-107.1" font-family="Times,serif" font-size="14.00" fill="#010101">E₂₁</text>
<polygon fill="#aaaaaa" stroke="none" points="148.22,-79.4 148.22,-99.9 181.47,-99.9 181.47,-79.4 148.22,-79.4" />
<text text-anchor="start" x="158.1" y="-84.6" font-family="Times,serif" font-size="14.00" fill="#010101">E₃</text>
<polygon fill="none" stroke="#010101" points="145.22,-76.4 145.22,-170.4 184.47,-170.4 184.47,-76.4 145.22,-76.4" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M84.68,-123.4C98.49,-123.4 117.7,-123.4 133.75,-123.4" />
<polygon fill="#010101" stroke="#010101" points="133.74,-126.9 143.74,-123.4 133.74,-119.9 133.74,-126.9" />
<text text-anchor="middle" x="115.1" y="-126.6" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
<!-- start1 -->
<g id="node3" class="node">
<title>start1</title>
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge2" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.11,-123.4C23.26,-123.4 29.06,-123.4 34.76,-123.4" />
<polygon fill="#010101" stroke="#010101" points="34.58,-126.9 44.58,-123.4 34.58,-119.9 34.58,-126.9" />
</g>
<!-- S₁ -->
<g id="node7" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="254.72" cy="-210.4" rx="18" ry="18" />
<text text-anchor="middle" x="254.72" y="-205.35" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁₁&#45;&gt;S₁ -->
<g id="edge5" class="edge">
<title>S₁₁&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M182.79,-210.4C194.94,-210.4 211.6,-210.4 225.72,-210.4" />
<polygon fill="#010101" stroke="#010101" points="225.32,-213.9 235.32,-210.4 225.32,-206.9 225.32,-213.9" />
<text text-anchor="middle" x="214.6" y="-213.6" font-family="Times,serif" font-size="14.00" fill="#010101">2</text>
</g>
<!-- E₂ -->
<g id="node5" class="node">
<title>E₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="254.72" cy="-123.4" rx="18" ry="18" />
<text text-anchor="middle" x="254.72" y="-118.35" font-family="Times,serif" font-size="14.00" fill="#010101">E₂</text>
</g>
<!-- Box1&#45;&gt;E₂ -->
<g id="edge6" class="edge">
<title>Box1:t&#45;&gt;E₂</title>
<path fill="none" stroke="#010101" d="M184.05,-123.4C196.03,-123.4 211.94,-123.4 225.54,-123.4" />
<polygon fill="#010101" stroke="#010101" points="225.21,-126.9 235.21,-123.4 225.21,-119.9 225.21,-126.9" />
<text text-anchor="middle" x="214.6" y="-126.6" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box1&#45;&gt;Box1 -->
<g id="edge7" class="edge">
<title>Box1:s&#45;&gt;Box1:s</title>
<path fill="none" stroke="#010101" d="M164.85,-76.4C152.41,-66.4 152.41,-54.4 164.85,-54.4 173.78,-54.4 176.3,-60.6 172.39,-67.8" />
<polygon fill="#010101" stroke="#010101" points="169.81,-65.44 165.84,-75.26 175.07,-70.05 169.81,-65.44" />
<text text-anchor="middle" x="164.85" y="-41.1" font-family="Times,serif" font-size="14.00" fill="#010101">1</text>
</g>
</g>
</svg>
</div>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">1</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">2</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">$</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">E</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Box0</strong></td>
      <td style="text-align: center">s Box1</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"><em>accept</em></td>
      <td style="text-align: center">S₁₁</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Box1</strong></td>
      <td style="text-align: center">s Box1 / r 3</td>
      <td style="text-align: center">r 3</td>
      <td style="text-align: center">r 3</td>
      <td style="text-align: center">E₂</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₁₁</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">s S₁</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₁</strong></td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>E₂</strong></td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>Yay, we have a shift-reduce conflict. How do we solve it? By not blindly putting a reduce in the entire row of a state that could reduce. If we check the <em>Follow</em> set of the sort we’re reducing to (we defined that when we built LL parse tables, remember?), we can put the reduce action in only the column of the terminals that are in that follow set. If we look at the grammar, we can see that only <code class="language-plaintext highlighter-rouge">2</code> can follow <code class="language-plaintext highlighter-rouge">E</code>. So the SLR table for this grammar is:</p>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">1</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">2</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">$</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">E</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Box0</strong></td>
      <td style="text-align: center">s Box1</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"><em>accept</em></td>
      <td style="text-align: center">S₁₁</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Box1</strong></td>
      <td style="text-align: center">s Box1</td>
      <td style="text-align: center">r 3</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">E₂</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₁₁</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">s S₁</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₁</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>E₂</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<h3 id="look-ahead-lr-lalr">Look-Ahead LR (LALR)</h3>

<p>From now on we’ll be looking at reduce-reduce conflicts only. While you can get shift-reduce conflicts with the following algorithms through grammars that don’t fit (due to ambiguity or requiring more look-ahead than you’re taking into account), when you give an LALR(k) grammar to an SLR(k) algorithm you can only get reduce-reduce conflicts. Same with an LR(k) grammar put through the LALR(k) algorithm.</p>

<p>Here our example grammar that just barely doesn’t work with SLR:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>E</mi><mi>c</mi></mrow><annotation encoding="application/x-tex"> S = a E c         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">c</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>F</mi><mi>d</mi></mrow><annotation encoding="application/x-tex"> S = a F d         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">d</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>b</mi><mi>F</mi><mi>c</mi></mrow><annotation encoding="application/x-tex"> S = b F c         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">c</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>e</mi></mrow><annotation encoding="application/x-tex"> E = e             </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(4)</mtext></mrow><annotation encoding="application/x-tex"> \text{(4)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(4)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mi>e</mi></mrow><annotation encoding="application/x-tex"> F = e             </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(5)</mtext></mrow><annotation encoding="application/x-tex"> \text{(5)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(5)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>See how rules 4 and 5 are the same except they have different sort names? Yeah, that’s going to be fun if they’re used with the same prefix like in rules 1 and 2. Let’s have a look at the automaton and SLR parse table.</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: A LR(0) automaton for the above grammar Pages: 1 -->
<svg role="img" aria-label="A LR(0) automaton for the above grammar" width="377pt" height="304pt" viewBox="0.00 0.00 377.22 304.00">
<title>A LR(0) automaton for the above grammar</title>
<desc>digraph &quot;A LR(0) automaton for the above grammar&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

subgraph {
rank=same;
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box0&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₀&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
Box0:t:s -&gt; fin:n [xlabel=&quot;S  &quot;];
}

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
S₁₂;
S₁;
S₂₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₃₂;
S₃;
F₅ [fontcolor=&quot;#fefefe&quot;, style=filled, fillcolor=&quot;#777&quot;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box1&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box2 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box2&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box3 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box3&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;a&quot;];
Box0:t -&gt; Box2:t [label=&quot;b&quot;];
Box1:t -&gt; Box3:t [label=&quot;e&quot;];
Box1:t -&gt; S₁₂ [label=&quot;E&quot;];
Box1:t -&gt; S₂₂ [label=&quot;F&quot;];
S₁₂ -&gt; S₁ [label=&quot;c&quot;];
S₂₂ -&gt; S₂ [label=&quot;d&quot;];
Box2:t -&gt; F₅ [label=&quot;e&quot;];
Box2:t -&gt; S₃₂ [label=&quot;F&quot;];
S₃₂ -&gt; S₃ [label=&quot;c&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 300)">
<title>A LR(0) automaton for the above grammar</title>
<!-- Box0 -->
<g id="node1" class="node">
<title>Box0</title>
<text text-anchor="start" x="50.72" y="-176.7" font-family="Times,serif" font-size="14.00" fill="#010101">Box0</text>
<text text-anchor="start" x="56.35" y="-154.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-126.5 48.72,-147 81.97,-147 81.97,-126.5 48.72,-126.5" />
<text text-anchor="start" x="56.35" y="-131.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<text text-anchor="start" x="56.35" y="-109.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₀</text>
<polygon fill="none" stroke="#010101" points="45.72,-101 45.72,-195 84.97,-195 84.97,-101 45.72,-101" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-43" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-43" rx="18.4" ry="18.4" />
</g>
<!-- Box0&#45;&gt;fin -->
<g id="edge1" class="edge">
<title>Box0:s&#45;&gt;fin:n</title>
<path fill="none" stroke="#010101" d="M65.35,-72.83C65.35,-81.74 65.35,-87.4 65.35,-100" />
<polygon fill="#010101" stroke="#010101" points="68.85,-72.91 65.35,-62.91 61.85,-72.91 68.85,-72.91" />
<text text-anchor="middle" x="57.85" y="-67.24" font-family="Times,serif" font-size="14.00" fill="#010101">S &#160;</text>
</g>
<!-- Box1 -->
<g id="node11" class="node">
<title>Box1</title>
<text text-anchor="start" x="148.72" y="-252.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box1</text>
<text text-anchor="start" x="154.35" y="-230.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
<polygon fill="#dddddd" stroke="none" points="146.72,-202.75 146.72,-223.25 179.97,-223.25 179.97,-202.75 146.72,-202.75" />
<text text-anchor="start" x="154.35" y="-207.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₁</text>
<polygon fill="#aaaaaa" stroke="none" points="146.72,-180.25 146.72,-200.75 179.97,-200.75 179.97,-180.25 146.72,-180.25" />
<text text-anchor="start" x="153.97" y="-185.45" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀</text>
<polygon fill="#777777" stroke="none" points="146.72,-157.75 146.72,-178.25 179.97,-178.25 179.97,-157.75 146.72,-157.75" />
<text text-anchor="start" x="154.35" y="-162.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀</text>
<polygon fill="none" stroke="#010101" points="143.72,-154.75 143.72,-271.25 182.97,-271.25 182.97,-154.75 143.72,-154.75" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M84.85,-160.53C98.93,-170.06 118.54,-183.34 134.5,-194.15" />
<polygon fill="#010101" stroke="#010101" points="132.4,-196.95 142.64,-199.66 136.32,-191.15 132.4,-196.95" />
<text text-anchor="middle" x="114.35" y="-185.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- Box2 -->
<g id="node12" class="node">
<title>Box2</title>
<text text-anchor="start" x="148.72" y="-100.7" font-family="Times,serif" font-size="14.00" fill="#010101">Box2</text>
<text text-anchor="start" x="154.35" y="-78.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₁</text>
<polygon fill="#aaaaaa" stroke="none" points="146.72,-50.5 146.72,-71 179.97,-71 179.97,-50.5 146.72,-50.5" />
<text text-anchor="start" x="153.97" y="-55.7" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀</text>
<polygon fill="#777777" stroke="none" points="146.72,-28 146.72,-48.5 179.97,-48.5 179.97,-28 146.72,-28" />
<text text-anchor="start" x="154.35" y="-33.2" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀</text>
<polygon fill="none" stroke="#010101" points="143.72,-25 143.72,-119 182.97,-119 182.97,-25 143.72,-25" />
</g>
<!-- Box0&#45;&gt;Box2 -->
<g id="edge4" class="edge">
<title>Box0:t&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M84.85,-133.35C99.07,-122.1 118.91,-106.39 134.95,-93.69" />
<polygon fill="#010101" stroke="#010101" points="137.04,-96.5 142.71,-87.55 132.69,-91.01 137.04,-96.5" />
<text text-anchor="middle" x="114.35" y="-116.2" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- start1 -->
<g id="node3" class="node">
<title>start1</title>
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge2" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.11,-148C23.26,-148 29.06,-148 34.76,-148" />
<polygon fill="#010101" stroke="#010101" points="34.58,-151.5 44.58,-148 34.58,-144.5 34.58,-151.5" />
</g>
<!-- S₁₂ -->
<g id="node4" class="node">
<title>S₁₂</title>
<ellipse fill="none" stroke="#010101" cx="262.85" cy="-278" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-272.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₂</text>
</g>
<!-- S₁ -->
<g id="node5" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="351.22" cy="-278" rx="18" ry="18" />
<text text-anchor="middle" x="351.22" y="-272.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁₂&#45;&gt;S₁ -->
<g id="edge8" class="edge">
<title>S₁₂&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M280.5,-278C292.25,-278 308.29,-278 322.02,-278" />
<polygon fill="#010101" stroke="#010101" points="321.81,-281.5 331.81,-278 321.81,-274.5 321.81,-281.5" />
<text text-anchor="middle" x="311.85" y="-281.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- S₂₂ -->
<g id="node6" class="node">
<title>S₂₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="262.85" cy="-224" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-218.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₂</text>
</g>
<!-- S₂ -->
<g id="node7" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="351.22" cy="-224" rx="18" ry="18" />
<text text-anchor="middle" x="351.22" y="-218.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂₂&#45;&gt;S₂ -->
<g id="edge9" class="edge">
<title>S₂₂&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M280.5,-224C292.25,-224 308.29,-224 322.02,-224" />
<polygon fill="#010101" stroke="#010101" points="321.81,-227.5 331.81,-224 321.81,-220.5 321.81,-227.5" />
<text text-anchor="middle" x="311.85" y="-227.2" font-family="Times,serif" font-size="14.00" fill="#010101">d</text>
</g>
<!-- S₃₂ -->
<g id="node8" class="node">
<title>S₃₂</title>
<ellipse fill="none" stroke="#010101" cx="262.85" cy="-72" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-66.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₂</text>
</g>
<!-- S₃ -->
<g id="node9" class="node">
<title>S₃</title>
<ellipse fill="none" stroke="#010101" cx="351.22" cy="-72" rx="18" ry="18" />
<text text-anchor="middle" x="351.22" y="-66.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃</text>
</g>
<!-- S₃₂&#45;&gt;S₃ -->
<g id="edge12" class="edge">
<title>S₃₂&#45;&gt;S₃</title>
<path fill="none" stroke="#010101" d="M280.5,-72C292.25,-72 308.29,-72 322.02,-72" />
<polygon fill="#010101" stroke="#010101" points="321.81,-75.5 331.81,-72 321.81,-68.5 321.81,-75.5" />
<text text-anchor="middle" x="311.85" y="-75.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- F₅ -->
<g id="node10" class="node">
<title>F₅</title>
<ellipse fill="#777777" stroke="#010101" cx="262.85" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅</text>
</g>
<!-- Box1&#45;&gt;S₁₂ -->
<g id="edge6" class="edge">
<title>Box1:t&#45;&gt;S₁₂</title>
<path fill="none" stroke="#010101" d="M182.68,-225.23C198.45,-235.74 221.29,-250.97 238.39,-262.36" />
<polygon fill="#010101" stroke="#010101" points="236.18,-265.09 246.44,-267.73 240.06,-259.27 236.18,-265.09" />
<text text-anchor="middle" x="213.1" y="-250.2" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box1&#45;&gt;S₂₂ -->
<g id="edge7" class="edge">
<title>Box1:t&#45;&gt;S₂₂</title>
<path fill="none" stroke="#010101" d="M182.68,-215.07C197.15,-216.7 217.58,-219.01 234.05,-220.86" />
<polygon fill="#010101" stroke="#010101" points="233.38,-224.31 243.71,-221.95 234.17,-217.35 233.38,-224.31" />
<text text-anchor="middle" x="213.1" y="-221.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- Box3 -->
<g id="node13" class="node">
<title>Box3</title>
<text text-anchor="start" x="248.22" y="-165.45" font-family="Times,serif" font-size="14.00" fill="#010101">Box3</text>
<polygon fill="#aaaaaa" stroke="none" points="246.22,-137.75 246.22,-158.25 279.47,-158.25 279.47,-137.75 246.22,-137.75" />
<text text-anchor="start" x="256.1" y="-142.95" font-family="Times,serif" font-size="14.00" fill="#010101">E₄</text>
<polygon fill="#777777" stroke="none" points="246.22,-115.25 246.22,-135.75 279.47,-135.75 279.47,-115.25 246.22,-115.25" />
<text text-anchor="start" x="256.47" y="-120.45" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅</text>
<polygon fill="none" stroke="#010101" points="243.22,-112.25 243.22,-183.75 282.47,-183.75 282.47,-112.25 243.22,-112.25" />
</g>
<!-- Box1&#45;&gt;Box3 -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;Box3:t</title>
<path fill="none" stroke="#010101" d="M182.68,-200.77C197.16,-191.12 217.6,-177.5 234.08,-166.51" />
<polygon fill="#010101" stroke="#010101" points="235.62,-169.69 242,-161.23 231.74,-163.87 235.62,-169.69" />
<text text-anchor="middle" x="213.1" y="-185.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- Box2&#45;&gt;S₃₂ -->
<g id="edge11" class="edge">
<title>Box2:t&#45;&gt;S₃₂</title>
<path fill="none" stroke="#010101" d="M182.68,-72C197.07,-72 217.33,-72 233.75,-72" />
<polygon fill="#010101" stroke="#010101" points="233.38,-75.5 243.38,-72 233.38,-68.5 233.38,-75.5" />
<text text-anchor="middle" x="213.1" y="-75.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- Box2&#45;&gt;F₅ -->
<g id="edge10" class="edge">
<title>Box2:t&#45;&gt;F₅</title>
<path fill="none" stroke="#010101" d="M182.68,-61.84C198.12,-53.29 220.34,-40.99 237.31,-31.59" />
<polygon fill="#010101" stroke="#010101" points="238.72,-34.81 245.77,-26.9 235.32,-28.69 238.72,-34.81" />
<text text-anchor="middle" x="213.1" y="-50.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
</g>
</svg>
</div>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">a</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">b</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">c</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">d</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">e</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">$</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">E</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">F</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Box0</strong></td>
      <td style="text-align: center">s Box1</td>
      <td style="text-align: center">s Box2</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"><em>accept</em></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Box1</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">s Box3</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">S₁₂</td>
      <td style="text-align: center">S₂₂</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Box2</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">s F₅</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">S₃₂</td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Box3</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 4 / r 5</td>
      <td style="text-align: center">r 5</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₁₂</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">s S₁</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₁</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 1</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₂₂</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">s S₂</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₂</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 2</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₃₂</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">s S₃</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>S₃</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 3</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>F₅</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 5</td>
      <td style="text-align: center">r 5</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>The reduce-reduce conflict, as promised. It’s in box 3, where we can reduce by E₄ or F₅, when the look-ahead is <code class="language-plaintext highlighter-rouge">c</code>. This is because the look-ahead sets of both <code class="language-plaintext highlighter-rouge">E</code> and <code class="language-plaintext highlighter-rouge">F</code> contain <code class="language-plaintext highlighter-rouge">c</code> due to rules 1 and 3. If we look at the automaton though, we can clearly see that if we reduce and we have a <code class="language-plaintext highlighter-rouge">c</code> next, we should reduce by <code class="language-plaintext highlighter-rouge">E</code>.</p>

<p>Look-Ahead LR parsing uses basically this method, analysing what shifts can happen after certain reduces. Putting it is algorithmic terms, LALR doesn’t use LL <em>Follow</em> sets, but defines more accurate <em>Follow</em> sets based on the automaton. Each instance of the start of a rule in the automaton (F₅₀ in boxes 1 and 2) gets a separate <em>Follow</em> set computed. That’s how we resolve the conflict with LALR:</p>

<table class="parsetable">
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">a</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">b</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">c</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">d</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">e</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">$</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">E</code></th>
      <th style="text-align: center"><code class="language-plaintext highlighter-rouge">F</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Box3</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">r 4</td>
      <td style="text-align: center">r 5</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>Note that since the LALR <em>Follow</em> sets follow directly from the automaton, this is basically the same as the intuition given at the end of the <a href="#how-lr-works">previous section</a>.</p>

<h3 id="lr1">LR(1)</h3>

<p>I like this LALR parsing story. It’s so intuitive with the NFA-to-DFA conversion, just looking at the automaton to see the follow sets. But, it’s doesn’t give you the complete power of deterministic push-down automata. I present to you the previous example grammar with one more rule:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>E</mi><mi>c</mi></mrow><annotation encoding="application/x-tex"> S = a E c         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">c</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>F</mi><mi>d</mi></mrow><annotation encoding="application/x-tex"> S = a F d         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">d</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>b</mi><mi>F</mi><mi>c</mi></mrow><annotation encoding="application/x-tex"> S = b F c         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">c</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>e</mi></mrow><annotation encoding="application/x-tex"> E = e             </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(4)</mtext></mrow><annotation encoding="application/x-tex"> \text{(4)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(4)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mi>e</mi></mrow><annotation encoding="application/x-tex"> F = e             </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(5)</mtext></mrow><annotation encoding="application/x-tex"> \text{(5)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(5)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>b</mi><mi>E</mi><mi>d</mi></mrow><annotation encoding="application/x-tex"> S = b E d         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">d</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(6)</mtext></mrow><annotation encoding="application/x-tex"> \text{(6)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(6)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>This results in an automaton that’s almost the same as before:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: A LR(0) automaton for the above grammar Pages: 1 -->
<svg role="img" aria-label="A LR(0) automaton for the above grammar" width="377pt" height="304pt" viewBox="0.00 0.00 377.22 304.00">
<title>A LR(0) automaton for the above grammar</title>
<desc>digraph &quot;A LR(0) automaton for the above grammar&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

subgraph {
rank=same;
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box0&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₆₀&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
Box0:t:s -&gt; fin:n [xlabel=&quot;S  &quot;];
}

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
S₁₂;
S₁;
S₂₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₃₂;
S₃;
S₆₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₆ [style=filled, fillcolor=&quot;#ddd&quot;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box1&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box2 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box2&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₆₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box3 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box3&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;a&quot;];
Box0:t -&gt; Box2:t [label=&quot;b&quot;];
Box1:t -&gt; Box3:t [label=&quot;e&quot;];
Box1:t -&gt; S₁₂ [label=&quot;E&quot;];
Box1:t -&gt; S₂₂ [label=&quot;F&quot;];
S₁₂ -&gt; S₁ [label=&quot;c&quot;];
S₂₂ -&gt; S₂ [label=&quot;d&quot;];
Box2:t -&gt; Box3:t [label=&quot;e&quot;];
Box2:t -&gt; S₃₂ [label=&quot;F&quot;];
S₃₂ -&gt; S₃ [label=&quot;c&quot;];
Box2:t -&gt; S₆₂ [label=&quot;E&quot;];
S₆₂ -&gt; S₆ [label=&quot;d&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 300)">
<title>A LR(0) automaton for the above grammar</title>
<!-- Box0 -->
<g id="node1" class="node">
<title>Box0</title>
<text text-anchor="start" x="50.72" y="-200.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box0</text>
<text text-anchor="start" x="56.35" y="-178.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-150.75 48.72,-171.25 81.97,-171.25 81.97,-150.75 48.72,-150.75" />
<text text-anchor="start" x="56.35" y="-155.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<text text-anchor="start" x="56.35" y="-133.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-105.75 48.72,-126.25 81.97,-126.25 81.97,-105.75 48.72,-105.75" />
<text text-anchor="start" x="56.35" y="-110.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₀</text>
<polygon fill="none" stroke="#010101" points="45.72,-102.75 45.72,-219.25 84.97,-219.25 84.97,-102.75 45.72,-102.75" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-45" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-45" rx="18.4" ry="18.4" />
</g>
<!-- Box0&#45;&gt;fin -->
<g id="edge1" class="edge">
<title>Box0:s&#45;&gt;fin:n</title>
<path fill="none" stroke="#010101" d="M65.35,-74.83C65.35,-83.74 65.35,-89.4 65.35,-102" />
<polygon fill="#010101" stroke="#010101" points="68.85,-74.91 65.35,-64.91 61.85,-74.91 68.85,-74.91" />
<text text-anchor="middle" x="57.85" y="-69.24" font-family="Times,serif" font-size="14.00" fill="#010101">S &#160;</text>
</g>
<!-- Box1 -->
<g id="node12" class="node">
<title>Box1</title>
<text text-anchor="start" x="148.72" y="-260.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box1</text>
<text text-anchor="start" x="154.35" y="-238.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
<polygon fill="#dddddd" stroke="none" points="146.72,-210.75 146.72,-231.25 179.97,-231.25 179.97,-210.75 146.72,-210.75" />
<text text-anchor="start" x="154.35" y="-215.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₁</text>
<polygon fill="#aaaaaa" stroke="none" points="146.72,-188.25 146.72,-208.75 179.97,-208.75 179.97,-188.25 146.72,-188.25" />
<text text-anchor="start" x="153.97" y="-193.45" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀</text>
<polygon fill="#777777" stroke="none" points="146.72,-165.75 146.72,-186.25 179.97,-186.25 179.97,-165.75 146.72,-165.75" />
<text text-anchor="start" x="154.35" y="-170.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀</text>
<polygon fill="none" stroke="#010101" points="143.72,-162.75 143.72,-279.25 182.97,-279.25 182.97,-162.75 143.72,-162.75" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M84.85,-172.57C98.93,-181.37 118.54,-193.62 134.5,-203.6" />
<polygon fill="#010101" stroke="#010101" points="132.27,-206.33 142.61,-208.66 135.98,-200.4 132.27,-206.33" />
<text text-anchor="middle" x="114.35" y="-195.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- Box2 -->
<g id="node13" class="node">
<title>Box2</title>
<text text-anchor="start" x="148.72" y="-116.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box2</text>
<text text-anchor="start" x="154.35" y="-94.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₁</text>
<polygon fill="#dddddd" stroke="none" points="146.72,-66.75 146.72,-87.25 179.97,-87.25 179.97,-66.75 146.72,-66.75" />
<text text-anchor="start" x="154.35" y="-71.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₁</text>
<polygon fill="#aaaaaa" stroke="none" points="146.72,-44.25 146.72,-64.75 179.97,-64.75 179.97,-44.25 146.72,-44.25" />
<text text-anchor="start" x="153.97" y="-49.45" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀</text>
<polygon fill="#777777" stroke="none" points="146.72,-21.75 146.72,-42.25 179.97,-42.25 179.97,-21.75 146.72,-21.75" />
<text text-anchor="start" x="154.35" y="-26.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀</text>
<polygon fill="none" stroke="#010101" points="143.72,-18.75 143.72,-135.25 182.97,-135.25 182.97,-18.75 143.72,-18.75" />
</g>
<!-- Box0&#45;&gt;Box2 -->
<g id="edge4" class="edge">
<title>Box0:t&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M84.85,-144.8C99.2,-132.25 119.28,-114.68 135.4,-100.58" />
<polygon fill="#010101" stroke="#010101" points="137.53,-103.36 142.75,-94.14 132.92,-98.09 137.53,-103.36" />
<text text-anchor="middle" x="114.35" y="-125.2" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- start1 -->
<g id="node3" class="node">
<title>start1</title>
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge2" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.11,-161C23.26,-161 29.06,-161 34.76,-161" />
<polygon fill="#010101" stroke="#010101" points="34.58,-164.5 44.58,-161 34.58,-157.5 34.58,-164.5" />
</g>
<!-- S₁₂ -->
<g id="node4" class="node">
<title>S₁₂</title>
<ellipse fill="none" stroke="#010101" cx="262.85" cy="-278" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-272.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₂</text>
</g>
<!-- S₁ -->
<g id="node5" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="351.22" cy="-278" rx="18" ry="18" />
<text text-anchor="middle" x="351.22" y="-272.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁₂&#45;&gt;S₁ -->
<g id="edge8" class="edge">
<title>S₁₂&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M280.5,-278C292.25,-278 308.29,-278 322.02,-278" />
<polygon fill="#010101" stroke="#010101" points="321.81,-281.5 331.81,-278 321.81,-274.5 321.81,-281.5" />
<text text-anchor="middle" x="311.85" y="-281.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- S₂₂ -->
<g id="node6" class="node">
<title>S₂₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="262.85" cy="-224" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-218.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₂</text>
</g>
<!-- S₂ -->
<g id="node7" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="351.22" cy="-224" rx="18" ry="18" />
<text text-anchor="middle" x="351.22" y="-218.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂₂&#45;&gt;S₂ -->
<g id="edge9" class="edge">
<title>S₂₂&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M280.5,-224C292.25,-224 308.29,-224 322.02,-224" />
<polygon fill="#010101" stroke="#010101" points="321.81,-227.5 331.81,-224 321.81,-220.5 321.81,-227.5" />
<text text-anchor="middle" x="311.85" y="-227.2" font-family="Times,serif" font-size="14.00" fill="#010101">d</text>
</g>
<!-- S₃₂ -->
<g id="node8" class="node">
<title>S₃₂</title>
<ellipse fill="none" stroke="#010101" cx="262.85" cy="-72" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-66.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₂</text>
</g>
<!-- S₃ -->
<g id="node9" class="node">
<title>S₃</title>
<ellipse fill="none" stroke="#010101" cx="351.22" cy="-72" rx="18" ry="18" />
<text text-anchor="middle" x="351.22" y="-66.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃</text>
</g>
<!-- S₃₂&#45;&gt;S₃ -->
<g id="edge12" class="edge">
<title>S₃₂&#45;&gt;S₃</title>
<path fill="none" stroke="#010101" d="M280.5,-72C292.25,-72 308.29,-72 322.02,-72" />
<polygon fill="#010101" stroke="#010101" points="321.81,-75.5 331.81,-72 321.81,-68.5 321.81,-75.5" />
<text text-anchor="middle" x="311.85" y="-75.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- S₆₂ -->
<g id="node10" class="node">
<title>S₆₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="262.85" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₂</text>
</g>
<!-- S₆ -->
<g id="node11" class="node">
<title>S₆</title>
<ellipse fill="#dddddd" stroke="#010101" cx="351.22" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="351.22" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆</text>
</g>
<!-- S₆₂&#45;&gt;S₆ -->
<g id="edge14" class="edge">
<title>S₆₂&#45;&gt;S₆</title>
<path fill="none" stroke="#010101" d="M280.5,-18C292.25,-18 308.29,-18 322.02,-18" />
<polygon fill="#010101" stroke="#010101" points="321.81,-21.5 331.81,-18 321.81,-14.5 321.81,-21.5" />
<text text-anchor="middle" x="311.85" y="-21.2" font-family="Times,serif" font-size="14.00" fill="#010101">d</text>
</g>
<!-- Box1&#45;&gt;S₁₂ -->
<g id="edge6" class="edge">
<title>Box1:t&#45;&gt;S₁₂</title>
<path fill="none" stroke="#010101" d="M182.68,-231.72C198.12,-240.75 220.34,-253.74 237.31,-263.66" />
<polygon fill="#010101" stroke="#010101" points="235.39,-266.59 245.78,-268.61 238.92,-260.54 235.39,-266.59" />
<text text-anchor="middle" x="213.1" y="-254.2" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box1&#45;&gt;S₂₂ -->
<g id="edge7" class="edge">
<title>Box1:t&#45;&gt;S₂₂</title>
<path fill="none" stroke="#010101" d="M182.68,-221.56C197.07,-222.01 217.33,-222.63 233.75,-223.14" />
<polygon fill="#010101" stroke="#010101" points="233.28,-226.62 243.38,-223.43 233.49,-219.63 233.28,-226.62" />
<text text-anchor="middle" x="213.1" y="-225.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- Box3 -->
<g id="node14" class="node">
<title>Box3</title>
<text text-anchor="start" x="248.22" y="-165.45" font-family="Times,serif" font-size="14.00" fill="#010101">Box3</text>
<polygon fill="#aaaaaa" stroke="none" points="246.22,-137.75 246.22,-158.25 279.47,-158.25 279.47,-137.75 246.22,-137.75" />
<text text-anchor="start" x="256.1" y="-142.95" font-family="Times,serif" font-size="14.00" fill="#010101">E₄</text>
<polygon fill="#777777" stroke="none" points="246.22,-115.25 246.22,-135.75 279.47,-135.75 279.47,-115.25 246.22,-115.25" />
<text text-anchor="start" x="256.47" y="-120.45" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅</text>
<polygon fill="none" stroke="#010101" points="243.22,-112.25 243.22,-183.75 282.47,-183.75 282.47,-112.25 243.22,-112.25" />
</g>
<!-- Box1&#45;&gt;Box3 -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;Box3:t</title>
<path fill="none" stroke="#010101" d="M182.68,-207.27C197.16,-196.43 217.6,-181.13 234.08,-168.78" />
<polygon fill="#010101" stroke="#010101" points="236.14,-171.62 242.05,-162.82 231.94,-166.02 236.14,-171.62" />
<text text-anchor="middle" x="213.1" y="-189.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- Box2&#45;&gt;S₃₂ -->
<g id="edge11" class="edge">
<title>Box2:t&#45;&gt;S₃₂</title>
<path fill="none" stroke="#010101" d="M182.68,-76.06C197.07,-75.32 217.33,-74.28 233.75,-73.44" />
<polygon fill="#010101" stroke="#010101" points="233.57,-76.95 243.38,-72.95 233.22,-69.96 233.57,-76.95" />
<text text-anchor="middle" x="213.1" y="-78.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- Box2&#45;&gt;S₆₂ -->
<g id="edge13" class="edge">
<title>Box2:t&#45;&gt;S₆₂</title>
<path fill="none" stroke="#010101" d="M182.68,-65.9C198.22,-56.5 220.6,-42.96 237.61,-32.66" />
<polygon fill="#010101" stroke="#010101" points="239.36,-35.7 246.1,-27.53 235.73,-29.71 239.36,-35.7" />
<text text-anchor="middle" x="213.1" y="-53.2" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box2&#45;&gt;Box3 -->
<g id="edge10" class="edge">
<title>Box2:t&#45;&gt;Box3:t</title>
<path fill="none" stroke="#010101" d="M182.68,-90.35C197.16,-100.9 217.6,-115.78 234.08,-127.78" />
<polygon fill="#010101" stroke="#010101" points="231.89,-130.52 242.03,-133.57 236.01,-124.86 231.89,-130.52" />
<text text-anchor="middle" x="213.1" y="-118.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
</g>
</svg>
</div>

<p>We now have a reduce-reduce conflict in box 3 again. With look-ahead <code class="language-plaintext highlighter-rouge">a</code> you can reduce to both <code class="language-plaintext highlighter-rouge">E</code> and <code class="language-plaintext highlighter-rouge">F</code>. Same for look-ahead <code class="language-plaintext highlighter-rouge">b</code> by the way. It <em>is</em> deterministically decidable which one we should reduce to, but it basically now depends on which state we came from.</p>

<p>With LALR we build an automaton for each rule, and try to reuse that rule independent of the context in which it is used. That’s keeps our process simple, our automaton small, but it also causes us to lose exactly the information we need to resolve the reduce-reduce conflict in box 3 above: the left context. I know the information is technically on the stack, but our parsing process decides on the rule to reduce by based on the state and look-ahead only.</p>

<p>LR(k) automata/parsers keep the same parsing process still, they just have larger automata in which their states summarise the left context. We’re basically going to distinguish almost every occurrence of a sort in the grammar, similar to when we made our LL(2) grammar strong:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: A LR(1) automaton for the above grammar Pages: 1 -->
<svg role="img" aria-label="A LR(1) automaton for the above grammar" width="403pt" height="402pt" viewBox="0.00 0.00 403.47 402.00">
<title>A LR(1) automaton for the above grammar</title>
<desc>digraph &quot;A LR(1) automaton for the above grammar&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

subgraph {
rank=same;
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box0&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₀ ($)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀ ($)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₀ ($)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₆₀ ($)&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
Box0:t:s -&gt; fin:n [xlabel=&quot;S  &quot;];
}

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
S₁₂;
S₁;
S₂₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₂ [style=filled, fillcolor=&quot;#ddd&quot;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box1&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₁ ($)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₁ ($)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀ (c)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀ (d)&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box2 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box2&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₁ ($)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₆₁ ($)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀ (d)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀ (c)&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box3 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box3&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₁ (c)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₁ (d)&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box4 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box4&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₁ (d)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₁ (c)&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
S₃₂;
S₃;
S₆₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₆ [style=filled, fillcolor=&quot;#ddd&quot;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;a&quot;];
Box0:t -&gt; Box2:t [label=&quot;b&quot;];
Box1:t -&gt; Box3:t [label=&quot;e&quot;];
Box1:t -&gt; S₁₂ [label=&quot;E&quot;];
Box1:t -&gt; S₂₂ [label=&quot;F&quot;];
S₁₂ -&gt; S₁ [label=&quot;c&quot;];
S₂₂ -&gt; S₂ [label=&quot;d&quot;];
Box2:t -&gt; Box4:t [label=&quot;e&quot;];
Box2:t -&gt; S₃₂ [label=&quot;F&quot;];
S₃₂ -&gt; S₃ [label=&quot;c&quot;];
Box2:t -&gt; S₆₂ [label=&quot;E&quot;];
S₆₂ -&gt; S₆ [label=&quot;d&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 398)">
<title>A LR(1) automaton for the above grammar</title>
<!-- Box0 -->
<g id="node1" class="node">
<title>Box0</title>
<text text-anchor="start" x="54.85" y="-231.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box0</text>
<text text-anchor="start" x="50.72" y="-209.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀ ($)</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-181.75 48.72,-202.25 90.22,-202.25 90.22,-181.75 48.72,-181.75" />
<text text-anchor="start" x="50.72" y="-186.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀ ($)</text>
<text text-anchor="start" x="50.72" y="-164.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₀ ($)</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-136.75 48.72,-157.25 90.22,-157.25 90.22,-136.75 48.72,-136.75" />
<text text-anchor="start" x="50.72" y="-141.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₀ ($)</text>
<polygon fill="none" stroke="#010101" points="45.72,-133.75 45.72,-250.25 93.22,-250.25 93.22,-133.75 45.72,-133.75" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="69.47" cy="-76" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="69.47" cy="-76" rx="18.4" ry="18.4" />
</g>
<!-- Box0&#45;&gt;fin -->
<g id="edge1" class="edge">
<title>Box0:s&#45;&gt;fin:n</title>
<path fill="none" stroke="#010101" d="M69.47,-105.83C69.47,-114.74 69.47,-120.4 69.47,-133" />
<polygon fill="#010101" stroke="#010101" points="72.97,-105.91 69.47,-95.91 65.97,-105.91 72.97,-105.91" />
<text text-anchor="middle" x="61.97" y="-100.24" font-family="Times,serif" font-size="14.00" fill="#010101">S &#160;</text>
</g>
<!-- Box1 -->
<g id="node8" class="node">
<title>Box1</title>
<text text-anchor="start" x="161.47" y="-305.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box1</text>
<text text-anchor="start" x="157.35" y="-283.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁ ($)</text>
<polygon fill="#dddddd" stroke="none" points="155.35,-255.75 155.35,-276.25 196.85,-276.25 196.85,-255.75 155.35,-255.75" />
<text text-anchor="start" x="157.35" y="-260.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₁ ($)</text>
<polygon fill="#aaaaaa" stroke="none" points="155.35,-233.25 155.35,-253.75 196.85,-253.75 196.85,-233.25 155.35,-233.25" />
<text text-anchor="start" x="157.35" y="-238.45" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀ (c)</text>
<polygon fill="#777777" stroke="none" points="155.35,-210.75 155.35,-231.25 196.85,-231.25 196.85,-210.75 155.35,-210.75" />
<text text-anchor="start" x="157.35" y="-215.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀ (d)</text>
<polygon fill="none" stroke="#010101" points="152.35,-207.75 152.35,-324.25 199.85,-324.25 199.85,-207.75 152.35,-207.75" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M93.17,-208.06C107.84,-218.43 127.14,-232.09 143.33,-243.53" />
<polygon fill="#010101" stroke="#010101" points="141.02,-246.18 151.2,-249.1 145.06,-240.47 141.02,-246.18" />
<text text-anchor="middle" x="122.6" y="-234.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- Box2 -->
<g id="node9" class="node">
<title>Box2</title>
<text text-anchor="start" x="161.47" y="-147.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box2</text>
<text text-anchor="start" x="157.35" y="-125.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₁ ($)</text>
<polygon fill="#dddddd" stroke="none" points="154.97,-97.75 154.97,-118.25 197.22,-118.25 197.22,-97.75 154.97,-97.75" />
<text text-anchor="start" x="157.35" y="-102.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₁ ($)</text>
<polygon fill="#aaaaaa" stroke="none" points="154.97,-75.25 154.97,-95.75 197.22,-95.75 197.22,-75.25 154.97,-75.25" />
<text text-anchor="start" x="156.97" y="-80.45" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀ (d)</text>
<polygon fill="#777777" stroke="none" points="154.97,-52.75 154.97,-73.25 197.22,-73.25 197.22,-52.75 154.97,-52.75" />
<text text-anchor="start" x="157.72" y="-57.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀ (c)</text>
<polygon fill="none" stroke="#010101" points="151.97,-49.75 151.97,-166.25 200.22,-166.25 200.22,-49.75 151.97,-49.75" />
</g>
<!-- Box0&#45;&gt;Box2 -->
<g id="edge4" class="edge">
<title>Box0:t&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M93.17,-173.77C107.88,-161.97 127.24,-146.42 143.45,-133.41" />
<polygon fill="#010101" stroke="#010101" points="145.29,-136.42 150.9,-127.43 140.91,-130.96 145.29,-136.42" />
<text text-anchor="middle" x="122.6" y="-156.2" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- start1 -->
<g id="node3" class="node">
<title>start1</title>
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge2" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.17,-192C23.2,-192 28.86,-192 34.53,-192" />
<polygon fill="#010101" stroke="#010101" points="34.45,-195.5 44.45,-192 34.45,-188.5 34.45,-195.5" />
</g>
<!-- S₁₂ -->
<g id="node4" class="node">
<title>S₁₂</title>
<ellipse fill="none" stroke="#010101" cx="284.6" cy="-376" rx="18" ry="18" />
<text text-anchor="middle" x="284.6" y="-370.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₂</text>
</g>
<!-- S₁ -->
<g id="node5" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="377.47" cy="-376" rx="18" ry="18" />
<text text-anchor="middle" x="377.47" y="-370.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁₂&#45;&gt;S₁ -->
<g id="edge8" class="edge">
<title>S₁₂&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M302.26,-376C315.12,-376 333.2,-376 348.29,-376" />
<polygon fill="#010101" stroke="#010101" points="348.09,-379.5 358.09,-376 348.09,-372.5 348.09,-379.5" />
<text text-anchor="middle" x="338.1" y="-379.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- S₂₂ -->
<g id="node6" class="node">
<title>S₂₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="284.6" cy="-322" rx="18" ry="18" />
<text text-anchor="middle" x="284.6" y="-316.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₂</text>
</g>
<!-- S₂ -->
<g id="node7" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="377.47" cy="-322" rx="18" ry="18" />
<text text-anchor="middle" x="377.47" y="-316.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂₂&#45;&gt;S₂ -->
<g id="edge9" class="edge">
<title>S₂₂&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M302.26,-322C315.12,-322 333.2,-322 348.29,-322" />
<polygon fill="#010101" stroke="#010101" points="348.09,-325.5 358.09,-322 348.09,-318.5 348.09,-325.5" />
<text text-anchor="middle" x="338.1" y="-325.2" font-family="Times,serif" font-size="14.00" fill="#010101">d</text>
</g>
<!-- Box1&#45;&gt;S₁₂ -->
<g id="edge6" class="edge">
<title>Box1:t&#45;&gt;S₁₂</title>
<path fill="none" stroke="#010101" d="M199.75,-292.54C214.34,-309.21 233.96,-330.9 252.47,-349 255.51,-351.98 258.82,-355.03 262.11,-357.96" />
<polygon fill="#010101" stroke="#010101" points="259.58,-360.39 269.43,-364.31 264.17,-355.11 259.58,-360.39" />
<text text-anchor="middle" x="230.35" y="-332.2" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box1&#45;&gt;S₂₂ -->
<g id="edge7" class="edge">
<title>Box1:t&#45;&gt;S₂₂</title>
<path fill="none" stroke="#010101" d="M199.68,-277.88C216.95,-286.96 240.76,-299.47 258.6,-308.86" />
<polygon fill="#010101" stroke="#010101" points="256.76,-311.84 267.24,-313.4 260.01,-305.65 256.76,-311.84" />
<text text-anchor="middle" x="230.35" y="-298.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- Box3 -->
<g id="node10" class="node">
<title>Box3</title>
<text text-anchor="start" x="269.97" y="-263.45" font-family="Times,serif" font-size="14.00" fill="#010101">Box3</text>
<polygon fill="#aaaaaa" stroke="none" points="263.85,-235.75 263.85,-256.25 305.35,-256.25 305.35,-235.75 263.85,-235.75" />
<text text-anchor="start" x="265.85" y="-240.95" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₁ (c)</text>
<polygon fill="#777777" stroke="none" points="263.85,-213.25 263.85,-233.75 305.35,-233.75 305.35,-213.25 263.85,-213.25" />
<text text-anchor="start" x="265.85" y="-218.45" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₁ (d)</text>
<polygon fill="none" stroke="#010101" points="260.85,-210.25 260.85,-281.75 308.35,-281.75 308.35,-210.25 260.85,-210.25" />
</g>
<!-- Box1&#45;&gt;Box3 -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;Box3:t</title>
<path fill="none" stroke="#010101" d="M199.68,-261.76C214.22,-259.03 233.4,-255.43 249.74,-252.36" />
<polygon fill="#010101" stroke="#010101" points="250.37,-255.8 259.55,-250.51 249.08,-248.92 250.37,-255.8" />
<text text-anchor="middle" x="230.35" y="-259.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- Box4 -->
<g id="node11" class="node">
<title>Box4</title>
<text text-anchor="start" x="269.97" y="-165.45" font-family="Times,serif" font-size="14.00" fill="#010101">Box4</text>
<polygon fill="#aaaaaa" stroke="none" points="263.47,-137.75 263.47,-158.25 305.72,-158.25 305.72,-137.75 263.47,-137.75" />
<text text-anchor="start" x="265.47" y="-142.95" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₁ (d)</text>
<polygon fill="#777777" stroke="none" points="263.47,-115.25 263.47,-135.75 305.72,-135.75 305.72,-115.25 263.47,-115.25" />
<text text-anchor="start" x="266.22" y="-120.45" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₁ (c)</text>
<polygon fill="none" stroke="#010101" points="260.47,-112.25 260.47,-183.75 308.72,-183.75 308.72,-112.25 260.47,-112.25" />
</g>
<!-- Box2&#45;&gt;Box4 -->
<g id="edge10" class="edge">
<title>Box2:t&#45;&gt;Box4:t</title>
<path fill="none" stroke="#010101" d="M200.2,-116.68C214.72,-122.13 233.69,-129.26 249.87,-135.33" />
<polygon fill="#010101" stroke="#010101" points="248.52,-138.57 259.11,-138.81 250.98,-132.01 248.52,-138.57" />
<text text-anchor="middle" x="230.35" y="-133.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- S₃₂ -->
<g id="node12" class="node">
<title>S₃₂</title>
<ellipse fill="none" stroke="#010101" cx="284.6" cy="-72" rx="18" ry="18" />
<text text-anchor="middle" x="284.6" y="-66.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₂</text>
</g>
<!-- Box2&#45;&gt;S₃₂ -->
<g id="edge11" class="edge">
<title>Box2:t&#45;&gt;S₃₂</title>
<path fill="none" stroke="#010101" d="M200.2,-100.19C216.87,-94.56 239.4,-86.94 256.84,-81.04" />
<polygon fill="#010101" stroke="#010101" points="257.67,-84.46 266.02,-77.94 255.42,-77.83 257.67,-84.46" />
<text text-anchor="middle" x="230.35" y="-95.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- S₆₂ -->
<g id="node14" class="node">
<title>S₆₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="284.6" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="284.6" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₂</text>
</g>
<!-- Box2&#45;&gt;S₆₂ -->
<g id="edge13" class="edge">
<title>Box2:t&#45;&gt;S₆₂</title>
<path fill="none" stroke="#010101" d="M200.2,-88.47C218.54,-72.97 243.99,-51.47 261.94,-36.3" />
<polygon fill="#010101" stroke="#010101" points="264.03,-39.12 269.41,-29.99 259.51,-33.77 264.03,-39.12" />
<text text-anchor="middle" x="230.35" y="-69.2" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- S₃ -->
<g id="node13" class="node">
<title>S₃</title>
<ellipse fill="none" stroke="#010101" cx="377.47" cy="-72" rx="18" ry="18" />
<text text-anchor="middle" x="377.47" y="-66.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃</text>
</g>
<!-- S₃₂&#45;&gt;S₃ -->
<g id="edge12" class="edge">
<title>S₃₂&#45;&gt;S₃</title>
<path fill="none" stroke="#010101" d="M302.26,-72C315.12,-72 333.2,-72 348.29,-72" />
<polygon fill="#010101" stroke="#010101" points="348.09,-75.5 358.09,-72 348.09,-68.5 348.09,-75.5" />
<text text-anchor="middle" x="338.1" y="-75.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- S₆ -->
<g id="node15" class="node">
<title>S₆</title>
<ellipse fill="#dddddd" stroke="#010101" cx="377.47" cy="-18" rx="18" ry="18" />
<text text-anchor="middle" x="377.47" y="-12.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆</text>
</g>
<!-- S₆₂&#45;&gt;S₆ -->
<g id="edge14" class="edge">
<title>S₆₂&#45;&gt;S₆</title>
<path fill="none" stroke="#010101" d="M302.26,-18C315.12,-18 333.2,-18 348.29,-18" />
<polygon fill="#010101" stroke="#010101" points="348.09,-21.5 358.09,-18 348.09,-14.5 348.09,-21.5" />
<text text-anchor="middle" x="338.1" y="-21.2" font-family="Times,serif" font-size="14.00" fill="#010101">d</text>
</g>
</g>
</svg>
</div>

<p>How do we do this? We duplicate each rule for each terminal in the LL follow set of the sort of that rule. We annotate each of those rules with that terminal. Now we do our usual thing: rule to automaton, epsilons, NFA-to-DFA. But when wiring the epsilons, extra terminal annotations should now match up with the <em>LALR</em> follow set of the occurrence of the sort.</p>

<p>With this particular example, the automaton looks almost the same. There’s a bit more fluff with the annotations, but they basically propagate the look-ahead for each rule. Which means we can distinguish the context in which <code class="language-plaintext highlighter-rouge">E</code> and <code class="language-plaintext highlighter-rouge">F</code> are used differently! In general though, duplicating each rule for each terminal in the LL follow set leads to a very large amount of rules, and plenty of the time this isn’t necessary… LR(1) automata have lots of redundant states that do basically the same thing and would have been merged in LALR without any reduce-reduce conflicts.</p>

<h3 id="parse-table-construction-algorithm">Parse table construction algorithm</h3>

<p>You’ve already seen parse table construction by automaton for both LL and the many flavours of LR now. And you’ve seen parse table construction by <em>First</em> and <em>Follow</em> set for LL. Parse table construction for LR will of course also require <em>First</em> and <em>Follow</em> sets, sometimes including more accurate <em>Follow</em> sets for particular occurrences of sorts. It’s mostly an iterative build-up of the NFA-to-DFA (powerset construction) though. I’m not going to detail that in this post.</p>

<p>While researching the material, I found some claims for <em>minimal</em> LR(1) algorithms, which create LALR(1) tables when possible, and slightly larger tables when necessary. They look interesting, but quite something to figure out, and I haven’t gotten to what I wanted to write about most yet, so that will have to wait until some other time. Perhaps I’ll include the normal LR parse table construction algorithm there too as a start.</p>

<h2 id="recursive-ascent">Recursive Ascent</h2>

<p>We finally get to the original impetus for this blog post: recursive ascent parsing. As you might be able to guess, this is the LR analogue to recursive <em>descent</em> for LL. So we’re going to write code that directly executes the LR automaton instead of simulating it by parse table interpretation.</p>

<p>Before, in recursive descent parsing, we saw that rules and sorts become functions. Rules call sort functions to parse a sort, and sorts check the look-ahead to choose a rule by which to parse the alternative of the sort. Basically grammar rules became functions, and the parse table was split into functions for each sort.</p>

<p>In recursive <em>ascent</em> parsing we will turn states of the LR automaton into functions. Each function will shift or reduce based on the input and call the corresponding state for that edge. Let’s expand our LR(1) example a little bit, and then take a look at the recursive ascent parsing:</p>

<table>
  <tbody>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>E</mi><mi>c</mi></mrow><annotation encoding="application/x-tex"> S = a E c         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">c</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(1)</mtext></mrow><annotation encoding="application/x-tex"> \text{(1)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(1)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>a</mi><mi>F</mi><mi>d</mi></mrow><annotation encoding="application/x-tex"> S = a F d         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">d</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(2)</mtext></mrow><annotation encoding="application/x-tex"> \text{(2)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(2)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>b</mi><mi>F</mi><mi>c</mi></mrow><annotation encoding="application/x-tex"> S = b F c         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">c</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(3)</mtext></mrow><annotation encoding="application/x-tex"> \text{(3)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(3)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex"> E = e e           </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ee</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(4)</mtext></mrow><annotation encoding="application/x-tex"> \text{(4)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(4)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex"> F = e e           </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ee</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(5)</mtext></mrow><annotation encoding="application/x-tex"> \text{(5)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(5)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>b</mi><mi>E</mi><mi>d</mi></mrow><annotation encoding="application/x-tex"> S = b E d         </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">d</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(6)</mtext></mrow><annotation encoding="application/x-tex"> \text{(6)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(6)</span></span></span></span></span></td>
    </tr>
    <tr>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mi>b</mi><mi>e</mi><mi>e</mi><mi>a</mi></mrow><annotation encoding="application/x-tex"> S = b e e a       </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">ee</span><span class="mord mathnormal">a</span></span></span></span></td>
      <td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>(7)</mtext></mrow><annotation encoding="application/x-tex"> \text{(7)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(7)</span></span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>The reason for the extra <code class="language-plaintext highlighter-rouge">e</code>s in rules 3 and 4 is to show how that increases the LR(1) automaton size. We’ll now have 4 states instead of 2 + an LALR reduce-reduce conflict. The reason for adding rule 7 is so we have a state where we might shift or reduce depending on the look-ahead, which influences the code we generate. Let’s check out the automaton first:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 10.0.1 (0)
 -->
<!-- Title: A LR(0) automaton for the above grammar Pages: 1 -->
<svg role="img" aria-label="A LR(0) automaton for the above grammar" width="478pt" height="424pt" viewBox="0.00 0.00 478.22 424.00">
<title>A LR(0) automaton for the above grammar</title>
<desc>digraph &quot;A LR(0) automaton for the above grammar&quot; { 
bgcolor=&quot;transparent&quot;;
node [shape=circle, fixedsize=shape, width=0.5, fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
edge [fontcolor=&quot;#010101&quot;, color=&quot;#010101&quot;];
rankdir=LR;

subgraph {
rank=same;
Box0 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box0&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₀&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₆₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₇₀&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
Box0:t:s -&gt; fin:n [xlabel=&quot;S  &quot;];
}

start1 [shape=none, label=&quot;&quot;, width=0];
fin [shape=doublecircle, width=0.4, label=&quot;&quot;];
S₁₂;
S₁;
S₂₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₃₂;
S₃;
S₆₂ [style=filled, fillcolor=&quot;#ddd&quot;];
S₆ [style=filled, fillcolor=&quot;#ddd&quot;];
Box1 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box1&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₁₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₂₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box2 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box2&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₃₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#ddd&quot;&gt;S₆₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₇₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₀&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₀&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box3 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box3&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₁&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box4 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box4&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₇₂&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄₁&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅₁&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box5 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box5&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄ (c)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅ (d)&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
Box6 [shape=none, label=&lt;&lt;table cellborder=&quot;0&quot; port=&quot;t&quot;&gt;
	&lt;tr&gt;&lt;td&gt;Box6&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td&gt;S₇₃&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#aaa&quot;&gt;E₄ (d)&lt;/td&gt;&lt;/tr&gt;
	&lt;tr&gt;&lt;td bgcolor=&quot;#777&quot;&gt;&lt;font color=&quot;#fefefe&quot;&gt;F₅ (c)&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&gt;];
start1 -&gt; Box0:t;
Box0:t -&gt; Box1:t [label=&quot;a&quot;];
Box0:t -&gt; Box2:t [label=&quot;b&quot;];
Box1:t -&gt; Box3:t [label=&quot;e&quot;];
Box1:t -&gt; S₁₂ [label=&quot;E&quot;];
Box1:t -&gt; S₂₂ [label=&quot;F&quot;];
Box3:t -&gt; Box5:t [label=&quot;e&quot;];
S₁₂ -&gt; S₁ [label=&quot;c&quot;];
S₂₂ -&gt; S₂ [label=&quot;d&quot;];
Box2:t -&gt; Box4:t [label=&quot;e&quot;];
Box2:t -&gt; S₃₂ [label=&quot;F&quot;];
S₃₂ -&gt; S₃ [label=&quot;c&quot;];
Box2:t -&gt; S₆₂ [label=&quot;E&quot;];
S₆₂ -&gt; S₆ [label=&quot;d&quot;];
Box4:t -&gt; Box6:t [label=&quot;e&quot;];
Box6:t -&gt; S₇ [label=&quot;a&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 420)">
<title>A LR(0) automaton for the above grammar</title>
<!-- Box0 -->
<g id="node1" class="node">
<title>Box0</title>
<text text-anchor="start" x="50.72" y="-291.2" font-family="Times,serif" font-size="14.00" fill="#010101">Box0</text>
<text text-anchor="start" x="56.35" y="-268.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-241 48.72,-261.5 81.97,-261.5 81.97,-241 48.72,-241" />
<text text-anchor="start" x="56.35" y="-246.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₀</text>
<text text-anchor="start" x="56.35" y="-223.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₀</text>
<polygon fill="#dddddd" stroke="none" points="48.72,-196 48.72,-216.5 81.97,-216.5 81.97,-196 48.72,-196" />
<text text-anchor="start" x="56.35" y="-201.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₀</text>
<text text-anchor="start" x="56.35" y="-178.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₇₀</text>
<polygon fill="none" stroke="#010101" points="45.72,-170.5 45.72,-309.5 84.97,-309.5 84.97,-170.5 45.72,-170.5" />
</g>
<!-- fin -->
<g id="node2" class="node">
<title>fin</title>
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-113" rx="14.4" ry="14.4" />
<ellipse fill="none" stroke="#010101" cx="65.35" cy="-113" rx="18.4" ry="18.4" />
</g>
<!-- Box0&#45;&gt;fin -->
<g id="edge1" class="edge">
<title>Box0:s&#45;&gt;fin:n</title>
<path fill="none" stroke="#010101" d="M65.35,-142.81C65.35,-151.33 65.35,-156.86 65.35,-169" />
<polygon fill="#010101" stroke="#010101" points="68.85,-142.91 65.35,-132.91 61.85,-142.91 68.85,-142.91" />
<text text-anchor="middle" x="57.85" y="-136.92" font-family="Times,serif" font-size="14.00" fill="#010101">S &#160;</text>
</g>
<!-- Box1 -->
<g id="node12" class="node">
<title>Box1</title>
<text text-anchor="start" x="148.72" y="-346.95" font-family="Times,serif" font-size="14.00" fill="#010101">Box1</text>
<text text-anchor="start" x="154.35" y="-324.45" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₁</text>
<polygon fill="#dddddd" stroke="none" points="146.72,-296.75 146.72,-317.25 179.97,-317.25 179.97,-296.75 146.72,-296.75" />
<text text-anchor="start" x="154.35" y="-301.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₁</text>
<polygon fill="#aaaaaa" stroke="none" points="146.72,-274.25 146.72,-294.75 179.97,-294.75 179.97,-274.25 146.72,-274.25" />
<text text-anchor="start" x="153.97" y="-279.45" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀</text>
<polygon fill="#777777" stroke="none" points="146.72,-251.75 146.72,-272.25 179.97,-272.25 179.97,-251.75 146.72,-251.75" />
<text text-anchor="start" x="154.35" y="-256.95" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀</text>
<polygon fill="none" stroke="#010101" points="143.72,-248.75 143.72,-365.25 182.97,-365.25 182.97,-248.75 143.72,-248.75" />
</g>
<!-- Box0&#45;&gt;Box1 -->
<g id="edge3" class="edge">
<title>Box0:t&#45;&gt;Box1:t</title>
<path fill="none" stroke="#010101" d="M84.85,-252.92C98.93,-262.74 118.54,-276.42 134.5,-287.57" />
<polygon fill="#010101" stroke="#010101" points="132.45,-290.4 142.65,-293.26 136.45,-284.66 132.45,-290.4" />
<text text-anchor="middle" x="114.35" y="-278.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
<!-- Box2 -->
<g id="node13" class="node">
<title>Box2</title>
<text text-anchor="start" x="148.72" y="-200.2" font-family="Times,serif" font-size="14.00" fill="#010101">Box2</text>
<text text-anchor="start" x="154.35" y="-177.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₁</text>
<polygon fill="#dddddd" stroke="none" points="146.72,-150 146.72,-170.5 179.97,-170.5 179.97,-150 146.72,-150" />
<text text-anchor="start" x="154.35" y="-155.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₁</text>
<text text-anchor="start" x="154.35" y="-132.7" font-family="Times,serif" font-size="14.00" fill="#010101">S₇₁</text>
<polygon fill="#aaaaaa" stroke="none" points="146.72,-105 146.72,-125.5 179.97,-125.5 179.97,-105 146.72,-105" />
<text text-anchor="start" x="153.97" y="-110.2" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₀</text>
<polygon fill="#777777" stroke="none" points="146.72,-82.5 146.72,-103 179.97,-103 179.97,-82.5 146.72,-82.5" />
<text text-anchor="start" x="154.35" y="-87.7" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₀</text>
<polygon fill="none" stroke="#010101" points="143.72,-79.5 143.72,-218.5 182.97,-218.5 182.97,-79.5 143.72,-79.5" />
</g>
<!-- Box0&#45;&gt;Box2 -->
<g id="edge4" class="edge">
<title>Box0:t&#45;&gt;Box2:t</title>
<path fill="none" stroke="#010101" d="M84.85,-222.45C99.33,-208.73 119.65,-189.47 135.85,-174.12" />
<polygon fill="#010101" stroke="#010101" points="137.94,-176.95 142.79,-167.53 133.13,-171.87 137.94,-176.95" />
<text text-anchor="middle" x="114.35" y="-201.2" font-family="Times,serif" font-size="14.00" fill="#010101">b</text>
</g>
<!-- start1 -->
<g id="node3" class="node">
<title>start1</title>
</g>
<!-- start1&#45;&gt;Box0 -->
<g id="edge2" class="edge">
<title>start1&#45;&gt;Box0:t</title>
<path fill="none" stroke="#010101" d="M18.11,-240C23.26,-240 29.06,-240 34.76,-240" />
<polygon fill="#010101" stroke="#010101" points="34.58,-243.5 44.58,-240 34.58,-236.5 34.58,-243.5" />
</g>
<!-- S₁₂ -->
<g id="node4" class="node">
<title>S₁₂</title>
<ellipse fill="none" stroke="#010101" cx="262.85" cy="-398" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-392.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁₂</text>
</g>
<!-- S₁ -->
<g id="node5" class="node">
<title>S₁</title>
<ellipse fill="none" stroke="#010101" cx="362.72" cy="-398" rx="18" ry="18" />
<text text-anchor="middle" x="362.72" y="-392.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₁</text>
</g>
<!-- S₁₂&#45;&gt;S₁ -->
<g id="edge9" class="edge">
<title>S₁₂&#45;&gt;S₁</title>
<path fill="none" stroke="#010101" d="M280.45,-398C295,-398 316.46,-398 333.67,-398" />
<polygon fill="#010101" stroke="#010101" points="333.52,-401.5 343.52,-398 333.52,-394.5 333.52,-401.5" />
<text text-anchor="middle" x="311.85" y="-401.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- S₂₂ -->
<g id="node6" class="node">
<title>S₂₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="262.85" cy="-344" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-338.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂₂</text>
</g>
<!-- S₂ -->
<g id="node7" class="node">
<title>S₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="362.72" cy="-344" rx="18" ry="18" />
<text text-anchor="middle" x="362.72" y="-338.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₂</text>
</g>
<!-- S₂₂&#45;&gt;S₂ -->
<g id="edge10" class="edge">
<title>S₂₂&#45;&gt;S₂</title>
<path fill="none" stroke="#010101" d="M280.45,-344C295,-344 316.46,-344 333.67,-344" />
<polygon fill="#010101" stroke="#010101" points="333.52,-347.5 343.52,-344 333.52,-340.5 333.52,-347.5" />
<text text-anchor="middle" x="311.85" y="-347.2" font-family="Times,serif" font-size="14.00" fill="#010101">d</text>
</g>
<!-- S₃₂ -->
<g id="node8" class="node">
<title>S₃₂</title>
<ellipse fill="none" stroke="#010101" cx="262.85" cy="-192" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-186.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃₂</text>
</g>
<!-- S₃ -->
<g id="node9" class="node">
<title>S₃</title>
<ellipse fill="none" stroke="#010101" cx="362.72" cy="-192" rx="18" ry="18" />
<text text-anchor="middle" x="362.72" y="-186.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₃</text>
</g>
<!-- S₃₂&#45;&gt;S₃ -->
<g id="edge13" class="edge">
<title>S₃₂&#45;&gt;S₃</title>
<path fill="none" stroke="#010101" d="M280.45,-192C295,-192 316.46,-192 333.67,-192" />
<polygon fill="#010101" stroke="#010101" points="333.52,-195.5 343.52,-192 333.52,-188.5 333.52,-195.5" />
<text text-anchor="middle" x="311.85" y="-195.2" font-family="Times,serif" font-size="14.00" fill="#010101">c</text>
</g>
<!-- S₆₂ -->
<g id="node10" class="node">
<title>S₆₂</title>
<ellipse fill="#dddddd" stroke="#010101" cx="262.85" cy="-138" rx="18" ry="18" />
<text text-anchor="middle" x="262.85" y="-132.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆₂</text>
</g>
<!-- S₆ -->
<g id="node11" class="node">
<title>S₆</title>
<ellipse fill="#dddddd" stroke="#010101" cx="362.72" cy="-138" rx="18" ry="18" />
<text text-anchor="middle" x="362.72" y="-132.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₆</text>
</g>
<!-- S₆₂&#45;&gt;S₆ -->
<g id="edge15" class="edge">
<title>S₆₂&#45;&gt;S₆</title>
<path fill="none" stroke="#010101" d="M280.45,-138C295,-138 316.46,-138 333.67,-138" />
<polygon fill="#010101" stroke="#010101" points="333.52,-141.5 343.52,-138 333.52,-134.5 333.52,-141.5" />
<text text-anchor="middle" x="311.85" y="-141.2" font-family="Times,serif" font-size="14.00" fill="#010101">d</text>
</g>
<!-- Box1&#45;&gt;S₁₂ -->
<g id="edge6" class="edge">
<title>Box1:t&#45;&gt;S₁₂</title>
<path fill="none" stroke="#010101" d="M182.68,-324.12C199.31,-339.64 223.8,-362.49 241.13,-378.67" />
<polygon fill="#010101" stroke="#010101" points="238.66,-381.14 248.35,-385.41 243.43,-376.03 238.66,-381.14" />
<text text-anchor="middle" x="213.1" y="-358.2" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box1&#45;&gt;S₂₂ -->
<g id="edge7" class="edge">
<title>Box1:t&#45;&gt;S₂₂</title>
<path fill="none" stroke="#010101" d="M182.68,-313.96C197.56,-319.61 218.74,-327.64 235.44,-333.98" />
<polygon fill="#010101" stroke="#010101" points="234.16,-337.24 244.75,-337.51 236.64,-330.69 234.16,-337.24" />
<text text-anchor="middle" x="213.1" y="-329.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- Box3 -->
<g id="node14" class="node">
<title>Box3</title>
<text text-anchor="start" x="248.22" y="-285.45" font-family="Times,serif" font-size="14.00" fill="#010101">Box3</text>
<polygon fill="#aaaaaa" stroke="none" points="246.22,-257.75 246.22,-278.25 279.47,-278.25 279.47,-257.75 246.22,-257.75" />
<text text-anchor="start" x="253.47" y="-262.95" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₁</text>
<polygon fill="#777777" stroke="none" points="246.22,-235.25 246.22,-255.75 279.47,-255.75 279.47,-235.25 246.22,-235.25" />
<text text-anchor="start" x="253.85" y="-240.45" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₁</text>
<polygon fill="none" stroke="#010101" points="243.22,-232.25 243.22,-303.75 282.47,-303.75 282.47,-232.25 243.22,-232.25" />
</g>
<!-- Box1&#45;&gt;Box3 -->
<g id="edge5" class="edge">
<title>Box1:t&#45;&gt;Box3:t</title>
<path fill="none" stroke="#010101" d="M182.68,-299.66C196.76,-294.04 216.46,-286.15 232.69,-279.66" />
<polygon fill="#010101" stroke="#010101" points="233.87,-282.96 241.85,-276 231.27,-276.46 233.87,-282.96" />
<text text-anchor="middle" x="213.1" y="-291.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- Box2&#45;&gt;S₃₂ -->
<g id="edge12" class="edge">
<title>Box2:t&#45;&gt;S₃₂</title>
<path fill="none" stroke="#010101" d="M182.68,-157.09C197.8,-163.75 219.4,-173.28 236.23,-180.7" />
<polygon fill="#010101" stroke="#010101" points="234.53,-183.78 245.09,-184.61 237.35,-177.37 234.53,-183.78" />
<text text-anchor="middle" x="213.1" y="-175.2" font-family="Times,serif" font-size="14.00" fill="#010101">F</text>
</g>
<!-- Box2&#45;&gt;S₆₂ -->
<g id="edge14" class="edge">
<title>Box2:t&#45;&gt;S₆₂</title>
<path fill="none" stroke="#010101" d="M182.68,-146.93C197.15,-145.3 217.58,-142.99 234.05,-141.14" />
<polygon fill="#010101" stroke="#010101" points="234.17,-144.65 243.71,-140.05 233.38,-137.69 234.17,-144.65" />
<text text-anchor="middle" x="213.1" y="-147.2" font-family="Times,serif" font-size="14.00" fill="#010101">E</text>
</g>
<!-- Box4 -->
<g id="node15" class="node">
<title>Box4</title>
<text text-anchor="start" x="248.22" y="-79.7" font-family="Times,serif" font-size="14.00" fill="#010101">Box4</text>
<text text-anchor="start" x="253.85" y="-57.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₇₂</text>
<polygon fill="#aaaaaa" stroke="none" points="246.22,-29.5 246.22,-50 279.47,-50 279.47,-29.5 246.22,-29.5" />
<text text-anchor="start" x="253.47" y="-34.7" font-family="Times,serif" font-size="14.00" fill="#010101">E₄₁</text>
<polygon fill="#777777" stroke="none" points="246.22,-7 246.22,-27.5 279.47,-27.5 279.47,-7 246.22,-7" />
<text text-anchor="start" x="253.85" y="-12.2" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅₁</text>
<polygon fill="none" stroke="#010101" points="243.22,-4 243.22,-98 282.47,-98 282.47,-4 243.22,-4" />
</g>
<!-- Box2&#45;&gt;Box4 -->
<g id="edge11" class="edge">
<title>Box2:t&#45;&gt;Box4:t</title>
<path fill="none" stroke="#010101" d="M182.68,-130.57C197.57,-115.61 218.75,-94.31 235.46,-77.52" />
<polygon fill="#010101" stroke="#010101" points="237.62,-80.31 242.19,-70.76 232.66,-75.38 237.62,-80.31" />
<text text-anchor="middle" x="213.1" y="-106.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- Box5 -->
<g id="node16" class="node">
<title>Box5</title>
<text text-anchor="start" x="348.1" y="-285.45" font-family="Times,serif" font-size="14.00" fill="#010101">Box5</text>
<polygon fill="#aaaaaa" stroke="none" points="344.6,-257.75 344.6,-278.25 380.85,-278.25 380.85,-257.75 344.6,-257.75" />
<text text-anchor="start" x="346.6" y="-262.95" font-family="Times,serif" font-size="14.00" fill="#010101">E₄ (c)</text>
<polygon fill="#777777" stroke="none" points="344.6,-235.25 344.6,-255.75 380.85,-255.75 380.85,-235.25 344.6,-235.25" />
<text text-anchor="start" x="346.6" y="-240.45" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅ (d)</text>
<polygon fill="none" stroke="#010101" points="341.6,-232.25 341.6,-303.75 383.85,-303.75 383.85,-232.25 341.6,-232.25" />
</g>
<!-- Box3&#45;&gt;Box5 -->
<g id="edge8" class="edge">
<title>Box3:t&#45;&gt;Box5:t</title>
<path fill="none" stroke="#010101" d="M282.25,-268C295.76,-268 314.42,-268 330.27,-268" />
<polygon fill="#010101" stroke="#010101" points="330.2,-271.5 340.2,-268 330.2,-264.5 330.2,-271.5" />
<text text-anchor="middle" x="311.85" y="-271.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- Box6 -->
<g id="node17" class="node">
<title>Box6</title>
<text text-anchor="start" x="348.1" y="-79.7" font-family="Times,serif" font-size="14.00" fill="#010101">Box6</text>
<text text-anchor="start" x="353.72" y="-57.2" font-family="Times,serif" font-size="14.00" fill="#010101">S₇₃</text>
<polygon fill="#aaaaaa" stroke="none" points="344.22,-29.5 344.22,-50 381.22,-50 381.22,-29.5 344.22,-29.5" />
<text text-anchor="start" x="346.22" y="-34.7" font-family="Times,serif" font-size="14.00" fill="#010101">E₄ (d)</text>
<polygon fill="#777777" stroke="none" points="344.22,-7 344.22,-27.5 381.22,-27.5 381.22,-7 344.22,-7" />
<text text-anchor="start" x="346.97" y="-12.2" font-family="Times,serif" font-size="14.00" fill="#fefefe">F₅ (c)</text>
<polygon fill="none" stroke="#010101" points="341.22,-4 341.22,-98 384.22,-98 384.22,-4 341.22,-4" />
</g>
<!-- Box4&#45;&gt;Box6 -->
<g id="edge16" class="edge">
<title>Box4:t&#45;&gt;Box6:t</title>
<path fill="none" stroke="#010101" d="M282.25,-51C295.67,-51 314.18,-51 329.96,-51" />
<polygon fill="#010101" stroke="#010101" points="329.85,-54.5 339.85,-51 329.85,-47.5 329.85,-54.5" />
<text text-anchor="middle" x="311.85" y="-54.2" font-family="Times,serif" font-size="14.00" fill="#010101">e</text>
</g>
<!-- S₇ -->
<g id="node18" class="node">
<title>S₇</title>
<ellipse fill="none" stroke="#010101" cx="452.22" cy="-51" rx="18" ry="18" />
<text text-anchor="middle" x="452.22" y="-45.95" font-family="Times,serif" font-size="14.00" fill="#010101">S₇</text>
</g>
<!-- Box6&#45;&gt;S₇ -->
<g id="edge17" class="edge">
<title>Box6:t&#45;&gt;S₇</title>
<path fill="none" stroke="#010101" d="M384.01,-51C395.57,-51 410.22,-51 422.89,-51" />
<polygon fill="#010101" stroke="#010101" points="422.76,-54.5 432.76,-51 422.76,-47.5 422.76,-54.5" />
<text text-anchor="middle" x="413.22" y="-54.2" font-family="Times,serif" font-size="14.00" fill="#010101">a</text>
</g>
</g>
</svg>
</div>

<p>Perhaps making both changes at the same time makes this a bad example to show off LR(1) automaton size… If you imagine the automaton without rule 7 you’ll see that boxes 3 and 4 are the same except for their ingoing and outgoing edges. This is what happens with longer rules and having to distinguish the final state of the rules for a different look-ahead (boxes 5 and 6 here).</p>

<p>The other notable difference is that we now have a box 6 that can both shift and reduce. This will make the code for the recursive ascent more interesting. Let’s start with the basics:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">iter</span><span class="p">::</span><span class="n">Peekable</span><span class="p">;</span>

<span class="k">type</span> <span class="n">Iter</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">Peekable</span><span class="o">&lt;</span><span class="nn">std</span><span class="p">::</span><span class="nn">slice</span><span class="p">::</span><span class="n">Iter</span><span class="o">&lt;</span><span class="nv">'a</span><span class="p">,</span> <span class="n">Terminal</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">type</span> <span class="n">Terminal</span> <span class="o">=</span> <span class="nb">char</span><span class="p">;</span>

<span class="nd">#[derive(Clone,</span> <span class="nd">Copy,</span> <span class="nd">Debug,</span> <span class="nd">Eq,</span> <span class="nd">Hash,</span> <span class="nd">PartialEq)]</span>
<span class="k">enum</span> <span class="n">Sort</span> <span class="p">{</span>
    <span class="n">S</span><span class="p">,</span>
    <span class="n">E</span><span class="p">,</span>
    <span class="n">F</span><span class="p">,</span>
<span class="p">}</span>

<span class="c">/// Box0, the starting state of our automaton.</span>
<span class="c">/// Itemset:</span>
<span class="c">/// S = . a E c</span>
<span class="c">/// S = . a F d</span>
<span class="c">/// S = . b F c</span>
<span class="c">/// S = . b E d</span>
<span class="c">/// S = . b e e a</span>
<span class="k">fn</span> <span class="nf">box0</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Unexpected end of input: S = ."</span><span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="nf">box1</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span> <span class="p">{</span>
            <span class="nn">Sort</span><span class="p">::</span><span class="n">S</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(()),</span>
            <span class="n">s</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Unexpected sort: S = a {s:?}"</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'b'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="nf">box2</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span> <span class="p">{</span>
            <span class="nn">Sort</span><span class="p">::</span><span class="n">S</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(()),</span>
            <span class="n">s</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Unexpected sort: S = b {s:?}"</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This should look familiar from the recursive descent parser code. The notable difference is that we now have a function name less connected to the grammar, and more to the LR automaton. This makes it harder to understand the code, stack traces, etc.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// Box1</span>
<span class="c">/// Itemset:</span>
<span class="c">/// S = a . E c</span>
<span class="c">/// S = a . F d</span>
<span class="c">/// E = . e</span>
<span class="c">/// F = . e</span>
<span class="k">fn</span> <span class="nf">box1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing S = a . E; S = a . F"</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'e'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="nf">box3</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span> <span class="p">{</span>
            <span class="nn">Sort</span><span class="p">::</span><span class="n">E</span> <span class="k">=&gt;</span> <span class="nf">s12</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
            <span class="nn">Sort</span><span class="p">::</span><span class="n">F</span> <span class="k">=&gt;</span> <span class="nf">s22</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
            <span class="n">s</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Unexpected sort: S = a {s:?}"</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = a . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// S = a E . c</span>
<span class="k">fn</span> <span class="nf">s12</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing S = a E . c"</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'c'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">s1</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = a E . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// S = a E c .</span>
<span class="k">fn</span> <span class="nf">s1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = a E c . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// S = a F . d</span>
<span class="k">fn</span> <span class="nf">s22</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing S = a F . d"</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'d'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">s2</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = a F . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// S = a F d .</span>
<span class="k">fn</span> <span class="nf">s2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = a F d . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// Box3</span>
<span class="c">/// Itemset:</span>
<span class="c">/// E = e . e (c)</span>
<span class="c">/// F = e . e (d)</span>
<span class="k">fn</span> <span class="nf">box3</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing E or F."</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'e'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">box5</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: E = e . {c} ; F = e . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// Box5</span>
<span class="c">/// Itemset:</span>
<span class="c">/// E = e e . (c)</span>
<span class="c">/// F = e e . (d)</span>
<span class="k">fn</span> <span class="nf">box5</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.peek</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing E or F."</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'c'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">E</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'d'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">F</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: E = e e . {c} ; F = e e . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This bit of code should give you an idea of the code pattern in the “easy case”. Each state either shifts in one-or-more rules it’s in (e.g. <code class="language-plaintext highlighter-rouge">s12</code>, <code class="language-plaintext highlighter-rouge">box3</code>), shifts into a new rule expecting a sort back to use for the goto (e.g. <code class="language-plaintext highlighter-rouge">box1</code>), or reduces (e.g. <code class="language-plaintext highlighter-rouge">s1</code>, <code class="language-plaintext highlighter-rouge">box5</code>).</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// Box2</span>
<span class="c">/// Itemset:</span>
<span class="c">/// S = b . F c</span>
<span class="c">/// S = b . E d</span>
<span class="c">/// S = b . e e a</span>
<span class="c">/// E = . e</span>
<span class="c">/// F = . e</span>
<span class="k">fn</span> <span class="nf">box2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing E or F."</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'e'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="nf">box4</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span> <span class="p">{</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">F</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">s32</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">E</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">s62</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">),</span>
            <span class="n">s</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Unexpected return/sort: S = b {s:?}"</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = b . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is the point where things start looking different. In box 2 we might shift <code class="language-plaintext highlighter-rouge">e</code> because we’ve entered rules 4 or 5 which will reduce to <code class="language-plaintext highlighter-rouge">E</code> or <code class="language-plaintext highlighter-rouge">F</code>. But we could also be in rule 7. If the result from box 4 is that we were in rule 7, we need to go back to the previous caller. So function <code class="language-plaintext highlighter-rouge">box4</code> returns a pair of the number of returns left to go and the sort we’re reducing to. This way we can distinguish the two cases and take the appropriate action.</p>

<p>If you want to keep a recursive ascent code generator simpler you can of course always return a pair. You could also generate the code in <a href="https://en.wikipedia.org/wiki/Continuation-passing_style"><em>continuation passing style</em></a>, where you pass a function that takes the sort and does the goto action instead of accepting a pair as a result. But because the Rust compiler is not very good at tail call optimisation, so I’m not doing that pattern here.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// S = b F . c</span>
<span class="k">fn</span> <span class="nf">s32</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing S = b F . c"</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'c'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">s3</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = b F . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// S = b F c .</span>
<span class="k">fn</span> <span class="nf">s3</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = b F c . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// S = b E . d</span>
<span class="k">fn</span> <span class="nf">s62</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing S = b E . d"</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'d'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">s6</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = b E . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// S = b E d .</span>
<span class="k">fn</span> <span class="nf">s6</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = b E d . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// Box4</span>
<span class="c">/// Itemset:</span>
<span class="c">/// S = b e . e a</span>
<span class="c">/// E = e . e (d)</span>
<span class="c">/// F = e . e (c)</span>
<span class="k">fn</span> <span class="nf">box4</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="n">Sort</span><span class="p">),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing E or F."</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'e'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">box6</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span>
            <span class="s">"Unexpected input: S = b e . {c}; E = e . {c} ; F = e . {c}"</span>
        <span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c">/// helper</span>
<span class="k">fn</span> <span class="nf">decr</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="n">Sort</span><span class="p">))</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="n">Sort</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note how in <code class="language-plaintext highlighter-rouge">box4</code> we’re now calling the decrement helper function after the call to <code class="language-plaintext highlighter-rouge">box6</code> to count one <code class="language-plaintext highlighter-rouge">return</code> we’re going to do immediately after.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// Box6</span>
<span class="c">/// Itemset:</span>
<span class="c">/// S = b e e . a</span>
<span class="c">/// E = e e . (d)</span>
<span class="c">/// F = e e . (c)</span>
<span class="k">fn</span> <span class="nf">box6</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="n">Sort</span><span class="p">),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.peek</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing E or F."</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'c'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">F</span><span class="p">))</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'d'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">E</span><span class="p">))</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
            <span class="n">input</span><span class="nf">.next</span><span class="p">();</span>
            <span class="nf">s7</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: E = e . {c} ; F = e . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The number of returns to do is equal to the size of the body of the rule we are reducing. Of course we immediately decrement because we are going to immediately return, hence the <code class="language-plaintext highlighter-rouge">map(decr)</code>.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// S = b e e a .</span>
<span class="k">fn</span> <span class="nf">s7</span><span class="p">(</span><span class="mi">_</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="n">Sort</span><span class="p">),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">Ok</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">))</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">lex</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Terminal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">input</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Argument string to parse"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="nf">lex</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.peekable</span><span class="p">();</span>
    <span class="nf">box0</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In our main function we can call <code class="language-plaintext highlighter-rouge">box0</code> with the input. Since this is LR(1) we only need a peekable iterator, that can look ahead 1 terminal.</p>

<h3 id="table-size--code-size">Table size = Code size</h3>

<p>With both recursive descent and recursive ascent parsing, we’re representing the parsing logic directly in code, not as an explicit data representation of a parse table. As such, if you have a larger parse table, you get more code. In LR, when LALR doesn’t suffice, parse tables can potentially grow quite large, as we saw to a limited extent with the last example.</p>

<h2 id="recursive-ascent-descent-parsing">Recursive Ascent-Descent Parsing</h2>

<p>Have you noticed that in the recursive ascent code there are some pretty boring and tiny looking functions? I’m talking about <code class="language-plaintext highlighter-rouge">s12</code>, <code class="language-plaintext highlighter-rouge">s1</code>, <code class="language-plaintext highlighter-rouge">s22</code>, <code class="language-plaintext highlighter-rouge">s2</code>, <code class="language-plaintext highlighter-rouge">s32</code>, <code class="language-plaintext highlighter-rouge">s3</code>, <code class="language-plaintext highlighter-rouge">s62</code>, <code class="language-plaintext highlighter-rouge">s6</code>. These will likely be targeted by the inliner of the Rust compiler<sup id="fnref:inlining" role="doc-noteref"><a href="#fn:inlining" class="footnote" rel="footnote">6</a></sup>, but aren’t they a bit much to even generate?</p>

<p>The common denominator of these functions, and the states of the LR automaton they correspond to, is that they have already honed in on a single rule from the grammar and are only parsing that. Kind of like in an LL parser, except we used the LR automaton mechanism to select the rule instead of an LL look-ahead. If we follow that idea to its logical conclusion, we can do LL parsing from any point where we know there’s only one rule left (or equivalently, inline those simple functions). This means we only have box functions left:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">box1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Sort</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing E or F."</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'e'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="nf">box3</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">?</span> <span class="p">{</span>
            <span class="nn">Sort</span><span class="p">::</span><span class="n">E</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="sc">'c'</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nn">Sort</span><span class="p">::</span><span class="n">F</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="nf">consume</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="sc">'d'</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                <span class="nf">Ok</span><span class="p">(</span><span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">s</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Unexpected sort: S = a {s:?}"</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: S = a . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is using the <code class="language-plaintext highlighter-rouge">consume</code> function from the recursive descent parser example from before.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/// Box6</span>
<span class="c">/// Itemset:</span>
<span class="c">/// S = b e e . a</span>
<span class="c">/// E = e e . (d)</span>
<span class="c">/// F = e e . (c)</span>
<span class="k">fn</span> <span class="nf">box6</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Iter</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="n">Sort</span><span class="p">),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">input</span><span class="nf">.peek</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span>
            <span class="s">"Unexpected end of input while parsing E or F."</span><span class="p">,</span>
        <span class="p">)),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'c'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">F</span><span class="p">))</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'d'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">E</span><span class="p">))</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="sc">'a'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
            <span class="n">input</span><span class="nf">.next</span><span class="p">();</span> <span class="c">// consume 'a'</span>
            <span class="nf">Ok</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="nn">Sort</span><span class="p">::</span><span class="n">S</span><span class="p">))</span><span class="nf">.map</span><span class="p">(</span><span class="n">decr</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Unexpected input: E = e . {c} ; F = e . {c}"</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note that in box 6 we now count the number of symbols in the body of the rule before the dot to come up with the number of returns.</p>

<h3 id="left-corners">Left Corners?</h3>

<p>The left corner of a rule in the grammar is the left-most symbol in the body of the rule, plus the left corners of any sorts in left corner. So it’s basically a <em>First</em> set with the sorts included. I found this is some of the older literature, and figured I’d add a note for myself in here.</p>

<p>There is/was such a thing as left-corner parsing, seemingly mostly used in natural language processing (NLP). NLP mostly uses <em>ambiguous</em> context-free grammars, and typically uses (used?) a backtracking parser to deal with that. These can be slow of course. And it turns out left corners helped with this, by adding some “filtering” that allows the parser to backtrack less. This is connected to recursive ascent-descent parsing, which you could also see as filtering with LR to finish parsing with LL. In our case we just don’t do backtracking.</p>

<h1 id="fin">Fin</h1>

<p>I really need to stop working on this blog post and publish it already. It’s been over a year since I started working on it (on and off, during holidays when I had enough focus time)<sup id="fnref:graphviz" role="doc-noteref"><a href="#fn:graphviz" class="footnote" rel="footnote">7</a></sup>. I already had an idea of where to go to next (generalised parsers), but now I also want to study minimal LR(1) automaton/parse table algorithms, and look at continuation passing style again because I think you can pass the left-context as a function argument. This would give you an LALR automaton structure with LR parsing power. Is that a good idea? Don’t know, needs testing (or reading papers/blog posts, probably someone else already tried this before).</p>

<p>I usually have a pithy remark or sneak the Kaomoji into the footnotes, but I must be out of practice, because I can’t think of a good way to do that…</p>

<p>Ehh, whatever ¯\_(ツ)_/¯</p>

<h1 id="footnotes">Footnotes</h1>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:LLdef" role="doc-endnote">
      <p>I’m fairly sure my prose description there is the same as a formal definition, and it feel a bit nicer to think about than <a href="https://en.wikipedia.org/wiki/LL_grammar#Formal_definition">the ones you can find on Wikipedia</a>. <a href="#fnref:LLdef" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:table" role="doc-endnote">
      <p>Technically you’d need to see <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex"> A₁ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex"> A₂ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> as separate symbols and duplicate the rules for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex"> A </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, resulting in a larger grammar in correspondence with the larger table. But I couldn’t be bothered, and the parse table as shown works just as well. This is relevant to the code size of a recursive descent parser too, since you can just reuse the code for rules 2 and 3 instead of having duplicate code for the two extra rules. What’s a recursive descent parser? That comes just a little later in the post, so keep reading ;) <a href="#fnref:table" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:nondet" role="doc-endnote">
      <p>Yes, there are non-deterministic context-free languages. Those are the context-free languages that can only be parsed with a non-deterministic PDA. Since this post is about deterministic parsers, we’ll ignore the non-deterministic languages. <a href="#fnref:nondet" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:LLR" role="doc-endnote">
      <p>While I find the <a href="https://en.wikipedia.org/wiki/LL_grammar#Regular_case">Wikipedia article on LLR</a> confusing, and it makes a good case for why it’s not really used, I’m still somewhat intrigued. This is one of those things that will stay on my reading list for a while I think, something I still want to understand further… <a href="#fnref:LLR" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:indirect-recursion" role="doc-endnote">
      <p><em>Indirect</em> left recursion is even worse in LL. At least the direct version can still be dealt with by an automatic grammar rewrite algorithm. That’s more or less what the node-reparenting trick mentioned at the end of the LL section does. Similarly, there are automatic grammar rewrites for direct right-recursion for LR, and indirect right recursion can be more problematic… <a href="#fnref:indirect-recursion" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:inlining" role="doc-endnote">
      <p>Actually, I checked in <a href="https://godbolt.org/">Compiler Explorer</a> how this turns out, and while <code class="language-plaintext highlighter-rouge">s7</code> is inlined and compiled away entirely, adapting <code class="language-plaintext highlighter-rouge">box1</code> to consume directly will make the assembly at <code class="language-plaintext highlighter-rouge">opt-level=3</code> smaller. Adding an <code class="language-plaintext highlighter-rouge">#[inline]</code> hint on <code class="language-plaintext highlighter-rouge">consume</code> helps as well. Though I may just be seeing the effect of uniform error messages through <code class="language-plaintext highlighter-rouge">consume</code>. Actually following and understanding the optimised assembly code is a pain, so I just clicked around a bit to verify that the example code is reduced to a state machine with jumps and labels instead of using function <code class="language-plaintext highlighter-rouge">call</code> instructions. So that’s neat, basically what I was hoping for :) <a href="#fnref:inlining" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:graphviz" role="doc-endnote">
      <p>I hope you appreciate how much time it took to find example grammars to steal (or occasionally develop myself) and especially how much time it took to get GraphViz to output somewhat decent automata of those examples! <a href="#fnref:graphviz" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Whatever</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:mail [at] this domain">mail [at] this domain</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/Apanatshka">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">Apanatshka</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">A web log. Mostly about computer science-y stuff. 
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
